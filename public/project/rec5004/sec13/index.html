<!DOCTYPE html>
<!-- This site was created with Wowchemy. https://www.wowchemy.com -->
<!-- Last Published: July 24, 2023 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.7.0 for Hugo" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css" integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.0f229d4b7ebad1917a9a357cba2effab.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  


























  
  
  






  <meta name="author" content="Fábio Nishida" />





  

<meta name="description" content="This page includes a section on panel data estimation with R and provides examples of data structures and models. The content is based on the book “Panel Data Econometrics with R” by Croissant &amp; Millo (2018) and adapted from lecture notes on Econometrics I (2022)." />



<link rel="alternate" hreflang="en-us" href="https://fhnishida.netlify.app/project/rec5004/sec13/" />
<link rel="canonical" href="https://fhnishida.netlify.app/project/rec5004/sec13/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu47f6d4834e8bfd33c99c8c5b57562587_11044_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu47f6d4834e8bfd33c99c8c5b57562587_11044_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  
  






<meta property="twitter:card" content="summary" />

  <meta property="twitter:site" content="@wowchemy" />
  <meta property="twitter:creator" content="@wowchemy" />
<meta property="twitter:image" content="https://fhnishida.netlify.app/media/icon_hu47f6d4834e8bfd33c99c8c5b57562587_11044_512x512_fill_lanczos_center_3.png" />
<meta property="og:site_name" content="Fábio Nishida" />
<meta property="og:url" content="https://fhnishida.netlify.app/project/rec5004/sec13/" />
<meta property="og:title" content="Panel Data Estimation | Fábio Nishida" />
<meta property="og:description" content="This page includes a section on panel data estimation with R and provides examples of data structures and models. The content is based on the book “Panel Data Econometrics with R” by Croissant &amp; Millo (2018) and adapted from lecture notes on Econometrics I (2022)." /><meta property="og:image" content="https://fhnishida.netlify.app/media/icon_hu47f6d4834e8bfd33c99c8c5b57562587_11044_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />

  
    <meta property="og:updated_time" content="2018-09-09T00:00:00&#43;00:00" />
  










  
  
  

  
  
    <link rel="alternate" href="/project/rec5004/sec13/index.xml" type="application/rss+xml" title="Fábio Nishida" />
  

  


  
  <title>Panel Data Estimation | Fábio Nishida</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="8c7ed13cf8c4f0f1bfeca0e0f393b0cd" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Fábio Nishida</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Fábio Nishida</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#projects"><span>Teaching Assistance</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#featured"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="/#contact"  aria-label="envelope">
                <i class="fas fa-envelope" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
        
          Main
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">Search...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li><a href="/project/"><i class="fas fa-arrow-left pr-1"></i>Projects</a></li>
      </ul>

      
      
        
          
        
      


  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/"><i class="fas fa-book pr-1"></i>Main</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/project/rec5004/">----------------------</a></li>



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec1/">R Toolkit</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec2/">Programming</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec3/">Manipulation</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec4/">Visualization</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec5/">Distributions</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec6/">Simple Regression</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec7/">Optimization</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec8/">Multiple Regression</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec9/">Hypothesis Testing</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec10/">GLS/WLS/FGLS</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec11/">IV/2SLS</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec12/">----------------</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link  active" href="/project/rec5004/sec13/">Panel Data</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/project/rec5004/sec14/">Manipulation</a>
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      












      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#gravações-rec2312">Gravações REC2312</a></li>
    <li><a href="#estrutura-dos-dados">Estrutura dos Dados</a>
      <ul>
        <li><a href="#corte-transversal">Corte Transversal</a></li>
        <li><a href="#painel">Painel</a></li>
      </ul>
    </li>
    <li><a href="#modelo-em-painel">Modelo em Painel</a></li>
    <li><a href="#matriz-de-variâncias-covariâncias-dos-erros">Matriz de Variâncias-Covariâncias dos Erros</a>
      <ul>
        <li></li>
        <li><a href="#estimação-dos-componentes-de-erro">Estimação dos Componentes de Erro</a></li>
      </ul>
    </li>
    <li><a href="#estimador-mqe">Estimador MQE</a>
      <ul>
        <li><a href="#estimação-via-plm">Estimação via <code>plm()</code></a></li>
        <li><a href="#estimação-analítica">Estimação Analítica</a></li>
      </ul>
    </li>
    <li><a href="#estimador-mqgf">Estimador MQGF</a>
      <ul>
        <li><a href="#estimação-via-plm-1">Estimação via <code>plm()</code></a></li>
        <li><a href="#estimação-analítica-1">Estimação Analítica</a></li>
      </ul>
    </li>
    <li><a href="#matrizes-de-transformação">Matrizes de Transformação</a>
      <ul>
        <li><a href="#modelo-em-painel-2">Modelo em Painel (2)</a></li>
        <li><a href="#_between_"><em>Between</em></a></li>
        <li><a href="#_within_"><em>Within</em></a></li>
        <li><a href="#primeiras-diferenças">Primeiras-diferenças</a></li>
      </ul>
    </li>
    <li><a href="#estimador-_between_">Estimador <em>Between</em></a>
      <ul>
        <li><a href="#estimação-via-plm-2">Estimação via <code>plm()</code></a></li>
        <li><a href="#estimação-analítica-2">Estimação Analítica</a></li>
      </ul>
    </li>
    <li><a href="#estimador-_within_-efeitos-fixos">Estimador <em>Within</em> (Efeitos Fixos)</a>
      <ul>
        <li><a href="#estimação-via-plm-3">Estimação via <code>plm()</code></a></li>
        <li><a href="#estimação-analítica-3">Estimação Analítica</a></li>
        <li><a href="#efeitos-fixos-do-_within_">Efeitos Fixos do <em>Within</em></a></li>
      </ul>
    </li>
    <li><a href="#estimador-de-primeiras-diferenças">Estimador de Primeiras-Diferenças</a>
      <ul>
        <li><a href="#estimação-via-plm-4">Estimação via <code>plm()</code></a></li>
        <li><a href="#estimação-analítica-4">Estimação Analítica</a></li>
      </ul>
    </li>
    <li><a href="#comparativo-dos-estimadores">Comparativo dos Estimadores</a>
      <ul>
        <li><a href="#mqgf-junção-mqe-e-_within_">MQGF: junção MQE e <em>Within</em></a></li>
        <li><a href="#exemplo-1-1">Exemplo 1</a></li>
        <li><a href="#exemplo-2-1">Exemplo 2</a></li>
      </ul>
    </li>
    <li><a href="#estimador-mv">Estimador MV</a>
      <ul>
        <li><a href="#estimação-via-pglm">Estimação via <code>pglm()</code></a></li>
        <li><a href="#estimação-analítica-5">Estimação Analítica</a></li>
      </ul>
    </li>
    <li><a href="#testes-de-presença-de-efeitos-individuais">Testes de Presença de Efeitos Individuais</a>
      <ul>
        <li><a href="#breusch-pagan">Breusch-Pagan</a></li>
        <li><a href="#testes-f">Testes F</a></li>
        <li><a href="#aplicando-no-r">Aplicando no R</a></li>
      </ul>
    </li>
    <li><a href="#testes-de-efeitos-correlacionados">Testes de Efeitos Correlacionados</a>
      <ul>
        <li><a href="#teste-de-hausman">Teste de Hausman</a></li>
      </ul>
    </li>
  </ul>
</nav>

      











    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <div class="docs-article-container">
        
      </div>

      
      
      

      <div class="docs-article-container">
        
        <h1>Panel Data Estimation</h1>

        <article class="article-style">

          
          

          <h2 id="gravações-rec2312">Gravações REC2312</h2>
<ul>
<li>
<p><strong>Monitoria 4</strong>: Dados em Painel e Matriz de Covariâncias dos Erros | <a href="https://fhnishida.netlify.app/project/rec2312/monitoria04.R" target="_blank" rel="noopener">Script</a>
<a href="https://www.youtube.com/watch?v=6hZqBAGTNTc" target="_blank" rel="noopener"><img src="https://img.youtube.com/vi/6hZqBAGTNTc/maxresdefault.jpg" alt="img" width=50%/></a></p>
</li>
<li>
<p><strong>Monitoria 5</strong>: Estimação da Matriz de Covariâncias dos Erros e Estimador de MQE | <a href="https://fhnishida.netlify.app/project/rec2312/monitoria05.R" target="_blank" rel="noopener">Script</a>
<a href="https://www.youtube.com/watch?v=uxEXcGDL_zM" target="_blank" rel="noopener"><img src="https://img.youtube.com/vi/uxEXcGDL_zM/maxresdefault.jpg" alt="img" width=50%/></a></p>
</li>
<li>
<p><strong>Monitoria 6</strong>: Estimador de MQGF | <a href="https://fhnishida.netlify.app/project/rec2312/monitoria06.R" target="_blank" rel="noopener">Script</a>
<a href="https://www.youtube.com/watch?v=G-1AVqDQBqY" target="_blank" rel="noopener"><img src="https://img.youtube.com/vi/G-1AVqDQBqY/maxresdefault.jpg" alt="img" width=50%/></a></p>
</li>
<li>
<p><strong>Monitoria 7</strong>: Matrizes de Transformação e Estimador Between | <a href="https://fhnishida.netlify.app/project/rec2312/monitoria07.R" target="_blank" rel="noopener">Script</a>
<a href="https://www.youtube.com/watch?v=kh69ZHE8DNY" target="_blank" rel="noopener"><img src="https://img.youtube.com/vi/kh69ZHE8DNY/maxresdefault.jpg" alt="img" width=50%/></a></p>
</li>
<li>
<p><strong>Monitoria 8</strong>: Estimadores Within e de Primeiras Diferenças | <a href="https://fhnishida.netlify.app/project/rec2312/monitoria08.R" target="_blank" rel="noopener">Script</a>
<a href="https://www.youtube.com/watch?v=KbOV12t_Ki0" target="_blank" rel="noopener"><img src="https://img.youtube.com/vi/KbOV12t_Ki0/maxresdefault.jpg" alt="img" width=50%/></a></p>
</li>
</ul>
<h2 id="estrutura-dos-dados">Estrutura dos Dados</h2>
<ul>
<li>Seção 2.1.1 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</li>
<li>A maioria das notações foram adaptadas de acordo com as notas de aula de Econometria I.</li>
</ul>
<h3 id="corte-transversal">Corte Transversal</h3>
<p>Até agora, utilizamos bases de dados em corte transversal (ou <em>cross-section</em>, em inglês), ou seja, em que cada linha representava um indivíduo 

$i  = 1, ..., N$ e observamos as realizações da variável dependente 

$y$ e das variáveis explicativas 

$k = 1, 2, ..., K$:</p>
<img src="../data_crosssection.png" alt="">
<h4 id="exemplo">Exemplo</h4>
<p>Considerando 

$N = 4$ indivíduos e 

$K = 2$ covariadas, segue o exemplo:</p>
<img src="../data_crosssection_example.png" alt="">
<h3 id="painel">Painel</h3>
<p>Também é comum utilizarmos dados em painel, isto é, uma base de dados em que observamos os indivíduos 

$i = 1, ..., N$ nos 

$t = 1, ..., T$ períodos.</p>
<p>Este tipo de estrutura de dado permite, além de fazer comparações inter-indivíduos (<em>between</em>), avaliar diferenças intra-indivíduos (<em>within</em>) a partir das variações ocorridas ao longo do tempo para um mesmo indivíduo.</p>
<p>Por simplicidade, consideramos que todos indivíduos possuem 

$T$ observações ao longo do tempo (<strong>painel balanceado</strong>). Além disso, dados em painel podem estar dispostos de duas formas: longa ou curta.</p>
<h5 id="painel-longo-_long_-em-inglês">Painel longo (<em>long</em>, em inglês)</h5>
<p>Aqui, cada indivíduo aparece em 

$T$ linhas. Cada observação é indicada pela dupla 

$i$ e 

$t$ (variáveis-chave da base de dados). Essa é a forma padrão utilizada em Econometria.</p>
<img src="../data_panellong.png" alt="">
<h5 id="painel-curto-_wide_-em-inglês">Painel curto (<em>wide</em>, em inglês)</h5>
<p>Na forma curta, as informações das variáveis dependentes e independentes aparecem repetidamente por 

$T$ vezes, sendo que cada repetição corresponde a um dos 

$T$ períodos:</p>
<img src="../data_panelwide.png" alt="">
<h4 id="exemplos">Exemplos</h4>
<p>Como exemplo, consideramos 

$N = 4$ indivíduos e 

$K = 2$ covariadas e 

$T = 2$ períodos. As bases de dados em paineis longo e curto, respectivamente, teriam as seguintes estruturas:</p>
<img src="../data_panellong_example.png" alt="">
<img src="../data_panelwide_example.png" alt="">
<h2 id="modelo-em-painel">Modelo em Painel</h2>
<p>Para a observação do indivíduo 

$i \in \{1, ..., N\}$ no período 

$t \in \{1, ..., T\}$, podemos escrever o modelo como:</p>
<p>

$$ y_{it} = \boldsymbol{x}'_{it} \boldsymbol{\beta} + \varepsilon_{it} \tag{1} $$ 
em que 

$\boldsymbol{\beta}$ é um vetor-coluna de 

$K$ parâmetros</p>


$$ \boldsymbol{\beta} = \left[ \begin{array}{c} \beta_0 \\ \beta_1 \\ \beta_2 \\ \vdots \\ \beta_K \end{array} \right], $$
<p>

$y_{it}$ é a variável dependente, 

$\boldsymbol{x}'_{it}$ é o vetor-linha de dimensão 

$K+1$:</p>


$$ \boldsymbol{x}'_{it} = \left[ \begin{array}{c} 1 & x^1_{it} & x^2_{it} & \cdots & x^K_{it} \end{array} \right],  $$
<p>e o erro 

$\varepsilon_{it}$ pode ser escrito como:</p>
<p>

$$ \varepsilon_{it} = u_i + v_{it},  $$
sendo 

$u_i$ o erro individual para o indivíduo 

$i$ e 

$v_{it}$ é o erro idiossincrático (residual).</p>
<p>Empilhando as equações (1) para todo indivíduo 

$i = 1, 2, ..., N$ e todo período 

$t = 1, 2, ..., T $, temos</p>
<p>

$$ \underbrace{\boldsymbol{y}}_{NT \times 1} = \left[ \begin{array}{c}
    y_{11} \\ y_{12} \\ \vdots \\ y_{1T} \\\hline y_{21} \\ y_{22} \\ \vdots \\ y_{2T} \\\hline \vdots \\\hline y_{N1} \\ y_{N2} \\ \vdots \\ y_{NT}
\end{array} \right] \quad \text{ e } \quad 
\underbrace{\boldsymbol{X}}_{NT \times K} = \left[ \begin{array}{c}
    \boldsymbol{x}'_{11} \\ \boldsymbol{x}'_{12} \\ \vdots \\ \boldsymbol{x}'_{1T} \\\hline
    \boldsymbol{x}'_{21} \\ \boldsymbol{x}'_{22} \\ \vdots \\ \boldsymbol{x}'_{2T} \\\hline
    \vdots \\\hline
    \boldsymbol{x}'_{N1} \\ \boldsymbol{x}'_{N2} \\ \vdots \\ \boldsymbol{x}'_{NT} 
    \end{array} \right]
  = \left[ \begin{array}{ccccc}
    1 & x^1_{11} & x^2_{11} & \cdots & x^K_{11} \\
    1 & x^1_{12} & x^2_{12} & \cdots & x^K_{12} \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{1T} & x^2_{1T} & \cdots & x^K_{1T} \\\hline
    1 & x^1_{21} & x^2_{21} & \cdots & x^K_{21} \\
    1 & x^1_{22} & x^2_{22} & \cdots & x^K_{22} \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{2T} & x^2_{2T} & \cdots & x^K_{2T} \\\hline
    \vdots & \vdots & \vdots & \ddots & \vdots \\\hline
    1 & x^1_{N1} & x^2_{N1} & \cdots & x^K_{N1} \\
    1 & x^1_{N2} & x^2_{N2} & \cdots & x^K_{N2} \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{NT} & x^2_{NT} & \cdots & x^K_{NT}
\end{array} \right] $$ 
As linhas horizontais foram inseridas apenas para facilitar a visualização dos valores referentes a cada indivíduo 

$i$.</p>
</br>
<h2 id="matriz-de-variâncias-covariâncias-dos-erros">Matriz de Variâncias-Covariâncias dos Erros</h2>
<ul>
<li>Seção 2.2 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</li>
</ul>
<p>A Matriz de Variâncias-Covariâncias dos Erros relaciona um termo de erro, 

$\varepsilon_{it}$, com todos os demais termos de erro 

$\varepsilon_{js}$, para todo 

$j = 1, ..., N$ e todo 

$a = 1, ..., T$.</p>
<p>Na matriz de covariância de erro, cada linha representa um 

$\varepsilon_{it}$ e cada coluna representa um 

$\varepsilon_{jt}$. Seus elementos representam a covariância entre


$\varepsilon_{it}$ e 

$\varepsilon_{jt}$, sendo que pode haver 

$\varepsilon_{it} = \varepsilon_{jt}$ (que, neste caso, torna-se variância):</p>
<p>

$$ cov(\boldsymbol{\varepsilon}) = \underset{NT \times NT}{\boldsymbol{\Sigma}} =$$


$$ \left[ \tiny \begin{array}{cccc|ccc|c|ccc}
var(\varepsilon_{{\color{red}1}1}) & cov(\varepsilon_{{\color{red}1}1}, \varepsilon_{{\color{red}1}2}) & \cdots & cov(\varepsilon_{{\color{red}1}1}, \varepsilon_{{\color{red}1}T}) & cov(\varepsilon_{{\color{red}1}1}, \varepsilon_{{\color{red}2}1}) & \cdots & cov(\varepsilon_{{\color{red}1}1}, \varepsilon_{{\color{red}2}T}) & \cdots & cov(\varepsilon_{{\color{red}1}1}, \varepsilon_{{\color{red}N}1}) & \cdots & cov(\varepsilon_{{\color{red}1}1}, \varepsilon_{{\color{red}N}T}) \\
cov(\varepsilon_{{\color{red}1}2}, \varepsilon_{{\color{red}1}1}) & var(\varepsilon_{{\color{red}1}2}) & \cdots & cov(\varepsilon_{{\color{red}1}2}, \varepsilon_{{\color{red}1}T}) & cov(\varepsilon_{{\color{red}1}2}, \varepsilon_{{\color{red}2}1}) & \cdots & cov(\varepsilon_{{\color{red}1}2}, \varepsilon_{{\color{red}2}T}) & \cdots & cov(\varepsilon_{{\color{red}1}2}, \varepsilon_{{\color{red}N}1}) & \cdots & cov(\varepsilon_{{\color{red}1}2}, \varepsilon_{{\color{red}N}T}) \\
\vdots & \vdots & \ddots & \vdots & \vdots & \ddots & \vdots & \ddots & \vdots & \ddots & \vdots \\
cov(\varepsilon_{{\color{red}1}T}, \varepsilon_{{\color{red}1}1}) & cov(\varepsilon_{{\color{red}1}T}, \varepsilon_{{\color{red}1}2}) & \cdots & var(\varepsilon_{{\color{red}1}T}) & cov(\varepsilon_{{\color{red}1}T}, \varepsilon_{{\color{red}2}1}) & \cdots & cov(\varepsilon_{{\color{red}1}T}, \varepsilon_{{\color{red}2}T}) & \cdots & cov(\varepsilon_{{\color{red}1}T}, \varepsilon_{{\color{red}N}1}) & \cdots & cov(\varepsilon_{{\color{red}1}T}, \varepsilon_{{\color{red}N}T}) \\ \hline
cov(\varepsilon_{{\color{red}2}1}, \varepsilon_{{\color{red}1}1}) & cov(\varepsilon_{{\color{red}2}1}, \varepsilon_{{\color{red}1}2}) & \cdots & cov(\varepsilon_{{\color{red}2}1}, \varepsilon_{{\color{red}1}T}) & var(\varepsilon_{{\color{red}2}1}) & \cdots & 
cov(\varepsilon_{{\color{red}2}1}, \varepsilon_{{\color{red}2}T}) & \cdots & cov(\varepsilon_{{\color{red}2}1}, \varepsilon_{{\color{red}N}1}) & \cdots & cov(\varepsilon_{{\color{red}2}1}, \varepsilon_{{\color{red}N}T}) \\
\vdots & \vdots & \ddots & \vdots & \vdots & \ddots & \vdots & \ddots & \vdots & \ddots & \vdots \\
cov(\varepsilon_{{\color{red}2}T}, \varepsilon_{{\color{red}1}1}) & cov(\varepsilon_{{\color{red}2}T}, \varepsilon_{{\color{red}1}2}) & \cdots & cov(\varepsilon_{{\color{red}2}T}, \varepsilon_{{\color{red}1}T}) & cov(\varepsilon_{{\color{red}2}T}, \varepsilon_{{\color{red}2}1}) & \cdots & var(\varepsilon_{{\color{red}2}T}) & \cdots & 
cov(\varepsilon_{{\color{red}2}T}, \varepsilon_{{\color{red}N}1}) & \cdots & cov(\varepsilon_{{\color{red}2}T}, \varepsilon_{{\color{red}N}T}) \\ \hline
\vdots & \vdots & \ddots & \vdots & \vdots & \ddots & \vdots & \ddots & \vdots & \ddots & \vdots \\ \hline
cov(\varepsilon_{{\color{red}N}1}, \varepsilon_{{\color{red}1}1}) & cov(\varepsilon_{{\color{red}N}1}, \varepsilon_{{\color{red}1}2}) & \cdots & cov(\varepsilon_{{\color{red}N}1}, \varepsilon_{{\color{red}1}T}) & cov(\varepsilon_{{\color{red}N}1}, \varepsilon_{{\color{red}2}1}) & \cdots & 
cov(\varepsilon_{{\color{red}N}1}, \varepsilon_{{\color{red}2}T}) & \cdots & var(\varepsilon_{{\color{red}N}1}) & \cdots &
cov(\varepsilon_{{\color{red}N}1}, \varepsilon_{{\color{red}N}T}) \\
\vdots & \vdots & \ddots & \vdots & \vdots & \ddots & \vdots & \ddots & \vdots & \ddots & \vdots \\
cov(\varepsilon_{{\color{red}N}T}, \varepsilon_{{\color{red}1}1}) & cov(\varepsilon_{{\color{red}N}T}, \varepsilon_{{\color{red}1}2}) & \cdots & cov(\varepsilon_{{\color{red}N}T}, \varepsilon_{{\color{red}1}T}) & cov(\varepsilon_{{\color{red}N}T}, \varepsilon_{{\color{red}2}1}) & \cdots & cov(\varepsilon_{{\color{red}N}T}, \varepsilon_{{\color{red}2}T}) & \cdots & 
cov(\varepsilon_{{\color{red}N}T}, \varepsilon_{{\color{red}N}1}) & \cdots & var(\varepsilon_{{\color{red}N}T})
\end{array} \right]$$</p>
<p>Note que a Matriz de Variâncias-Covariâncias dos Erros possui matrizes menores que relacionam os erros do indivíduo 

$i$ (linha) e do indivíduo 

$j$ (coluna). Para escrever mais facilmente 

$\boldsymbol{\Sigma}$, podemos preenchê-la com matrizes menores de 

$\boldsymbol{\Sigma}_{ij}$:</p>


$$ \underset{NT \times NT}{\boldsymbol{\Sigma}} = \left[ \begin{matrix} 
\boldsymbol{\Sigma}_1 & \boldsymbol{\Sigma}_{12} & \cdots & \boldsymbol{\Sigma}_{1N} \\
\boldsymbol{\Sigma}_{21} & \boldsymbol{\Sigma}_{2} & \cdots & \boldsymbol{\Sigma}_{2N} \\
\vdots & \vdots & \ddots & \vdots \\
\boldsymbol{\Sigma}_{N1} & \boldsymbol{\Sigma}_{N2} & \cdots & \boldsymbol{\Sigma}_{N}
\end{matrix} \right] \tag{1} $$
<p>em que, quando 

$i = j$, temos</p>


$$ \underset{T \times T}{\boldsymbol{\Sigma}_i} = \left[ \begin{matrix} 
var(\varepsilon_{i1}) & cov(\varepsilon_{i1}, \varepsilon_{i2}) & \cdots & cov(\varepsilon_{i1}, \varepsilon_{iT}) \\
cov(\varepsilon_{i1}, \varepsilon_{i2}) & var(\varepsilon_{i2}) & \cdots & cov(\varepsilon_{i2}, \varepsilon_{iT}) \\
\vdots & \vdots & \ddots & \vdots \\
cov(\varepsilon_{i1}, \varepsilon_{iT}) & cov(\varepsilon_{i2}, \varepsilon_{iT}) & \cdots & var(\varepsilon_{iT})
\end{matrix} \right] \tag{2} $$
<p>e, quando 

$i \neq j$, temos


$$ \underset{T \times T}{\boldsymbol{\Sigma}_{ij}} = \left[ \begin{matrix} 
cov(\varepsilon_{i1}, \varepsilon_{j1}) & cov(\varepsilon_{i1}, \varepsilon_{j2}) & \cdots & cov(\varepsilon_{i1}, \varepsilon_{jT}) \\
cov(\varepsilon_{i1}, \varepsilon_{j2}) & cov(\varepsilon_{i2}, \varepsilon_{j2}) & \cdots & cov(\varepsilon_{i2}, \varepsilon_{jT}) \\
\vdots & \vdots & \ddots & \vdots \\
cov(\varepsilon_{i1}, \varepsilon_{jT}) & cov(\varepsilon_{i2}, \varepsilon_{jT}) & \cdots & cov(\varepsilon_{iT}, \varepsilon_{jT})
\end{matrix} \right]. \tag{3} $$</p>
<p>Como assumimos amostragem aleatória em que a covariância entre dois indivíduos distintos 

($i \neq j$) é<br>


$$ cov(\varepsilon_{it}, \varepsilon_{jt}) = cov(\varepsilon_{it}, \varepsilon_{js}) = 0,  \qquad \text{para todo } i \neq j.$$</p>
<p>Logo, 

$\boldsymbol{\Sigma}_{ij} = \boldsymbol{0}$ (matriz de zeros):


$$ \underset{T \times T}{\boldsymbol{\Sigma}_{ij}} =  \underset{T \times T}{\boldsymbol{0}} = \left[ \begin{matrix} 
0 & 0 & \cdots & 0 \\
0 & 0 & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & 0
\end{matrix} \right] $$</p>
<p>Logo, podemos reescrever (1) como</p>


$$ \underset{NT \times NT}{\boldsymbol{\Sigma}} = \left[ \begin{matrix} 
\boldsymbol{\Sigma}_1 & \boldsymbol{0} & \cdots & \boldsymbol{0} \\
\boldsymbol{0} & \boldsymbol{\Sigma}_2 & \cdots & \boldsymbol{0} \\
\vdots & \vdots & \ddots & \vdots \\
\boldsymbol{0} & \boldsymbol{0} & \cdots & \boldsymbol{\Sigma}_N
\end{matrix} \right]. \tag{1'} $$
<p>Assumimos também que a Matriz de Variâncias-Covariâncias dos Erros do indivíduo 

$i$ depende apenas dos parâmetros 

$\sigma^2_u$ e 

$\sigma^2_v$, já que:</p>
<ul>
<li>Variância de um erro: 

$ var(\varepsilon_{it}) = \sigma^2_u + \sigma^2_v $</li>
<li>Covariância de dois erros de um mesmo indivíduo 

$i$ em dois períodos  

$t \neq s$: 

$ cov(\varepsilon_{it}, \varepsilon_{is}) = \sigma^2_u $</li>
</ul>
<p>Substituindo em (2), segue que</p>


$$ \underset{T \times T}{\boldsymbol{\Sigma}_i} = \left[ \begin{array}{cccc} 
\sigma^2_u + \sigma^2_v & \sigma^2_u & \cdots & \sigma^2_u \\
\sigma^2_u & \sigma^2_u + \sigma^2_v & \cdots & \sigma^2_u \\
\vdots & \vdots & \ddots & \vdots \\
\sigma^2_u & \sigma^2_u & \cdots & \sigma^2_u + \sigma^2_v
\end{array} \right] \tag{2'} $$
<h5 id="exemplo-1">Exemplo</h5>
<p>Por simplicidade, considere que 

$N = 2$ e 

$T = 3$. Logo, a Matriz de Variâncias-Covariâncias dos Erros pode ser escrita como;</p>


\begin{align} \underset{6 \times 6}{\boldsymbol{\Sigma}}
&= \left[ \begin{array}{cc}
\boldsymbol{\Sigma}_1 & \boldsymbol{0} \\
\boldsymbol{0} & \boldsymbol{\Sigma}_2
\end{array} \right] \\
&= \left[ \begin{array} {ccc|ccc}
\sigma^2_u + \sigma^2_v & \sigma^2_u & \sigma^2_u & 0 & 0 & 0 \\
\sigma^2_u & \sigma^2_u + \sigma^2_v & \sigma^2_u & 0 & 0 & 0 \\
\sigma^2_u & \sigma^2_u & \sigma^2_u + \sigma^2_v & 0 & 0 & 0\\ \hline
0 & 0 & 0 & \sigma^2_u + \sigma^2_v & \sigma^2_u & \sigma^2_u \\
0 & 0 & 0 & \sigma^2_u & \sigma^2_u + \sigma^2_v & \sigma^2_u \\
0 & 0 & 0 & \sigma^2_u & \sigma^2_u & \sigma^2_u + \sigma^2_v \\
\end{array} \right] \end{align} 
<p>Note que acima foram utilizadas linhas verticais e horizontais apenas para facilitar a visualização dos elementos que substituíram cada matriz.</p>
<h4 id="calculando-no-r">Calculando no R</h4>
<p>Primeiro, denote 

$I_p$ a matriz identidade de dimensão 

$p \times p$:</p>


$$ \boldsymbol{I}_p= \left[ \begin{array}{cccc}
    1 & 0 & 0 & \cdots & 0 \\
    0 & 1 & 0 & \cdots & 0 \\
    0 & 0 & 1 & \cdots & 0 \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 & 0 & 0 & \cdots & 1
\end{array} \right]_{p \times p}, $$ 
<p>e considere 

$\boldsymbol{\iota}_q$ um vetor-coluna de 1&rsquo;s de tamanho 

$q$:


$$ \boldsymbol{\iota}_q = \left[ \begin{array}{c} 1 \\ 1 \\ \vdots \\ 1 \end{array} \right]_{q \times 1} $$</p>
<p>Com dados em <strong>corte transversal</strong>, era fácil calcular a Matriz de Variâncias-Covariâncias dos Erros, pois só havia um termo de erro e, portanto, tínhamos 

$\sigma^2$ apenas na diagonal principal:</p>


\begin{align}
\boldsymbol{\Sigma}_{\scriptscriptstyle{MQO}} &= \sigma^2 \boldsymbol{I}_N \\
  &= \sigma^2 \left[ \begin{array}{cccc} 
1 & 0 & \cdots & 0 \\
0 & 1 & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & 1
\end{array} \right] \\
  &= \left[ \begin{array}{cccc} 
\sigma^2 & 0 & \cdots & 0 \\
0 & \sigma^2 & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & \sigma^2
\end{array} \right]_{N \times N} \end{align}
<p>Agora, para <strong>dados em painel</strong>, como visto acima, possuímos duas variâncias de termos de erro, sendo que 

$\sigma^2_v$ aparece na diagonal principal, cujos elementos (e seus &ldquo;vizinhos&rdquo;) precisam ser somados por 

$\sigma^2_u$. Logo, a Matriz de Variâncias-Covariâncias dos Erros com dados em painel pode ser escrita na forma matricial como:</p>


$$ \boldsymbol{\Sigma} = \sigma^2_v \boldsymbol{I}_{NT} + T \sigma^2_u [\boldsymbol{I}_N \otimes \boldsymbol{\iota}_T (\boldsymbol{\iota}'_T \boldsymbol{\iota}_T)^{-1} \boldsymbol{\iota}'_T] \tag{4} $$
<p>Note que o primeiro termo da soma cria uma diagonal principal de 

$\sigma^2_v$.</p>


\begin{align}
\sigma^2_v \boldsymbol{I}_{NT} &= \sigma^2_v \left[ \begin{array}{cccc} 
1 & 0 & \cdots & 0 \\
0 & 1 & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & 1
\end{array} \right] \\
  &= \left[ \begin{array}{cccc} 
\sigma^2_v & 0 & \cdots & 0 \\
0 & \sigma^2_v & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & \sigma^2_v
\end{array} \right]_{NT \times NT} \end{align}
<p>Agora, &ldquo;só&rdquo; precisamos somar 

$\sigma^2_u$ &ldquo;na proximidade&rdquo; dessa diagonal.</p>
<p>Por enquanto, vamos ignorar 

$T \sigma^2_u$ e vamos chamar a parte entre colchetes de matriz de transformação <strong>inter-indivíduos (<em>between</em>)</strong>:</p>


$$ \boldsymbol{B}\ \equiv\ \boldsymbol{I}_N \otimes \Big[ \boldsymbol{\iota}_T (\boldsymbol{\iota}'_T \boldsymbol{\iota}_T)^{-1} \boldsymbol{\iota}'_T \Big] $$
<p>Note que a matriz 

$\boldsymbol{B}$ é chamada de  

$\boldsymbol{N}$ nas notas de aula de Econometria II (2021) do prof. Daniel.</p>


\begin{align}
    \boldsymbol{B} &\equiv \boldsymbol{I}_{N} \otimes \boldsymbol{\iota}_T (\boldsymbol{\iota}'_T \boldsymbol{\iota}_T)^{-1} \boldsymbol{\iota}'_T \\
    &= \left[ \begin{array}{cc} 1 & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & 1 \end{array} \right] \otimes \left( \left[ \begin{array}{c} 1 \\ \vdots \\ 1 \end{array} \right] \left( \left[ \begin{array}{ccc} 1 & \cdots & 1 \end{array} \right] \left[ \begin{array}{c} 1 \\ \vdots \\ 1 \end{array} \right] \right)^{-1} \left[ \begin{array}{ccc} 1 & \cdots & 1 \end{array} \right] \right) \\
    &= \left[ \begin{array}{cc} 1 & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & 1 \end{array} \right] \otimes \left( \left[ \begin{array}{c} 1 \\ \vdots \\ 1 \end{array} \right] \left( T \right)^{-1} \left[ \begin{array}{ccc} 1 & \cdots & 1 \end{array} \right] \right) \\
    &= \left[ \begin{array}{cc} 1 & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & 1 \end{array} \right] \otimes \left( \left[ \begin{array}{c} 1 \\ \vdots \\ 1 \end{array} \right] \frac{1}{T} \left[ \begin{array}{ccc} 1 & \cdots & 1 \end{array} \right] \right) \\
    &= \left[ \begin{array}{cc} 1 & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & 1 \end{array} \right] \otimes \left( \frac{1}{T}  \left[ \begin{array}{c} 1 & \cdots & 1 \\ \vdots & \ddots & \vdots \\ 1 & \cdots & 1 \end{array} \right] \right) \\
    &= \left[ \begin{array}{cc} 1 & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & 1 \end{array} \right]_{N \times N}  \otimes  \left( \begin{array}{ccc} 1/T & \cdots & 1/T \\ \vdots & \ddots & \vdots\\ 1/T & \cdots & 1/T \end{array} \right)_{T \times T}  \\
    &= \left[ \begin{array}{ccc} 1 \left( \begin{array}{ccc} 1/T & \cdots & 1/T \\
    \vdots & \ddots & \vdots\\ 1/T & \cdots & 1/T \end{array} \right) & \cdots & 0 \left( \begin{array}{ccc} 1/T & \cdots & 1/T \\ \vdots & \ddots & \vdots\\ 1/T & \cdots & 1/T \end{array} \right) \\ \vdots & \ddots & \vdots \\ 0 \left( \begin{array}{ccc} 1/T & \cdots & 1/T \\ \vdots & \ddots & \vdots\\ 1/T & \cdots & 1/T \end{array} \right) & \cdots & 1 \left( \begin{array}{ccc} 1/T & \cdots & 1/T \\ \vdots & \ddots & \vdots\\ 1/T & \cdots & 1/T \end{array} \right) \end{array} \right] \\
    &= \left[ \begin{array}{rrr|r|rrr} 
        1/T & \cdots & 1/T & \cdots & 0 & \cdots & 0 \\
        \vdots & \ddots & \vdots & \cdots & \vdots & \ddots & \vdots \\
        1/T & \cdots & 1/T & \cdots & 0 & \cdots & 0 \\\hline
        \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots \\\hline
        0 & \cdots & 0 & \cdots & 1/T & \cdots & 1/T \\
        \vdots & \ddots & \vdots & \cdots & \vdots & \ddots & \vdots \\
        0 & \cdots & 0 & \cdots & 1/T & \cdots & 1/T
    \end{array} \right]_{NT \times NT},
\end{align}
<p>em que 

$\otimes$ é o produto de Kronecker. Agora, ao multiplicar por 

$T \sigma^2_u$, todos elementos 

$1/T$ tornam-se 

$\sigma^2_u$:</p>


$$ 
    T \sigma^2_u \boldsymbol{B} = \left[ \begin{array}{rrr|r|rrr} 
        \sigma^2_u & \cdots & \sigma^2_u & \cdots & 0 & \cdots & 0 \\
        \vdots & \ddots & \vdots & \cdots & \vdots & \ddots & \vdots \\
        \sigma^2_u & \cdots & \sigma^2_u & \cdots & 0 & \cdots & 0 \\\hline
        \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots \\\hline
        0 & \cdots & 0 & \cdots & \sigma^2_u & \cdots & \sigma^2_u \\
        \vdots & \ddots & \vdots & \cdots & \vdots & \ddots & \vdots \\
        0 & \cdots & 0 & \cdots & \sigma^2_u & \cdots & \sigma^2_u
    \end{array} \right]_{NT \times NT},
`$$
<p>Somando os dois termos de (4), conseguimos obter a Matriz de Variâncias-Covariâncias dos Erros:</p>


\begin{align}
    \boldsymbol{\Sigma} &= \sigma^2_v \boldsymbol{I}_{NT} + T \sigma^2_u \boldsymbol{B} \\
    &= \left[ \begin{array}{cccc} 
\sigma^2_v & 0 & \cdots & 0 \\
0 & \sigma^2_v & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & \sigma^2_v
\end{array} \right] + \left[ \begin{array}{ccc|c|ccc} 
        \sigma^2_u & \cdots & \sigma^2_u & \cdots & 0 & \cdots & 0 \\
        \vdots & \ddots & \vdots & \cdots & \vdots & \ddots & \vdots \\
        \sigma^2_u & \cdots & \sigma^2_u & \cdots & 0 & \cdots & 0 \\\hline
        \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots \\\hline
        0 & \cdots & 0 & \cdots & \sigma^2_u & \cdots & \sigma^2_u \\
        \vdots & \ddots & \vdots & \cdots & \vdots & \ddots & \vdots \\
        0 & \cdots & 0 & \cdots & \sigma^2_u & \cdots & \sigma^2_u
    \end{array} \right] \\
    &= \left[ \begin{array}{ccc|c|ccc} 
        \sigma^2_u + \sigma^2_v & \cdots & \sigma^2_u & \cdots & 0 & \cdots & 0 \\
        \vdots & \ddots & \vdots & \cdots & \vdots & \ddots & \vdots \\
        \sigma^2_u & \cdots & \sigma^2_u + \sigma^2_v & \cdots & 0 & \cdots & 0 \\\hline
        \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots \\\hline
        0 & \cdots & 0 & \cdots & \sigma^2_u + \sigma^2_v & \cdots & \sigma^2_u \\
        \vdots & \ddots & \vdots & \cdots & \vdots & \ddots & \vdots \\
        0 & \cdots & 0 & \cdots & \sigma^2_u & \cdots & \sigma^2_u + \sigma^2_v
    \end{array} \right]
\end{align}
<h5 id="exemplo-2">Exemplo</h5>
<p>Considere o caso com 

$N = 2$ e 

$T = 3$. Vamos, então, obter a seguinte Matriz de Variâncias-Covariâncias dos Erros:</p>


$$\boldsymbol{\Sigma} = \left[ \begin{array}{ccc|ccc} 
        \sigma^2_u + \sigma^2_v & \sigma^2_u & \sigma^2_u & 0 & 0 & 0 \\
        \sigma^2_u & \sigma^2_u + \sigma^2_v & \sigma^2_u & 0 & 0 & 0 \\
        \sigma^2_u & \sigma^2_u & \sigma^2_u + \sigma^2_v & 0 & 0 & 0 \\\hline
        0 & 0 & 0 & \sigma^2_u + \sigma^2_v & \sigma^2_u & \sigma^2_u \\
        0 & 0 & 0 & \sigma^2_u & \sigma^2_u + \sigma^2_v & \sigma^2_u \\
        0 & 0 & 0 & \sigma^2_u & \sigma^2_u & \sigma^2_u + \sigma^2_v
    \end{array} \right]$$
<p>Assumindo 

$\sigma^2_u = 2$ e 

$\sigma^2_v = 3$, segue que</p>


$$\boldsymbol{\Sigma} = \left[ \begin{array}{ccc|ccc} 
        5 & 2 & 2 & 0 & 0 & 0 \\
        2 & 5 & 2 & 0 & 0 & 0 \\
        2 & 2 & 5 & 0 & 0 & 0 \\\hline
        0 & 0 & 0 & 5 & 2 & 2 \\
        0 & 0 & 0 & 2 & 5 & 2 \\
        0 & 0 & 0 & 2 & 2 & 5
    \end{array} \right]$$
</br>
<p>Para calcular no R, vamos definir:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="m">2</span> <span class="c1"># número de indivíduos</span>
</span></span><span class="line"><span class="cl"><span class="bp">T</span> <span class="o">=</span> <span class="m">3</span> <span class="c1"># números de períodos</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2u</span> <span class="o">=</span> <span class="m">2</span> <span class="c1"># variância do termo de erro do indivíduo</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2v</span> <span class="o">=</span> <span class="m">3</span> <span class="c1"># variância do termo de erro idiossincrático </span>
</span></span></code></pre></div><p>O primeiro termo de 

$\boldsymbol{\Sigma}$ é</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">I_NT</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho NT</span>
</span></span><span class="line"><span class="cl"><span class="n">I_NT</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5] [,6]
</span></span><span class="line"><span class="cl">## [1,]    1    0    0    0    0    0
</span></span><span class="line"><span class="cl">## [2,]    0    1    0    0    0    0
</span></span><span class="line"><span class="cl">## [3,]    0    0    1    0    0    0
</span></span><span class="line"><span class="cl">## [4,]    0    0    0    1    0    0
</span></span><span class="line"><span class="cl">## [5,]    0    0    0    0    1    0
</span></span><span class="line"><span class="cl">## [6,]    0    0    0    0    0    1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">termo1</span> <span class="o">=</span> <span class="n">sig2v</span> <span class="o">*</span> <span class="n">I_NT</span>
</span></span><span class="line"><span class="cl"><span class="n">termo1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5] [,6]
</span></span><span class="line"><span class="cl">## [1,]    3    0    0    0    0    0
</span></span><span class="line"><span class="cl">## [2,]    0    3    0    0    0    0
</span></span><span class="line"><span class="cl">## [3,]    0    0    3    0    0    0
</span></span><span class="line"><span class="cl">## [4,]    0    0    0    3    0    0
</span></span><span class="line"><span class="cl">## [5,]    0    0    0    0    3    0
</span></span><span class="line"><span class="cl">## [6,]    0    0    0    0    0    3
</span></span></code></pre></div><p>Para o 2º termo de 

$\boldsymbol{\Sigma}$, temos que criar a matriz identidade e o vetor de 1&rsquo;s primeiro:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">iota_T</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="bp">T</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="c1"># vetor coluna de 1&#39;s de tamanho T</span>
</span></span><span class="line"><span class="cl"><span class="n">iota_T</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1]
</span></span><span class="line"><span class="cl">## [1,]    1
</span></span><span class="line"><span class="cl">## [2,]    1
</span></span><span class="line"><span class="cl">## [3,]    1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho N</span>
</span></span><span class="line"><span class="cl"><span class="n">I_N</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2]
</span></span><span class="line"><span class="cl">## [1,]    1    0
</span></span><span class="line"><span class="cl">## [2,]    0    1
</span></span></code></pre></div><p>Vamos obter 

$\boldsymbol{\iota}_T (\boldsymbol{\iota}'_T \boldsymbol{\iota}_T)^{-1} \boldsymbol{\iota}'_T$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Para obter matriz T x T preenchida por 1/T, sendo T = 3, temos que:</span>
</span></span><span class="line"><span class="cl"><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span> <span class="c1"># produto interno de iotas = quantidade T</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1]
</span></span><span class="line"><span class="cl">## [1,]    3
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="c1"># tomar a inversa = 1/T</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##           [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.3333333
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">iota_T</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="c1"># pré e pós-multiplicar por iotas</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##           [,1]      [,2]      [,3]
</span></span><span class="line"><span class="cl">## [1,] 0.3333333 0.3333333 0.3333333
</span></span><span class="line"><span class="cl">## [2,] 0.3333333 0.3333333 0.3333333
</span></span><span class="line"><span class="cl">## [3,] 0.3333333 0.3333333 0.3333333
</span></span></code></pre></div><p>Agora, vamos calcular 

$\boldsymbol{B}\ =\ I_N \otimes \boldsymbol{\iota}_T (\boldsymbol{\iota}'_T \boldsymbol{\iota}_T)^{-1} \boldsymbol{\iota}'_T$ usando o operador de produto de Kronecker <code>%x%</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="p">(</span><span class="n">iota_T</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">round</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]
</span></span><span class="line"><span class="cl">## [1,] 0.333 0.333 0.333 0.000 0.000 0.000
</span></span><span class="line"><span class="cl">## [2,] 0.333 0.333 0.333 0.000 0.000 0.000
</span></span><span class="line"><span class="cl">## [3,] 0.333 0.333 0.333 0.000 0.000 0.000
</span></span><span class="line"><span class="cl">## [4,] 0.000 0.000 0.000 0.333 0.333 0.333
</span></span><span class="line"><span class="cl">## [5,] 0.000 0.000 0.000 0.333 0.333 0.333
</span></span><span class="line"><span class="cl">## [6,] 0.000 0.000 0.000 0.333 0.333 0.333
</span></span></code></pre></div><p>Multiplicando 

$\boldsymbol{B}$ por 

$T \sigma^2_u$, obtemos o 2º termo de 

$\boldsymbol{\Sigma}$:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">termo2</span> <span class="o">=</span> <span class="bp">T</span> <span class="o">*</span> <span class="n">sig2u</span> <span class="o">*</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="n">termo2</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5] [,6]
</span></span><span class="line"><span class="cl">## [1,]    2    2    2    0    0    0
</span></span><span class="line"><span class="cl">## [2,]    2    2    2    0    0    0
</span></span><span class="line"><span class="cl">## [3,]    2    2    2    0    0    0
</span></span><span class="line"><span class="cl">## [4,]    0    0    0    2    2    2
</span></span><span class="line"><span class="cl">## [5,]    0    0    0    2    2    2
</span></span><span class="line"><span class="cl">## [6,]    0    0    0    2    2    2
</span></span></code></pre></div><p>Então, a Matriz de Variâncias-Covariâncias dos Erros é dada por:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Sigma</span> <span class="o">=</span> <span class="n">termo1</span> <span class="o">+</span> <span class="n">termo2</span>
</span></span><span class="line"><span class="cl"><span class="n">Sigma</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5] [,6]
</span></span><span class="line"><span class="cl">## [1,]    5    2    2    0    0    0
</span></span><span class="line"><span class="cl">## [2,]    2    5    2    0    0    0
</span></span><span class="line"><span class="cl">## [3,]    2    2    5    0    0    0
</span></span><span class="line"><span class="cl">## [4,]    0    0    0    5    2    2
</span></span><span class="line"><span class="cl">## [5,]    0    0    0    2    5    2
</span></span><span class="line"><span class="cl">## [6,]    0    0    0    2    2    5
</span></span></code></pre></div><h3 id="estimação-dos-componentes-de-erro">Estimação dos Componentes de Erro</h3>
<ul>
<li>
<p>Note que não temos 

$\sigma^2_v$ e 

$\sigma^2_u$ e, logo, 

$\boldsymbol{\Sigma}$ é desconhecido.</p>
</li>
<li>
<p>Primeiro, considere a <strong>matriz de transformação <em>within</em></strong>, dada por</p>
</li>
</ul>


$$ \boldsymbol{W} = \boldsymbol{I}_{NT} - \boldsymbol{B} $$
<ul>
<li>Note que podemos reescrever


\begin{align} \hat{\boldsymbol{\Sigma}} &= \hat{\sigma}^2_v \boldsymbol{I}_{NT} + T \hat{\sigma}^2_u \boldsymbol{B}\\ 
&= \hat{\sigma}^2_v (\boldsymbol{W} + \boldsymbol{B}) + T \hat{\sigma}^2_u \boldsymbol{B}\\ 
&= \hat{\sigma}^2_v \boldsymbol{W} + \hat{\sigma}^2_v \boldsymbol{B} + T \hat{\sigma}^2_u \boldsymbol{B}\\ 
&= \hat{\sigma}^2_v \boldsymbol{W} + (\hat{\sigma}^2_v + T \hat{\sigma}^2_u) \boldsymbol{B}
\end{align}
em que 

$\boldsymbol{W} = \boldsymbol{I}_{NT} - \boldsymbol{B} \iff \boldsymbol{I}_{NT} = \boldsymbol{W} + \boldsymbol{B} $</li>
</ul>
</br>
<ul>
<li>Isso pode ser generalizado para:


$$ \hat{\boldsymbol{\Sigma}}^p = (\hat{\sigma}^2_v)^p \boldsymbol{W} + (\hat{\sigma}^2_v + T \hat{\sigma}^2_u)^p \boldsymbol{B}, \tag{2.29} $$
em que 

$p$ é um escalar.</li>
<li>Essa fórmula será importante para calcularmos 

$ \hat{\boldsymbol{\Sigma}}^{-1}$ ou 

$ \hat{\boldsymbol{\Sigma}}^{-0,5}$ mais adiante.</li>
</ul>
</br>
<ul>
<li>Se 

$\boldsymbol{\varepsilon}$ fosse conhecido, então poderíamos estimar as duas variâncias usando:</li>
</ul>


\begin{align}
    \hat{\sigma}^2_v &= \frac{\boldsymbol{\varepsilon}' \boldsymbol{W} \boldsymbol{\varepsilon}}{N(T-1)} \tag{2.35} \\
    \\
    \hat{\sigma}^2_v + T \hat{\sigma}^2_u &= \frac{\boldsymbol{\varepsilon}' \boldsymbol{B} \boldsymbol{\varepsilon}}{N} \tag{2.34} \\
    \hat{\sigma}^2_u &= \frac{1}{T} \left( \frac{\boldsymbol{\varepsilon}' \boldsymbol{B} \boldsymbol{\varepsilon}}{N} - \hat{\sigma}^2_v \right)
\end{align}
<ul>
<li>
<p>Como 

$\boldsymbol{\varepsilon}$ é desconhecido, então podemos usar resíduos de estimadores consistentes em seu lugar.</p>
</li>
<li>
<p><strong>Wallace e Hussain (1969)</strong>: usam resíduos MQO</p>
</li>
</ul>


$$ \hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N(T-1)} 
    \quad \text{ e } \quad 
    \hat{\sigma}^2_u =\frac{1}{T} \left( \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N} - \hat{\sigma}^2_v \right)$$
<ul>
<li>
<p><strong>Amemiya (1971)</strong>: usa resíduos <em>within</em>


$$\hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{W}} \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{W}}}{N(T-1)}
    \quad \text{ e } \quad
    \hat{\sigma}^2_u = \frac{1}{T} \left( \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{W}} \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{W}}}{N} - \hat{\sigma}^2_v \right)$$</p>
</li>
<li>
<p><strong>Hausman e Taylor (1981)</strong>: propuseram ajuste ao método de Amemiya (1971), em que 

$\hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{W}}$ são regredidos em todas variáveis invariantes no tempo no modelo e são utilizados os resíduos dessa regressão, 

$\hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{HT}}$.</p>
</li>
<li>
<p><strong>Swamy e Arora (1972)</strong>: usam resíduos <em>between</em> e <em>within</em> para calcular:


$$\hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{W}} \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{W}}}{N(T-1) - K}
    \quad \text{ e } \quad
    \hat{\sigma}^2_u = \frac{1}{T} \left( \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{B}} \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{B}}}{N - K - 1} - \hat{\sigma}^2_v \right)$$</p>
</li>
<li>
<p><strong>Nerlove (1971)</strong>: computa 

$\sigma^2_u$ empírica dos efeitos fixos do modelo <em>within</em></p>
</li>
</ul>


\begin{align}
    \hat{u}_i &= \bar{y}_{i\cdot} - \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{W}}\bar{x}_{i\cdot} \\
    \hat{\sigma}^2_u &= \sum^N_{i=1}{(\hat{u}_i - \bar{\hat{u}}) / (N-1)} \\
    \hat{\sigma}^2_v &= \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{W}}\boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{W}}}{NT}
\end{align}
<p>Após obter 

$\hat{\sigma}^2_u$ e 

$\hat{\sigma}^2_v$, só precisamos calcular 

$\hat{\boldsymbol{\Sigma}}$:</p>
</br>
<!-- ## Estimadores MQO em painel -->
<!-- - Supomos que ambos componentes de erros são não-correlacionados com as covariadas: -->
<!-- 

$$ E(u|X) = E(v|X) = 0 $$ -->
<!-- - A variabilidade em um painel tem 2 componentes: -->
<!--     - a _between_ ou inter-indivíduos, em que a variabilidade das variáveis são mensuradas em médias individuais, como 

$\bar{z}_i$ ou na forma matricial 

$BZ$ -->
<!--     - a _within_ ou intra-indivíduos, em que a variabilidade das variáveis são mensuradas em desvios das médias individuais, como 

$z_{it} - \bar{z}_i$ ou na forma matricial 

$\boldsymbol{WX} = \boldsymbol{X} - \boldsymbol{BX}$ -->
<!--     - Lembre-se que 

$\boldsymbol{X} \equiv (\boldsymbol{\iota}, X)$ -->
<!-- - Há três estimadores por MQO que podem ser utilizados: -->
<!--     1. *Mínimos Quadrados Empilhados (MQE)*: usando a base de dados bruta (empilhada) -->
<!--     2. *Estimador Between*: usando as médias individuais -->
<!--     3. *Estimador Within (Efeitos Fixos)*: usando os desvios das médias individuais -->
<h2 id="estimador-mqe">Estimador MQE</h2>
<ul>
<li>Seção 2.1.1 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</li>
<li>Mínimos Quadrados Empilhados (MQE) faz a estimação igual ao MQO, porém a inferência considera 

$\boldsymbol{\Sigma} \neq \sigma^2 \boldsymbol{I}$, considera correlação entre as observações de um mesmo indivíduo 

$i$.</li>
</ul>
<p>O modelo a ser estimado é


$$ \boldsymbol{y} = \boldsymbol{X\beta} + \boldsymbol{\varepsilon} $$</p>
<ul>
<li>
<p>O estimador 

$\hat{\boldsymbol{\beta}}$ de MQE (igual ao de MQO) é dado por


$$ \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQE}} = (\boldsymbol{X}'\boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{y} $$</p>
</li>
<li>
<p>Note que a Matriz de Variâncias-Covariâncias do Estimador de MQO, que supõe 

$ \boldsymbol{\Sigma} = \sigma^2 \boldsymbol{I} $, simplifica para:</p>
</li>
</ul>


\begin{align} V(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQO}}) 
&= (\boldsymbol{X}'\boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{\Sigma} \boldsymbol{X} (\boldsymbol{X}'\boldsymbol{X})^{-1} \\ 
&= (\boldsymbol{X}'\boldsymbol{X})^{-1} \boldsymbol{X}' \left[ \sigma^2 \boldsymbol{I} \right] \boldsymbol{X} (\boldsymbol{X}'\boldsymbol{X})^{-1} \\
&= \sigma^2 (\boldsymbol{X}'\boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{X} (\boldsymbol{X}'\boldsymbol{X})^{-1} \\
&= \hat{\sigma}^2 (\boldsymbol{X}'\boldsymbol{X})^{-1} \end{align}
<ul>
<li>A Matriz de Variâncias-Covariâncias do Estimador de MQE, que considera a correlação entre observações de um mesmo indivíduo, é dada por


$$ V(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQE}}) = (\boldsymbol{X}'\boldsymbol{X})^{-1} \boldsymbol{X}' \hat{\boldsymbol{\Sigma}} \boldsymbol{X} (\boldsymbol{X}'\boldsymbol{X})^{-1} $$</li>
</ul>
<h3 id="estimação-via-plm">Estimação via <code>plm()</code></h3>
<p>Para ilustrar as estimações MQO dos estimadores vistos anteriormente, usaremos a base de dados <code>TobinQ</code> do pacote <code>pder</code>, que conta com dados de 188 firmas por 35 anos (6580 observações).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span> <span class="o">=</span> <span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">str</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## &#39;data.frame&#39;:	6580 obs. of  15 variables:
</span></span><span class="line"><span class="cl">##  $ cusip : int  2824 2824 2824 2824 2824 2824 2824 2824 2824 2824 ...
</span></span><span class="line"><span class="cl">##  $ year  : num  1951 1952 1953 1954 1955 ...
</span></span><span class="line"><span class="cl">##  $ isic  : int  2835 2835 2835 2835 2835 2835 2835 2835 2835 2835 ...
</span></span><span class="line"><span class="cl">##  $ ikb   : num  0.2295 0.0403 0.0404 0.0518 0.055 ...
</span></span><span class="line"><span class="cl">##  $ ikn   : num  0.2049 0.1997 0.1103 0.1258 0.0682 ...
</span></span><span class="line"><span class="cl">##  $ qb    : num  5.61 6.01 4.19 4 4.47 ...
</span></span><span class="line"><span class="cl">##  $ qn    : num  10.91 12.23 7.41 6.78 7.37 ...
</span></span><span class="line"><span class="cl">##  $ kstock: num  27.3 30.5 31.7 32.6 32.3 ...
</span></span><span class="line"><span class="cl">##  $ ikicb : num  NA 0.193156 0.002919 -0.007656 -0.000145 ...
</span></span><span class="line"><span class="cl">##  $ ikicn : num  0.012 0.02448 0.09763 -0.00635 0.06144 ...
</span></span><span class="line"><span class="cl">##  $ omphi : num  0.1841 0.0968 0.0745 0.0727 0.0558 ...
</span></span><span class="line"><span class="cl">##  $ qicb  : num  NA 0.245 1.9 0.421 -0.166 ...
</span></span><span class="line"><span class="cl">##  $ qicn  : num  NA 0.066 4.685 0.947 -0.135 ...
</span></span><span class="line"><span class="cl">##  $ sb    : num  NA 1.98 1.55 1.65 1.64 ...
</span></span><span class="line"><span class="cl">##  $ sn    : num  NA 4.02 3.3 3.09 2.94 ...
</span></span></code></pre></div><ul>
<li><code>cusip</code>: Identificador da empresa</li>
<li><code>year</code>: Ano</li>
<li><code>ikn</code>: Investimento dividido pelo capital</li>
<li><code>qn</code>: Q de Tobin (razão entre valor da firma e o custo de reposição de seu capital físico). Se 

$Q > 1$, então o lucro do investimento é maior do que seu custo.</li>
</ul>
<p>Queremos estimar o seguinte modelo:


$$ \text{ikn} = \beta_0 + \text{qn} \beta_1 + \varepsilon $$</p>
<p>Usaremos a função <code>plm()</code> (do pacote de mesmo nome) para estimar modelos lineares em dados em painel. Seus principais argumentos são:</p>
<ul>
<li><code>formula</code>: equação do modelo</li>
<li><code>data</code>: base de dados em <code>data.frame</code> (precisa preencher <code>index</code>) ou <code>pdata.frame</code> (formato próprio do pacote que já indexa as colunas de indivíduos e de tempo)</li>
<li><code>model</code>: estimador a ser computado &lsquo;pooling&rsquo; (MQE), &lsquo;between&rsquo;, &lsquo;within&rsquo; (Efeitos Fixos) ou &lsquo;random&rsquo; (Efeitos Aleatórios/MQGF)</li>
<li><code>index</code>: vetor de nomes das colunas dos identificadores de indivíduo e de tempo</li>
</ul>
<p>Note que a estimação do MQE (<em>pooled</em>) via <code>plm()</code>, faz a estimação considerando 

$\boldsymbol{\Sigma} = \sigma^2 \boldsymbol{I}$ e, portanto, estará erroneamente desconsiderando as correlações entre erros de um mesmo indivíduo:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">plm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Transformando no formato pdata frame, com indentificador de indivíduo e de tempo</span>
</span></span><span class="line"><span class="cl"><span class="n">pTobinQ</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;cusip&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimação MQO</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.pooling</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;pooling&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.ols</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">TobinQ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Comparando ambos outputs</span>
</span></span><span class="line"><span class="cl"><span class="n">stargazer</span><span class="o">::</span><span class="nf">stargazer</span><span class="p">(</span><span class="n">Q.pooling</span><span class="p">,</span> <span class="n">Q.ols</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">,</span> <span class="n">omit.stat</span><span class="o">=</span><span class="s">&#34;f&#34;</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## ================================================
</span></span><span class="line"><span class="cl">##                         Dependent variable:     
</span></span><span class="line"><span class="cl">##                     ----------------------------
</span></span><span class="line"><span class="cl">##                                 ikn             
</span></span><span class="line"><span class="cl">##                       panel           OLS       
</span></span><span class="line"><span class="cl">##                       linear                    
</span></span><span class="line"><span class="cl">##                        (1)            (2)       
</span></span><span class="line"><span class="cl">## ------------------------------------------------
</span></span><span class="line"><span class="cl">## qn                   0.004***      0.004***     
</span></span><span class="line"><span class="cl">##                      (0.0002)      (0.0002)     
</span></span><span class="line"><span class="cl">##                                                 
</span></span><span class="line"><span class="cl">## Constant             0.158***      0.158***     
</span></span><span class="line"><span class="cl">##                      (0.001)        (0.001)     
</span></span><span class="line"><span class="cl">##                                                 
</span></span><span class="line"><span class="cl">## ------------------------------------------------
</span></span><span class="line"><span class="cl">## Observations          6,580          6,580      
</span></span><span class="line"><span class="cl">## R2                    0.111          0.111      
</span></span><span class="line"><span class="cl">## Adjusted R2           0.111          0.111      
</span></span><span class="line"><span class="cl">## Residual Std. Error            0.086 (df = 6578)
</span></span><span class="line"><span class="cl">## ================================================
</span></span><span class="line"><span class="cl">## Note:                *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
</span></span></code></pre></div><ul>
<li>Precisamos fazer a inferência considerando uma Matriz de Variâncias-Covariâncias dos Erros apropriada. Para isto, vamos usar o argumento <code>vcov=vcovBK</code> dentro da função <code>summary()</code>:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Estimação MQE - matriz de var-cov dos erros com correlação intra-indiv</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.pooling</span><span class="p">,</span> <span class="n">vcov</span><span class="o">=</span><span class="n">vcovBK</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               Estimate   Std. Error  t-value     Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## (Intercept) 0.15799969 0.0034686968 45.55016 0.000000e+00
</span></span><span class="line"><span class="cl">## qn          0.00439197 0.0003774606 11.63557 5.458161e-31
</span></span></code></pre></div><h3 id="estimação-analítica">Estimação Analítica</h3>
<p>A estimação analítica do MQE é equivalente ao MQO vista anteriormente, mas no contexto de dados em painel. As principais diferenças são: o número de graus de liberdade é 

$NT - K - 1$ (pois possui 

$NT$ observações) e a modelagem da matriz de variâncias-covariâncias dos erros, 

$\boldsymbol{\Sigma}$, para o contexto de painel.</p>
<p>a) Criando vetores/matrizes e definindo <em>N</em>, <em>T</em> e <em>K</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Criando o vetor y</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">TobinQ[</span><span class="p">,</span><span class="s">&#34;ikn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="c1"># transformando coluna de data frame em matriz</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##            [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.20488372
</span></span><span class="line"><span class="cl">## [2,] 0.19974634
</span></span><span class="line"><span class="cl">## [3,] 0.11033265
</span></span><span class="line"><span class="cl">## [4,] 0.12583384
</span></span><span class="line"><span class="cl">## [5,] 0.06819211
</span></span><span class="line"><span class="cl">## [6,] 0.09540332
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Criando a matriz de covariadas X com primeira coluna de 1&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="nf">cbind</span><span class="p">(</span> <span class="m">1</span><span class="p">,</span> <span class="n">TobinQ[</span><span class="p">,</span> <span class="s">&#34;qn&#34;</span><span class="n">]</span> <span class="p">)</span> <span class="c1"># juntando 1&#39;s com as covariadas</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># transformando em matriz</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1]      [,2]
</span></span><span class="line"><span class="cl">## [1,]    1 10.910007
</span></span><span class="line"><span class="cl">## [2,]    1 12.234629
</span></span><span class="line"><span class="cl">## [3,]    1  7.410110
</span></span><span class="line"><span class="cl">## [4,]    1  6.779812
</span></span><span class="line"><span class="cl">## [5,]    1  7.372266
</span></span><span class="line"><span class="cl">## [6,]    1  6.097779
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Pegando valores N, T e K</span>
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">cusip</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="c1"># nº de indivíduos i</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 188
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="bp">T</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">year</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="bp">T</span> <span class="c1"># nº de períodos t</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 35
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">K</span> <span class="o">=</span> <span class="nf">ncol</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span> <span class="c1"># nº de covariadas</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 1
</span></span></code></pre></div><p>b) Estimativas de MQE 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQE}}$</p>


$$ \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQE}} = (\boldsymbol{X}'\boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{y} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bhat</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="n">bhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##            [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.15799969
</span></span><span class="line"><span class="cl">## [2,] 0.00439197
</span></span></code></pre></div><p>c) Valores ajustados/preditos 

$\hat{\boldsymbol{y}}$</p>


$$ \hat{\boldsymbol{y}} = \boldsymbol{X} \hat{\boldsymbol{\beta}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat</span> <span class="o">=</span> <span class="n">X</span> <span class="o">%*%</span> <span class="n">bhat</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##           [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.2059161
</span></span><span class="line"><span class="cl">## [2,] 0.2117338
</span></span><span class="line"><span class="cl">## [3,] 0.1905447
</span></span><span class="line"><span class="cl">## [4,] 0.1877764
</span></span><span class="line"><span class="cl">## [5,] 0.1903785
</span></span><span class="line"><span class="cl">## [6,] 0.1847810
</span></span></code></pre></div><p>d) Resíduos 

$\hat{\boldsymbol{\varepsilon}}$</p>


$$ \hat{\boldsymbol{\varepsilon}} = \boldsymbol{y} - \hat{\boldsymbol{y}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ehat</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">yhat</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">ehat</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## [1,] -0.001032395
</span></span><span class="line"><span class="cl">## [2,] -0.011987475
</span></span><span class="line"><span class="cl">## [3,] -0.080212022
</span></span><span class="line"><span class="cl">## [4,] -0.061942582
</span></span><span class="line"><span class="cl">## [5,] -0.122186352
</span></span><span class="line"><span class="cl">## [6,] -0.089377633
</span></span></code></pre></div><p>e) Variâncias dos termos de erro</p>


\begin{align} \hat{\sigma}^2_v &= \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N(T-1)} \\
    \hat{\sigma}^2_u &=\frac{1}{T} \left( \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N} - \hat{\sigma}^2_v \right) \end{align}
<p>Como 

$\hat{\sigma}^2_u$ e 

$\hat{\sigma}^2_v$ são escalares, é conveniente transformar as &ldquo;matrizes 1x1&rdquo; em números usando <code>as.numeric()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Criando matrizes between e within</span>
</span></span><span class="line"><span class="cl"><span class="n">iota_T</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="bp">T</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="c1"># vetor coluna de 1&#39;s de tamanho T</span>
</span></span><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho N</span>
</span></span><span class="line"><span class="cl"><span class="n">I_NT</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho NT</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="p">(</span><span class="n">iota_T</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">W</span> <span class="o">=</span> <span class="n">I_NT</span> <span class="o">-</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Calculando variâncias dos termos de erro (Wallace &amp; Hussain)</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2v</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">ehat</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="bp">T</span><span class="m">-1</span><span class="p">))</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2u</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="bp">T</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">ehat</span><span class="p">)</span><span class="o">/</span><span class="n">N</span> <span class="o">-</span> <span class="n">sig2v</span> <span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><p>f) Matriz de Variâncias-Covariâncias dos Erros


$$\hat{\boldsymbol{\Sigma}} = \hat{\sigma}^2_v \boldsymbol{W} + (\hat{\sigma}^2_v + T \hat{\sigma}^2_u) \boldsymbol{B}$$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de Variâncias-Covariâncias dos Erros</span>
</span></span><span class="line"><span class="cl"><span class="n">Sigma</span> <span class="o">=</span> <span class="n">sig2v</span> <span class="o">*</span> <span class="n">W</span> <span class="o">+</span> <span class="p">(</span><span class="n">sig2v</span> <span class="o">+</span> <span class="bp">T</span><span class="o">*</span><span class="n">sig2u</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span>
</span></span></code></pre></div><p>g) Matriz de Variâncias-Covariâncias do Estimador</p>


$$ \widehat{\text{Var}}(\hat{\boldsymbol{\beta}}) = (\boldsymbol{X}'\boldsymbol{X})^{-1} \boldsymbol{X}' \hat{\boldsymbol{\Sigma}} \boldsymbol{X} (\boldsymbol{X}'\boldsymbol{X})^{-1} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de variância-covariância dos estimadores</span>
</span></span><span class="line"><span class="cl"><span class="n">bread</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">meat</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">Sigma</span> <span class="o">%*%</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat</span> <span class="o">=</span> <span class="n">bread</span> <span class="o">%*%</span> <span class="n">meat</span> <span class="o">%*%</span> <span class="n">bread</span> <span class="c1"># sandwich</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]          [,2]
</span></span><span class="line"><span class="cl">## [1,]  1.220549e-05 -2.839164e-07
</span></span><span class="line"><span class="cl">## [2,] -2.839164e-07  1.133241e-07
</span></span></code></pre></div><p>h) Erros-padrão do estimador 

$\text{se}(\hat{\boldsymbol{\beta}})$</p>
<p>É a raiz quadrada da diagonal principal da Matriz de Variâncias-Covariâncias do Estimador</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_bhat</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vbhat</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">se_bhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.0034936352 0.0003366365
</span></span></code></pre></div><p>i) Estatística <em>t</em></p>


$$ t_{\hat{\beta}_k} = \frac{\hat{\beta}_k}{\text{se}(\hat{\beta}_k)} \tag{4.6}
$$ 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Cálculo da estatística t</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat</span> <span class="o">=</span> <span class="n">bhat</span> <span class="o">/</span> <span class="n">se_bhat</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##          [,1]
</span></span><span class="line"><span class="cl">## [1,] 45.22501
</span></span><span class="line"><span class="cl">## [2,] 13.04663
</span></span></code></pre></div><p>j) P-valor</p>


$$ p_{\hat{\beta}_k} = 2.\Phi_{t_{(NT-K-1)}}(-|t_{\hat{\beta}_k}|), \tag{4.7} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># p-valor</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_bhat</span><span class="p">),</span> <span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="o">-</span><span class="n">K</span><span class="m">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.000000e+00
</span></span><span class="line"><span class="cl">## [2,] 1.986019e-38
</span></span></code></pre></div><p>k) Tabela-resumo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">bhat</span><span class="p">,</span> <span class="n">se_bhat</span><span class="p">,</span> <span class="n">t_bhat</span><span class="p">,</span> <span class="n">p_bhat</span><span class="p">)</span> <span class="c1"># resultado MQE correto</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                      se_bhat                      
</span></span><span class="line"><span class="cl">## [1,] 0.15799969 0.0034936352 45.22501 0.000000e+00
</span></span><span class="line"><span class="cl">## [2,] 0.00439197 0.0003366365 13.04663 1.986019e-38
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.pooling</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># resultado MQO via plm() ou lm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               Estimate  Std. Error   t-value      Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## (Intercept) 0.15799969 0.001124399 140.51928  0.000000e+00
</span></span><span class="line"><span class="cl">## qn          0.00439197 0.000152940  28.71694 5.789663e-171
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.pooling</span><span class="p">,</span> <span class="n">vcov</span><span class="o">=</span><span class="n">vcovBK</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># com matriz cov erros ajustada</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               Estimate   Std. Error  t-value     Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## (Intercept) 0.15799969 0.0034686968 45.55016 0.000000e+00
</span></span><span class="line"><span class="cl">## qn          0.00439197 0.0003774606 11.63557 5.458161e-31
</span></span></code></pre></div></br>
<h2 id="estimador-mqgf">Estimador MQGF</h2>
<ul>
<li>
<p>Seção 2.3 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</p>
</li>
<li>
<p>Também conhecido como <strong>estimador de efeitos aleatórios</strong>, pois considera que os efeitos individuais são aleatórios: 

$E(\boldsymbol{u}) = 0$</p>
</li>
<li>
<p>Erros são relacionados pela Matriz de Variâncias-Covariâncias dos Erros 

$\boldsymbol{\Sigma}$.</p>
</li>
<li>
<p>O estimador de MQGF é dado por


$$ {\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}} = (\boldsymbol{X}' {\boldsymbol{\Sigma}}^{-1} \boldsymbol{X})^{-1} (\boldsymbol{X}' {\boldsymbol{\Sigma}}^{-1} \boldsymbol{y}) \tag{2.27} $$</p>
</li>
<li>
<p>A matriz de variâncias-covariâncias do estimador é dada por


$$ V(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}}) = (\boldsymbol{X}' \boldsymbol{\Sigma}^{-1} \boldsymbol{X})^{-1} \tag{2.28} $$</p>
</li>
<li>
<p>A matriz 

$\boldsymbol{\Sigma}$ depende apenas de dois parâmetros: 

$\sigma^2_u$ e 

$\sigma^2_v$, temos:


$$ \boldsymbol{\Sigma}^p = ({\sigma}^2_v)^p \boldsymbol{W} + ({\sigma}^2_v + T {\sigma}^2_u)^p \boldsymbol{B} \tag{2.29} $$</p>
</li>
</ul>
</br>
<ul>
<li>Como desconhecemos 

$\boldsymbol{\Sigma}$, podemos calcular 

$\boldsymbol{\hat{\Sigma}}$ por meio da estimação dos componentes de erro usando, por exemplo, Wallace e Hussain (1969):</li>
</ul>


$$ \hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N(T-1)} 
    \quad \text{ e } \quad 
    \hat{\sigma}^2_u =\frac{1}{T} \left( \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N} - \hat{\sigma}^2_v \right)$$
<h3 id="estimação-via-plm-1">Estimação via <code>plm()</code></h3>
<ul>
<li>Usaremos novamente a função <code>plm()</code>, mas definiremos <code>model = random</code> para que seja estimado via MQGF</li>
<li>em <code>random.method</code> podemos escolher o método de cálculo dos parâmetros de erro:
<ol>
<li><code>&quot;walhus&quot;</code> para Wallace e Hussain (1969)</li>
<li><code>&quot;amemiya&quot;</code> para Amemiya (1971)</li>
<li><code>&quot;ht&quot;</code> para Hausman e Taylor (1981)</li>
<li><code>&quot;swar&quot;</code> para Swamy e Arora (1972) [padrão]</li>
<li><code>&quot;nerlove&quot;</code> para Nerlove (1971)</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">plm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span> <span class="o">=</span> <span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pTobinQ</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;cusip&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimações MQGF</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.walhus</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;random&#34;</span><span class="p">,</span> <span class="n">random.method</span> <span class="o">=</span> <span class="s">&#34;walhus&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.amemiya</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;random&#34;</span><span class="p">,</span> <span class="n">random.method</span> <span class="o">=</span> <span class="s">&#34;amemiya&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.ht</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;random&#34;</span><span class="p">,</span> <span class="n">random.method</span> <span class="o">=</span> <span class="s">&#34;ht&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.swar</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;random&#34;</span><span class="p">,</span> <span class="n">random.method</span> <span class="o">=</span> <span class="s">&#34;swar&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.nerlove</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;random&#34;</span><span class="p">,</span> <span class="n">random.method</span> <span class="o">=</span> <span class="s">&#34;nerlove&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Resumindo 5 estimações em única tabela</span>
</span></span><span class="line"><span class="cl"><span class="n">stargazer</span><span class="o">::</span><span class="nf">stargazer</span><span class="p">(</span><span class="n">Q.walhus</span><span class="p">,</span> <span class="n">Q.amemiya</span><span class="p">,</span> <span class="n">Q.ht</span><span class="p">,</span> <span class="n">Q.swar</span><span class="p">,</span> <span class="n">Q.nerlove</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">digits</span><span class="o">=</span><span class="m">5</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">,</span> <span class="n">omit.stat</span><span class="o">=</span><span class="s">&#34;f&#34;</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## ===================================================================
</span></span><span class="line"><span class="cl">##                               Dependent variable:                  
</span></span><span class="line"><span class="cl">##              ------------------------------------------------------
</span></span><span class="line"><span class="cl">##                                       ikn                          
</span></span><span class="line"><span class="cl">##                 (1)        (2)        (3)        (4)        (5)    
</span></span><span class="line"><span class="cl">## -------------------------------------------------------------------
</span></span><span class="line"><span class="cl">## qn           0.00386*** 0.00386*** 0.00386*** 0.00386*** 0.00386***
</span></span><span class="line"><span class="cl">##              (0.00017)  (0.00017)  (0.00017)  (0.00017)  (0.00017) 
</span></span><span class="line"><span class="cl">##                                                                    
</span></span><span class="line"><span class="cl">## Constant     0.15933*** 0.15933*** 0.15933*** 0.15933*** 0.15934***
</span></span><span class="line"><span class="cl">##              (0.00341)  (0.00344)  (0.00344)  (0.00342)  (0.00361) 
</span></span><span class="line"><span class="cl">##                                                                    
</span></span><span class="line"><span class="cl">## -------------------------------------------------------------------
</span></span><span class="line"><span class="cl">## Observations   6,580      6,580      6,580      6,580      6,580   
</span></span><span class="line"><span class="cl">## R2            0.07418    0.07412    0.07412    0.07415    0.07376  
</span></span><span class="line"><span class="cl">## Adjusted R2   0.07404    0.07398    0.07398    0.07401    0.07362  
</span></span><span class="line"><span class="cl">## ===================================================================
</span></span><span class="line"><span class="cl">## Note:                                   *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
</span></span></code></pre></div><p>Neste caso específico, os resultados são praticamente idênticos.</p>
<h3 id="estimação-analítica-1">Estimação Analítica</h3>
<ul>
<li>Aqui, faremos a estimação analítica do MQGF usando o método de Wallace e Hussain (1969).</li>
<li>Primeiro, precisamos encontrar 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQO}}$ e 

$\hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}$, para estimar 

$\hat{\sigma}^2_{u}$, 

$\hat{\sigma}^2_{v}$ e 

$\hat{\boldsymbol{\Sigma}}$</li>
<li>Depois, fazemos a estimação de 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}}$ e de 

$V_{\hat{\boldsymbol{\beta}}_{\tiny{MQGF}}}$</li>
</ul>
<p>a) Criando vetores/matrizes e definindo <em>N</em>, <em>T</em> e <em>K</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Criando o vetor y</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">TobinQ[</span><span class="p">,</span><span class="s">&#34;ikn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="c1"># transformando coluna de data frame em matriz</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando a matriz de covariadas X com primeira coluna de 1&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span> <span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">TobinQ[</span><span class="p">,</span> <span class="s">&#34;qn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># juntando 1&#39;s com as covariadas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pegando valores N, T e K</span>
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">cusip</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="bp">T</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">year</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span> <span class="o">=</span> <span class="nf">ncol</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span>
</span></span></code></pre></div><p>b) Estimativas de MQO 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQO}}$</p>


$$ \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQO}} = (\boldsymbol{X}'\boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{y} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bhat_OLS</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span></code></pre></div><p>c) Valores ajustados/preditos de MQO 

$\hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}}$</p>


$$ \hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}} = \boldsymbol{X} \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQO}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat_OLS</span> <span class="o">=</span> <span class="n">X</span> <span class="o">%*%</span> <span class="n">bhat_OLS</span>
</span></span></code></pre></div><p>d) Resíduos de MQO 

$\hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}$</p>


$$ \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}} = \boldsymbol{y} - \hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ehat_OLS</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">yhat_OLS</span>
</span></span></code></pre></div><p>e) Variâncias dos termos de erro</p>


\begin{align} \hat{\sigma}^2_v &= \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N(T-1)} \\
    \hat{\sigma}^2_u &=\frac{1}{T} \left( \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N} - \hat{\sigma}^2_v \right) \end{align}
<p>Como 

$\hat{\sigma}^2_u$ e 

$\hat{\sigma}^2_v$ são escalares, é conveniente transformar as &ldquo;matrizes 1x1&rdquo; em números usando <code>as.numeric()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Criando matrizes between e within</span>
</span></span><span class="line"><span class="cl"><span class="n">iota_T</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="bp">T</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="c1"># vetor coluna de 1&#39;s de tamanho T</span>
</span></span><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho N</span>
</span></span><span class="line"><span class="cl"><span class="n">I_NT</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho NT</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="p">(</span><span class="n">iota_T</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">W</span> <span class="o">=</span> <span class="n">I_NT</span> <span class="o">-</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Calculando variâncias dos termos de erro (Wallace &amp; Hussain)</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2v</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="bp">T</span><span class="m">-1</span><span class="p">))</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2u</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="bp">T</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">ehat_OLS</span><span class="p">)</span><span class="o">/</span><span class="n">N</span> <span class="o">-</span> <span class="n">sig2v</span> <span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><p>f) Matriz de Variâncias-Covariâncias dos Erros</p>


$$ \hat{\boldsymbol{\Sigma}}^p = (\hat{\sigma}^2_v)^p \boldsymbol{W} + (\hat{\sigma}^2_v + T \hat{\sigma}^2_u)^p \boldsymbol{B} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de Variâncias-Covariâncias dos Erros</span>
</span></span><span class="line"><span class="cl"><span class="n">Sigma</span> <span class="o">=</span> <span class="n">sig2v</span> <span class="o">*</span> <span class="n">W</span> <span class="o">+</span> <span class="p">(</span><span class="n">sig2v</span> <span class="o">+</span> <span class="bp">T</span><span class="o">*</span><span class="n">sig2u</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Inversa da Matriz</span>
</span></span><span class="line"><span class="cl"><span class="n">Sigma_1</span> <span class="o">=</span> <span class="n">sig2v</span><span class="nf">^</span><span class="p">(</span><span class="m">-1</span><span class="p">)</span> <span class="o">*</span> <span class="n">W</span> <span class="o">+</span> <span class="p">(</span><span class="n">sig2v</span> <span class="o">+</span> <span class="bp">T</span><span class="o">*</span><span class="n">sig2u</span><span class="p">)</span><span class="nf">^</span><span class="p">(</span><span class="m">-1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span>
</span></span></code></pre></div><p>*Note que usar <code>solve()</code> na matriz <code>Sigma</code> demora mais tempo de processamento do que usar a fórmula</p>
<p>g) Estimativas de MQGF 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}}$</p>


$$ \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}} = (\boldsymbol{X}' \boldsymbol{\Sigma}^{-1} \boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{\Sigma}^{-1} \boldsymbol{y} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bhat_FGLS</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">Sigma_1</span> <span class="o">%*%</span> <span class="n">X</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">Sigma_1</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="n">bhat_FGLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.159325869
</span></span><span class="line"><span class="cl">## [2,] 0.003862631
</span></span></code></pre></div><p>h) Matriz de Variâncias-Covariâncias do Estimador</p>


$$ \widehat{\text{Var}}(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}}) = (\boldsymbol{X}' \boldsymbol{\Sigma}^{-1} \boldsymbol{X})^{-1} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de variância-covariância dos estimadores</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">Sigma_1</span> <span class="o">%*%</span> <span class="n">X</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]          [,2]
</span></span><span class="line"><span class="cl">## [1,]  1.167208e-05 -7.100808e-08
</span></span><span class="line"><span class="cl">## [2,] -7.100808e-08  2.834259e-08
</span></span></code></pre></div><p>i) Erros-padrão do estimador 

$\text{se}(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}})$</p>
<p>É a raiz quadrada da diagonal principal da Matriz de Variâncias-Covariâncias do Estimador</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_bhat</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vbhat</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">se_bhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.0034164422 0.0001683526
</span></span></code></pre></div><p>j) Estatística <em>t</em></p>


$$ t_{\hat{\beta}_k} = \frac{\hat{\beta}_k}{\text{se}(\hat{\beta}_k)} \tag{4.6}
$$ 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Cálculo da estatística t</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat</span> <span class="o">=</span> <span class="n">bhat_FGLS</span> <span class="o">/</span> <span class="n">se_bhat</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##          [,1]
</span></span><span class="line"><span class="cl">## [1,] 46.63503
</span></span><span class="line"><span class="cl">## [2,] 22.94370
</span></span></code></pre></div><p>k) P-valor</p>


$$ p_{\hat{\beta}_k} = 2.\Phi_{t_{(NT-K-1)}}(-|t_{\hat{\beta}_k}|), \tag{4.7} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># p-valor</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_bhat</span><span class="p">),</span> <span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="o">-</span><span class="n">K</span><span class="m">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]
</span></span><span class="line"><span class="cl">## [1,]  0.000000e+00
</span></span><span class="line"><span class="cl">## [2,] 3.904386e-112
</span></span></code></pre></div><p>l) Tabela-resumo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">bhat_FGLS</span><span class="p">,</span> <span class="n">se_bhat</span><span class="p">,</span> <span class="n">t_bhat</span><span class="p">,</span> <span class="n">p_bhat</span><span class="p">)</span> <span class="c1"># resultado MQE correto</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                       se_bhat                       
</span></span><span class="line"><span class="cl">## [1,] 0.159325869 0.0034164422 46.63503  0.000000e+00
</span></span><span class="line"><span class="cl">## [2,] 0.003862631 0.0001683526 22.94370 3.904386e-112
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.walhus</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># resultado MQGF via plm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                Estimate   Std. Error  z-value      Pr(&gt;|z|)
</span></span><span class="line"><span class="cl">## (Intercept) 0.159325869 0.0034143937 46.66300  0.000000e+00
</span></span><span class="line"><span class="cl">## qn          0.003862631 0.0001682516 22.95747 1.240977e-116
</span></span></code></pre></div><h4 id="transformando-e-estimando-por-mqo">Transformando e estimando por MQO</h4>
<p>Além da forma mostrada anteriormente, podemos também transformar as variáveis e resolver por MQO, pré-multiplicando 

$\boldsymbol{X}$ e 

$\boldsymbol{y}$ por 

$ \boldsymbol{\Sigma}^{-0.5}$, e definindo:</p>


$$\tilde{\boldsymbol{X}} \equiv \boldsymbol{\Sigma}^{-0.5} \boldsymbol{X} \qquad \text{e} \qquad \tilde{\boldsymbol{y}} \equiv \boldsymbol{\Sigma}^{-0.5} \boldsymbol{y}$$
<p>f&rsquo;) Matriz de Variâncias-Covariâncias dos Erros</p>


$$ \hat{\boldsymbol{\Sigma}}^p = (\hat{\sigma}^2_v)^p \boldsymbol{W} + (\hat{\sigma}^2_v + T \hat{\sigma}^2_u)^p \boldsymbol{B} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Matriz de Variâncias-Covariâncias dos Erros ^ (-0.5)</span>
</span></span><span class="line"><span class="cl"><span class="n">Sigma_05</span> <span class="o">=</span> <span class="n">sig2v</span><span class="nf">^</span><span class="p">(</span><span class="m">-0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">W</span> <span class="o">+</span> <span class="p">(</span><span class="n">sig2v</span> <span class="o">+</span> <span class="bp">T</span><span class="o">*</span><span class="n">sig2u</span><span class="p">)</span><span class="nf">^</span><span class="p">(</span><span class="m">-0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Variáveis transformadas</span>
</span></span><span class="line"><span class="cl"><span class="n">X_til</span> <span class="o">=</span> <span class="n">Sigma_05</span> <span class="o">%*%</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl"><span class="n">y_til</span> <span class="o">=</span> <span class="n">Sigma_05</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span></code></pre></div><p>g&rsquo;) Estimativas de MQGF via MQO</p>


\begin{align} \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}} &= (\boldsymbol{X}' \boldsymbol{\Sigma}^{-1} \boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{\Sigma}^{-1} \boldsymbol{y} \\
&= (\boldsymbol{X}' \boldsymbol{\Sigma}^{-0.5} \boldsymbol{\Sigma}^{-0.5} \boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{\Sigma}^{-0.5} \boldsymbol{\Sigma}^{-0.5} \boldsymbol{y} \\
&= (\boldsymbol{X}' \boldsymbol{\Sigma}'^{-0.5} \boldsymbol{\Sigma}^{-0.5} \boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{\Sigma}'^{-0.5} \boldsymbol{\Sigma}^{-0.5} \boldsymbol{y} \\
&= ([\boldsymbol{\Sigma}^{-0.5} \boldsymbol{X}]' [\boldsymbol{\Sigma}^{-0.5} \boldsymbol{X}])^{-1} [\boldsymbol{\Sigma}^{-0.5} \boldsymbol{X}]' [\boldsymbol{\Sigma}^{-0.5} \boldsymbol{y}] \\
&\equiv (\tilde{\boldsymbol{X}}' \tilde{\boldsymbol{X}})^{-1} \tilde{\boldsymbol{X}}' \tilde{\boldsymbol{y}}= \tilde{\hat{\boldsymbol{\beta}}}_{\scriptscriptstyle{MQO}}
\end{align}
<p>Note que 

$\boldsymbol{\Sigma}'^{-0.5} = \boldsymbol{\Sigma}^{-0.5}$.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bhat_OLS</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X_til</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y_til</span>
</span></span><span class="line"><span class="cl"><span class="n">bhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.159325869
</span></span><span class="line"><span class="cl">## [2,] 0.003862631
</span></span></code></pre></div><p>h&rsquo;) Valores Ajustados e Resíduos MQO


$$\tilde{\hat{y}} = \tilde{\boldsymbol{X}} \tilde{\hat{\boldsymbol{\beta}}}_{\scriptscriptstyle{MQO}} \qquad \text{e} \qquad  \tilde{\hat{\boldsymbol{\varepsilon}}} = \boldsymbol{y} - \tilde{\hat{y}} $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat_OLS</span> <span class="o">=</span> <span class="n">X_til</span> <span class="o">%*%</span> <span class="n">bhat_OLS</span> <span class="c1"># Valores Ajustados</span>
</span></span><span class="line"><span class="cl"><span class="n">ehat_OLS</span> <span class="o">=</span> <span class="n">y_til</span> <span class="o">-</span> <span class="n">yhat_OLS</span> <span class="c1"># Resíduos</span>
</span></span></code></pre></div><p>i&rsquo;) Variância do termo de erro MQO


$$\hat{\sigma}^2 =  \frac{\tilde{\hat{\boldsymbol{\varepsilon}}}'\tilde{\hat{\boldsymbol{\varepsilon}}}}{NT - K - 1} $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">sig2hat</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">ehat_OLS</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span> <span class="o">-</span> <span class="n">K</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><p>j&rsquo;) Matriz de Variâncias-Covariâncias dos Erros MQO


$$ \widehat{\text{Var}}(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}}) = \hat{\sigma}^2 (\tilde{\boldsymbol{X}}' \tilde{\boldsymbol{X}})^{-1} $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Vbhat_OLS</span> <span class="o">=</span> <span class="n">sig2hat</span> <span class="o">*</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X_til</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]          [,2]
</span></span><span class="line"><span class="cl">## [1,]  1.165808e-05 -7.092295e-08
</span></span><span class="line"><span class="cl">## [2,] -7.092295e-08  2.830861e-08
</span></span></code></pre></div><p>k&rsquo;) Erro Padrão das Estimativas, Estatística t e P-valor</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_bhat_OLS</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vbhat_OLS</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat_OLS</span> <span class="o">=</span> <span class="n">bhat_OLS</span> <span class="o">/</span> <span class="n">se_bhat_OLS</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat_OLS</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_bhat_OLS</span><span class="p">),</span> <span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="o">-</span><span class="n">K</span><span class="m">-1</span><span class="p">)</span>
</span></span></code></pre></div><p>l&rsquo;) Comparativo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># MQGF via MQO Analítico</span>
</span></span><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">bhat_OLS</span><span class="p">,</span> <span class="n">se_bhat_OLS</span><span class="p">,</span> <span class="n">t_bhat_OLS</span><span class="p">,</span> <span class="n">p_bhat_OLS</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                   se_bhat_OLS                       
</span></span><span class="line"><span class="cl">## [1,] 0.159325869 0.0034143937 46.66300  0.000000e+00
</span></span><span class="line"><span class="cl">## [2,] 0.003862631 0.0001682516 22.95747 2.912584e-112
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># MQGF via plm</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.walhus</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                Estimate   Std. Error  z-value      Pr(&gt;|z|)
</span></span><span class="line"><span class="cl">## (Intercept) 0.159325869 0.0034143937 46.66300  0.000000e+00
</span></span><span class="line"><span class="cl">## qn          0.003862631 0.0001682516 22.95747 1.240977e-116
</span></span></code></pre></div></br>
<h2 id="matrizes-de-transformação">Matrizes de Transformação</h2>
<ul>
<li>Seção 2.1.2 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</li>
</ul>
<h3 id="modelo-em-painel-2">Modelo em Painel (2)</h3>
<ul>
<li>Agora, iremos diferenciar as variáveis explicativas invariantes no tempo das variantes no tempo.</li>
<li>Considere que, das 

$K$ variáveis explicativas, temos 

$J$ variáveis invariantes no tempo e 

$L$ são variantes no tempo:</li>
</ul>
<p>O modelo (1) é:


\begin{align} y_{it} &= \boldsymbol{x}'_{it} \boldsymbol{\beta} + \varepsilon_{it} \tag{1} \\
&= 1.\beta_0 + x^1_{it} \beta_1 + ... + x^J_{it} \beta_J + x^{J+1}_{it} \beta_{J+1} + ... + x^K_{it} \beta_K + \varepsilon_{it} \end{align}
e pode ser reescrito como:


\begin{align} y_{it} &= \boldsymbol{x}'_{i} \boldsymbol{\Gamma} + \boldsymbol{x}^{*\prime}_{it} \boldsymbol{\delta} + \varepsilon_{it} \tag{2} \\
&= 1.\Gamma_0 + x^1_{i} \Gamma_1 + ... + x^J_{i} \Gamma_J + x^{*1}_{it} \delta_{1} + ... + x^{*L}_{it} \delta_L + \varepsilon_{it} \end{align}
em que:</p>
<ul>
<li>


$\boldsymbol{x}'_{it} = [\boldsymbol{x}'_{i}, \boldsymbol{x}^{*\prime}_{it}] $
</li>
<li>
<p>

$\boldsymbol{x}'_{i}$ são as realizações das 

$J$ variáveis invariantes no tempo, junto de 1:


$$ \boldsymbol{x}'_{i} = \begin{bmatrix} 1 & x^1_i & x^2_i & \cdots & x^J_i \end{bmatrix}  $$</p>
</li>
<li>
<p>

$\boldsymbol{x}^{*\prime}_{it}$ são as realizações das 

$L$ variáveis variantes no tempo:


$$ \boldsymbol{x}^{*\prime}_{it} = \begin{bmatrix} x^{*1}_{it} & x^{*2}_{it} & \cdots & x^{*L}_{it} \end{bmatrix} $$</p>
</li>
<li>
<p>

$\varepsilon_{it} = u_i + v_{it}$.</p>
</li>
<li>
<p>

$\boldsymbol{\Gamma}$ e 

$\boldsymbol{\delta}$ são, respectivamente, os parâmetros das variáveis invariantes e variantes no tempo, tal que


\begin{align} \boldsymbol{\beta}\quad\ &\equiv \begin{bmatrix} \ \boldsymbol{\Gamma}\  \\ \ \boldsymbol{\delta}\  \end{bmatrix} \\
\begin{bmatrix} \beta_0 \\ \beta_1 \\ \beta_2 \\ \vdots \\ \beta_J \\\hline \beta_{J+1} \\ \beta_{J+2} \\ \vdots \\ \beta_{K} \end{bmatrix} &\equiv \begin{bmatrix} \Gamma_0 \\ \Gamma_1 \\ \Gamma_2 \\ \vdots \\ \Gamma_J \\\hline \delta_1 \\ \delta_2 \\ \vdots \\ \delta_L \end{bmatrix} \end{align}</p>
</li>
</ul>
<p>Empilhando as equações (2) para todo 

$i$ e 

$t$, segue que


$$ \boldsymbol{y}\ =\ \boldsymbol{X} \boldsymbol{\beta} + \boldsymbol{\varepsilon} \ =\ \boldsymbol{X}_0 \boldsymbol{\Gamma} + \boldsymbol{X}^{*} \boldsymbol{\delta} + \boldsymbol{\varepsilon} $$
ou, usando</p>


\begin{align} \boldsymbol{X} &= \left[ \begin{array}{ccccc|cccc}
    1 & x^1_{11} & x^2_{11} & \cdots & x^J_{11} & x^{J+1}_{11} & x^{J+2}_{11} & \cdots & x^K_{11} \\
    1 & x^1_{12} & x^2_{12} & \cdots & x^J_{12} & x^{J+1}_{12} & x^{J+2}_{12} & \cdots & x^K_{12} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{1T} & x^2_{1T} & \cdots & x^J_{1T} & x^{J+1}_{1T} & x^{J+2}_{1T} & \cdots & x^K_{1T} \\\hline
    1 & x^1_{21} & x^2_{21} & \cdots & x^J_{21} & x^{J+1}_{21} & x^{J+2}_{21} & \cdots & x^K_{21} \\
    1 & x^1_{22} & x^2_{22} & \cdots & x^J_{22} & x^{J+1}_{22} & x^{J+2}_{22} & \cdots & x^K_{22} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{2T} & x^2_{2T} & \cdots & x^J_{2T} & x^{J+1}_{2T} & x^{J+2}_{2T} & \cdots & x^K_{2T} \\\hline
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\\hline
    1 & x^1_{N1} & x^2_{N1} & \cdots & x^J_{N1} & x^{J+1}_{N1} & x^{J+2}_{N1} & \cdots & x^K_{21} \\
    1 & x^1_{N2} & x^2_{N2} & \cdots & x^J_{N2} & x^{J+1}_{N2} & x^{J+2}_{N2} & \cdots & x^K_{N2} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{NT} & x^2_{NT} & \cdots & x^J_{NT} & x^{J+1}_{NT} & x^{J+2}_{NT} & \cdots & x^K_{NT}
\end{array} \right] \\\\
\equiv \begin{bmatrix} \boldsymbol{X}_0, \boldsymbol{X}^{*} \end{bmatrix} &= \left[ \begin{array}{ccccc|cccc}
    1 & x^1_{1} & x^2_{1} & \cdots & x^J_{1} & x^{*1}_{11} & x^{*2}_{11} & \cdots & x^{*L}_{11} \\
    1 & x^1_{1} & x^2_{1} & \cdots & x^J_{1} & x^{*1}_{12} & x^{*2}_{12} & \cdots & x^{*L}_{12} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{1} & x^2_{1} & \cdots & x^J_{1} & x^{*1}_{1T} & x^{*2}_{1T} & \cdots & x^{*L}_{1T} \\\hline
    1 & x^1_{2} & x^2_{2} & \cdots & x^J_{2} & x^{*1}_{21} & x^{*2}_{21} & \cdots & x^{*L}_{21} \\
    1 & x^1_{2} & x^2_{2} & \cdots & x^J_{2} & x^{*1}_{22} & x^{*2}_{22} & \cdots & x^{*L}_{22} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{2} & x^2_{2} & \cdots & x^J_{2} & x^{*1}_{2T} & x^{*2}_{2T} & \cdots & x^{*L}_{2T} \\\hline
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\\hline
    1 & x^1_{N} & x^2_{N} & \cdots & x^J_{N} & x^{*1}_{N1} & x^{*2}_{N1} & \cdots & x^{*L}_{21} \\
    1 & x^1_{N} & x^2_{N} & \cdots & x^J_{N} & x^{*1}_{N2} & x^{*2}_{N2} & \cdots & x^{*L}_{N2} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{N\ \ \ } & x^2_{N\ \ \ } & \cdots & x^J_{N\ \ \ } & x^{*1}_{NT} & x^{*2}_{NT} & \cdots & x^{*L}_{NT}
\end{array} \right] \end{align}
<!-- 

\begin{align} \underbrace{\boldsymbol{\delta}}_{(K+1) \times 1} &\equiv \left[ \begin{array}{c} \alpha \\ \boldsymbol{\beta} \end{array} \right] =  -->
<!--  \left[ \begin{array}{c} \alpha \\ \beta_1 \\ \beta_2 \\ \vdots \\ \beta_K \end{array} \right] \quad \text{ e }\\  -->
<!-- \underbrace{\boldsymbol{X}}_{NT \times (K+1)} &\equiv \left[ \begin{array}{c} \boldsymbol{\iota} & \boldsymbol{X} \end{array} \right] -->
<!--   = \left[ \begin{array}{cccc} -->
<!--     1 & x^1_{11} & x^2_{11} & \cdots & x^K_{11} \\ -->
<!--     1 & x^1_{12} & x^2_{12} & \cdots & x^K_{12} \\ -->
<!--     \vdots & \vdots & \vdots & \ddots & \vdots \\ -->
<!--     1 & x^1_{1T} & x^2_{1T} & \cdots & x^K_{1T} \\ \hline -->
<!--     1 & x^1_{21} & x^2_{21} & \cdots & x^K_{21} \\ -->
<!--     1 & x^1_{22} & x^2_{22} & \cdots & x^K_{22} \\ -->
<!--     \vdots & \vdots & \vdots & \ddots & \vdots \\  -->
<!--     1 & x^1_{2T} & x^2_{2T} & \cdots & x^K_{2T} \\ \hline -->
<!--     \vdots & \vdots & \vdots & \ddots & \vdots \\ \hline -->
<!--     1 & x^1_{N1} & x^2_{N1} & \cdots & x^K_{N1} \\ -->
<!--     1 & x^1_{N2} & x^2_{N2} & \cdots & x^K_{N2} \\ -->
<!--     \vdots & \vdots & \vdots & \ddots & \vdots \\ -->
<!--     1 & x^1_{NT} & x^2_{NT} & \cdots & x^K_{NT} -->
<!-- \end{array} \right], \end{align}  -->
<!-- podemos reescrever como -->
<!-- 

$$ \boldsymbol{y} = \boldsymbol{X} \boldsymbol{\delta} + \boldsymbol{\varepsilon}. $$ -->
<h3 id="_between_"><em>Between</em></h3>
<p>A matriz de transformação <strong>inter-indivíduos (<em>between</em>)</strong> é denotada por:


$$ \boldsymbol{B}\ =\ \boldsymbol{I}_N \otimes \Big[ \boldsymbol{\iota}_T (\boldsymbol{\iota}'_T \boldsymbol{\iota}_T)^{-1} \boldsymbol{\iota}'_T \Big] $$
Note que a matriz 

$\boldsymbol{B}$ é equivalente a 

$\boldsymbol{N}$ nas notas de aula de Econometria II.</p>
<p>Pré-multiplicando 

$\boldsymbol{X}$ pela matriz de transformação <em>between</em> 

$\boldsymbol{B}$, temos:


$$ x^k_{it}\ \overset{\boldsymbol{B}}{\Longrightarrow}\ \bar{x}^k_{i}\ =\ \frac{1}{T} \sum^T_{i=1}{x^k_{it}}, \qquad \forall i, t, k $$</p>
<p>Logo,</p>


$$ \boldsymbol{BX} = \left[ \begin{array}{ccccc|cccc}
    1 & x^1_{1} & x^2_{1} & \cdots & x^J_{1} & \bar{x}^{*1}_{1} & \bar{x}^{*2}_{1} & \cdots & \bar{x}^{*L}_{1} \\
    1 & x^1_{1} & x^2_{1} & \cdots & x^J_{1} & \bar{x}^{*1}_{1} & \bar{x}^{*2}_{1} & \cdots & \bar{x}^{*L}_{1} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{1} & x^2_{1} & \cdots & x^J_{1} & \bar{x}^{*1}_{1} & \bar{x}^{*2}_{1} & \cdots & \bar{x}^{*L}_{1} \\\hline
    1 & x^1_{2} & x^2_{2} & \cdots & x^J_{2} & \bar{x}^{*1}_{2} & \bar{x}^{*2}_{2} & \cdots & \bar{x}^{*L}_{2} \\
    1 & x^1_{2} & x^2_{2} & \cdots & x^J_{2} & \bar{x}^{*1}_{2} & \bar{x}^{*2}_{2} & \cdots & \bar{x}^{*L}_{2} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{2} & x^2_{2} & \cdots & x^J_{2} & \bar{x}^{*1}_{2} & \bar{x}^{*2}_{2} & \cdots & \bar{x}^{*L}_{2} \\\hline
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\\hline
    1 & x^1_{N} & x^2_{N} & \cdots & x^J_{N} & \bar{x}^{*1}_{N} & \bar{x}^{*2}_{N} & \cdots & \bar{x}^{*L}_{2} \\
    1 & x^1_{N} & x^2_{N} & \cdots & x^J_{N} & \bar{x}^{*1}_{N} & \bar{x}^{*2}_{N} & \cdots & \bar{x}^{*L}_{N} \\
    \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    1 & x^1_{N} & x^2_{N} & \cdots & x^J_{N} & \bar{x}^{*1}_{N} & \bar{x}^{*2}_{N} & \cdots & \bar{x}^{*L}_{N}
\end{array} \right]_{NT \times (K+1)} $$
</br>
<p>Por exemplo, para 

$N = 2$ e 

$T = 3$, segue que:</p>


$$ \boldsymbol{B} = \left[ \begin{array}{rrrrrr} 
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\
        0 & 0 & 0 & 1/3 & 1/3 & 1/3 \\
        0 & 0 & 0 & 1/3 & 1/3 & 1/3 \\
        0 & 0 & 0 & 1/3 & 1/3 & 1/3
    \end{array} \right]_{6 \times 6}, $$
<p>Por exemplo, suponha a matriz 

$\boldsymbol{X}$, com 

$J=1$ variável invariante no tempo, e 

$P=3$ variantes:</p>


$$ \boldsymbol{X} = \begin{bmatrix} \boldsymbol{X}_0 & \boldsymbol{X}^{*} \end{bmatrix} = \left[ \begin{array}{cc|ccc}
1 & 3 & 1 & 3 & 6 \\
1 & 3 & 9 & 5 & 4 \\
1 & 3 & 8 & 7 & 2 \\ \hline
1 & 7 & 6 & 6 & 8 \\
1 & 7 & 8 & 6 & 1 \\
1 & 7 & 1 & 9 & 9
\end{array} \right]_{6 \times 5} $$
<p>Note que a linha horizontal na matriz acima foi colocada apenas para deixar claro que as três primeiras linhas correspondem ao mesmo indivíduo 

$i=1$, e as três últimas correspondem ao indivíduo 

$i=2$. São três linhas para cada um, pois assumimos 

$t=1,2,3$ períodos.</p>
<p>Logo, temos:</p>


\begin{align} \boldsymbol{BX} &=  
\left[ \begin{array}{rrrrrr} 
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\\hline
        0 & 0 & 0 & 1/3 & 1/3 & 1/3 \\
        0 & 0 & 0 & 1/3 & 1/3 & 1/3 \\
        0 & 0 & 0 & 1/3 & 1/3 & 1/3
    \end{array} \right] \left[ \begin{array}{cc|ccc}
1 & 3 & 1 & 3 & 6 \\
1 & 3 & 9 & 5 & 4 \\
1 & 3 & 8 & 7 & 2 \\ \hline
1 & 7 & 6 & 6 & 8 \\
1 & 7 & 8 & 6 & 1 \\
1 & 7 & 1 & 9 & 9
\end{array} \right] \\
&= \left[ \begin{array}{cc|ccc}
1 & 3 & 6 & 5 & 4 \\
1 & 3 & 6 & 5 & 4 \\
1 & 3 & 6 & 5 & 4 \\ \hline
1 & 7 & 5 & 7 & 6 \\
1 & 7 & 5 & 7 & 6 \\
1 & 7 & 5 & 7 & 6
\end{array} \right]_{6 \times 5} \end{align}
<p>Note que, para cada indivíduo 

$i$ e coluna 

$k$, os elementos foram &ldquo;preenchidos&rdquo; com a média dos valores em 

$t=1,2,3$.</p>
</br>
<p>Agora, vamos definir uma matriz de covariadas <code>X</code> e pós-multiplicar pela matriz <code>B</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="m">2</span> <span class="c1"># nº indivíduos</span>
</span></span><span class="line"><span class="cl"><span class="bp">T</span> <span class="o">=</span> <span class="m">3</span> <span class="c1"># nº períodos</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span> <span class="o">=</span> <span class="m">4</span> <span class="c1"># nº variáveis explicativas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Calculando matriz de transformação between</span>
</span></span><span class="line"><span class="cl"><span class="n">iota_T</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="c1"># vetor de 1&#39;s de dimensão T</span>
</span></span><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># Matriz identidade de dimensão N</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="p">(</span><span class="n">iota_T</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="c1"># matriz de transformação between</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
</span></span><span class="line"><span class="cl">## [1,] 0.3333333 0.3333333 0.3333333 0.0000000 0.0000000 0.0000000
</span></span><span class="line"><span class="cl">## [2,] 0.3333333 0.3333333 0.3333333 0.0000000 0.0000000 0.0000000
</span></span><span class="line"><span class="cl">## [3,] 0.3333333 0.3333333 0.3333333 0.0000000 0.0000000 0.0000000
</span></span><span class="line"><span class="cl">## [4,] 0.0000000 0.0000000 0.0000000 0.3333333 0.3333333 0.3333333
</span></span><span class="line"><span class="cl">## [5,] 0.0000000 0.0000000 0.0000000 0.3333333 0.3333333 0.3333333
</span></span><span class="line"><span class="cl">## [6,] 0.0000000 0.0000000 0.0000000 0.3333333 0.3333333 0.3333333
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Matriz de covariadas X</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> <span class="c1"># 1a coluna de 1&#39;s</span>
</span></span><span class="line"><span class="cl">             <span class="nf">rep</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="nf">rep</span><span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="c1"># 2a coluna</span>
</span></span><span class="line"><span class="cl">             <span class="m">1</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">1</span><span class="p">,</span> <span class="c1"># 3a coluna</span>
</span></span><span class="line"><span class="cl">             <span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="p">,</span> <span class="c1"># 4a coluna</span>
</span></span><span class="line"><span class="cl">             <span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">9</span>  <span class="c1"># 5a coluna</span>
</span></span><span class="line"><span class="cl">             <span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="n">K</span><span class="m">+1</span><span class="p">)</span> <span class="c1"># matriz covariadas NT x (K+1)</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5]
</span></span><span class="line"><span class="cl">## [1,]    1    3    1    3    6
</span></span><span class="line"><span class="cl">## [2,]    1    3    9    5    4
</span></span><span class="line"><span class="cl">## [3,]    1    3    8    7    2
</span></span><span class="line"><span class="cl">## [4,]    1    7    6    6    8
</span></span><span class="line"><span class="cl">## [5,]    1    7    8    6    1
</span></span><span class="line"><span class="cl">## [6,]    1    7    1    9    9
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Pré-multiplicando X por B</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">%*%</span> <span class="n">X</span> <span class="c1"># matriz de médias das covariadas dado indivíduo (NT x K)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5]
</span></span><span class="line"><span class="cl">## [1,]    1    3    6    5    4
</span></span><span class="line"><span class="cl">## [2,]    1    3    6    5    4
</span></span><span class="line"><span class="cl">## [3,]    1    3    6    5    4
</span></span><span class="line"><span class="cl">## [4,]    1    7    5    7    6
</span></span><span class="line"><span class="cl">## [5,]    1    7    5    7    6
</span></span><span class="line"><span class="cl">## [6,]    1    7    5    7    6
</span></span></code></pre></div><p>Note que:</p>
<ul>
<li>as colunas 1 e 2 permaneceram iguais após a transformação <em>between</em>, pois são invariantes no tempo (média de algo constante é a própria constante).</li>
<li>dada uma variável 

$k$, temos um único valor (média) dentro de um mesmo indivíduo 

$i$;</li>
<li>por isso, a amostra com 

$NT$ observações distintas, agora, <strong>passa a possuir apenas 

$N$ observações distintas</strong>, o que faz com que percamos graus de liberdade (perde 

$N(T-1)$ graus de liberdade)</li>
</ul>
</br>
<h3 id="_within_"><em>Within</em></h3>
<p>Já a matriz de transformação <strong>intra-indivíduos (<em>within</em>)</strong> é dada por:


$$ \boldsymbol{W}\ =\ \boldsymbol{I}_{NT} - \boldsymbol{B}\ =\ \boldsymbol{I}_{NT} - \Big[ \boldsymbol{I}_N \otimes \boldsymbol{\iota}_T (\boldsymbol{\iota}'_T \boldsymbol{\iota}_T)^{-1} \boldsymbol{\iota}'_T \Big]. $$</p>
<p>Note que a matriz 

$\boldsymbol{W}$ é equivalente a 

$\boldsymbol{M}$ nas notas de aula de Econometria II (2021).</p>
<p>Pré-multiplicando 

$\boldsymbol{X}$ pela matriz de transformação <em>within</em> 

$\boldsymbol{W}$, temos:


$$ x^{k}_{it}\ \overset{\boldsymbol{W}}{\Longrightarrow}\ x^{k}_{it} - \bar{x}^{k}_i\ =\ x^{k}_{it} - \frac{1}{T} \sum^T_{i=1}{x^{k}_{it}}, \qquad \forall i, t, l=1,...,L $$</p>
<p>Logo,


\begin{align} \boldsymbol{WX} &= \left[ \begin{array}{ccc|cccc}
    0 & \cdots & 0 & x^{*1}_{11} - \bar{x}^{*1}_{1} & x^{*2}_{11} - \bar{x}^{*2}_{1} & \cdots & x^{*L}_{11} - \bar{x}^{*L}_{1} \\
    0 & \cdots & 0 & x^{*1}_{12} - \bar{x}^{*1}_{1} & x^{*2}_{12} - \bar{x}^{*2}_{1} & \cdots & x^{*2}_{1T} - \bar{x}^{*L}_{1} \\
    \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 & \cdots & 0 & x^{*1}_{1T} - \bar{x}^{*1}_{1} & x^{*2}_{1T} - \bar{x}^{*2}_{1} & \cdots & x^{*L}_{1T} - \bar{x}^{*L}_{1} \\\hline
    0 & \cdots & 0 & x^{*1}_{21} - \bar{x}^{*1}_{2} & x^{*2}_{21} - \bar{x}^{*2}_{2} & \cdots & x^{*L}_{21} - \bar{x}^{*L}_{2} \\
    0 & \cdots & 0 & x^{*1}_{22} - \bar{x}^{*1}_{2} & x^{*2}_{22} - \bar{x}^{*2}_{2} & \cdots & x^{*2}_{22} - \bar{x}^{*L}_{2} \\
    \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 & \cdots & 0 & x^{*1}_{2T} - \bar{x}^{*1}_{2} & x^{*2}_{2T} - \bar{x}^{*2}_{2} & \cdots & x^{*L}_{2T} - \bar{x}^{*L}_{2} \\\hline
    \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\\hline
    0 & \cdots & 0 & x^{*1}_{N1} - \bar{x}^{*1}_{N} & x^{*2}_{N1} - \bar{x}^{*2}_{N} & \cdots & x^{*L}_{N1} - \bar{x}^{*L}_{N} \\
    0 & \cdots & 0 & x^{*1}_{N2} - \bar{x}^{*1}_{N} & x^{*2}_{N2} - \bar{x}^{*2}_{N} & \cdots & x^{*2}_{N2} - \bar{x}^{*L}_{N} \\
    \vdots & \ddots & \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 & \cdots & 0 & x^{*1}_{NT} - \bar{x}^{*1}_{N} & x^{*2}_{NT} - \bar{x}^{*2}_{N} & \cdots & x^{*L}_{NT} - \bar{x}^{*L}_{N} 
\end{array} \right]_{NT \times L}  \\
&= \boldsymbol{WX}^* \end{align}</p>
<p>Por exemplo, para 

$N = 2$ e 

$T = 3$, segue que:</p>


\begin{align}
    \boldsymbol{W} &= \boldsymbol{I}_{6} - \boldsymbol{B} \\
    &= \left[ \begin{array}{cccccc} 
        1 & 0 & 0 & 0 & 0 & 0 \\
        0 & 1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 1 & 0 & 0 \\
        0 & 0 & 0 & 0 & 1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 1
    \end{array} \right] - \left[ \begin{array}{rrrrrr} 
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\
        1/3 & 1/3 & 1/3 & 0 & 0 & 0 \\
        0 & 0 & 0 & 1/3 & 1/3 & 1/3 \\
        0 & 0 & 0 & 1/3 & 1/3 & 1/3 \\
        0 & 0 & 0 & 1/3 & 1/3 & 1/3
    \end{array} \right] \\
    &= \left[ \begin{array}{rrrrrr} 
         2/6 & -1/3 & -1/3 &    0 &    0 &    0 \\
        -1/3 &  2/6 & -1/3 &    0 &    0 &    0 \\
        -1/3 & -1/3 &  2/6 &    0 &    0 &    0 \\
           0 &    0 &    0 &  2/6 & -1/3 & -1/3 \\
           0 &    0 &    0 & -1/3 &  2/6 & -1/3 \\
           0 &    0 &    0 & -1/3 & -1/3 &  2/6
    \end{array} \right]_{6 \times 6} , 
\end{align}
<p>Logo, temos:</p>


\begin{align} \boldsymbol{WX} =  
&\left[ \begin{array}{rrrrrr} 
         2/6 & -1/3 & -1/3 &    0 &    0 &    0 \\
        -1/3 &  2/6 & -1/3 &    0 &    0 &    0 \\
        -1/3 & -1/3 &  2/6 &    0 &    0 &    0 \\
           0 &    0 &    0 &  2/6 & -1/3 & -1/3 \\
           0 &    0 &    0 & -1/3 &  2/6 & -1/3 \\
           0 &    0 &    0 & -1/3 & -1/3 &  2/6
    \end{array} \right] \\ 
    &\left[ \begin{array}{cc|ccc}
1 & 3 & 1 & 3 & 6 \\
1 & 3 & 9 & 5 & 4 \\
1 & 3 & 8 & 7 & 2 \\ \hline
1 & 7 & 6 & 6 & 8 \\
1 & 7 & 8 & 6 & 1 \\
1 & 7 & 1 & 9 & 9
\end{array} \right] \\
= &\left[ \begin{array}{cc|ccc}
0 & 0 & -5 & -2 &  2 \\
0 & 0 &  3 &  0 &  0 \\
0 & 0 &  2 &  2 & -2 \\ \hline
0 & 0 &  1 & -1 &  2 \\
0 & 0 &  3 & -1 & -5 \\
0 & 0 & -4 &  2 &  3
\end{array} \right]_{6 \times 5} = \boldsymbol{WX}^* \end{align}
<p>Note que perdemos toda variabilidade das duas primeiras colunas que eram invariantes no tempo. Portanto, &ldquo;jogamos fora&rdquo; toda submatriz 

$\boldsymbol{X}_0$, sobrando apenas 

$\boldsymbol{X}^{*}$ (com covariadas variantes no tempo).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">I_NT</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="p">)</span> <span class="c1"># Matriz identidade de dimensão NT</span>
</span></span><span class="line"><span class="cl"><span class="n">W</span> <span class="o">=</span> <span class="n">I_NT</span> <span class="o">-</span> <span class="n">B</span> 
</span></span><span class="line"><span class="cl"><span class="n">W</span> <span class="c1"># matriz de transformação within</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]
</span></span><span class="line"><span class="cl">## [1,]  0.6666667 -0.3333333 -0.3333333  0.0000000  0.0000000  0.0000000
</span></span><span class="line"><span class="cl">## [2,] -0.3333333  0.6666667 -0.3333333  0.0000000  0.0000000  0.0000000
</span></span><span class="line"><span class="cl">## [3,] -0.3333333 -0.3333333  0.6666667  0.0000000  0.0000000  0.0000000
</span></span><span class="line"><span class="cl">## [4,]  0.0000000  0.0000000  0.0000000  0.6666667 -0.3333333 -0.3333333
</span></span><span class="line"><span class="cl">## [5,]  0.0000000  0.0000000  0.0000000 -0.3333333  0.6666667 -0.3333333
</span></span><span class="line"><span class="cl">## [6,]  0.0000000  0.0000000  0.0000000 -0.3333333 -0.3333333  0.6666667
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Pré-multiplicando X por W</span>
</span></span><span class="line"><span class="cl"><span class="nf">round</span><span class="p">(</span><span class="n">W</span> <span class="o">%*%</span> <span class="n">X</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span> <span class="c1"># arredondando</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5]
</span></span><span class="line"><span class="cl">## [1,]    0    0   -5   -2    2
</span></span><span class="line"><span class="cl">## [2,]    0    0    3    0    0
</span></span><span class="line"><span class="cl">## [3,]    0    0    2    2   -2
</span></span><span class="line"><span class="cl">## [4,]    0    0    1   -1    2
</span></span><span class="line"><span class="cl">## [5,]    0    0    3   -1   -5
</span></span><span class="line"><span class="cl">## [6,]    0    0   -4    2    3
</span></span></code></pre></div><p>Observe que:</p>
<ul>
<li>dada uma variável 

$k$, temos os desvios em relação à média de um mesmo indivíduo;</li>
<li>colunas 1 e 2, invariantes no tempo, viraram apenas 0 após a transformação <em>within</em>, fazendo com que as percamos em uma regressão.</li>
<li>coluna de 0&rsquo;s, no R, ficou muito próxima de 0 (

$1,11 \times 10^{-16}$), então foi necessário arredondar.</li>
</ul>
</br>
<h3 id="primeiras-diferenças">Primeiras-diferenças</h3>
<ul>
<li>A matriz de primeiras diferenças permite transformar as variáveis para as diferenças entre as realização entre os períodos 

$t+1$ e 

$t$, e tem a seguinte forma (não-quadrada):


$$\boldsymbol{D} = \boldsymbol{I}_N \otimes \boldsymbol{D}_i $$
em que 

$\boldsymbol{I}_N$ é uma matriz identidade de tamanho 

$N$, e</li>
</ul>
<p>

$$\boldsymbol{D}_i = \begin{bmatrix}
-1 & 1 & 0 & \cdots & 0 & 0 \\
0 & -1 & 1 & \cdots & 0 & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\
0 & 0 & 0 & \cdots & -1 & 1
\end{bmatrix}_{(T-1)\times T}$$
é não é uma matriz quadrada e possui &ldquo;diagonais principais&rdquo; iguais a 

$-1$ e a 

$1$.</p>
<p>Pré-multiplicando 

$\boldsymbol{X}$ pela matriz de transformação de <em>primeiras-diferenças</em> 

$\boldsymbol{D}$, temos:


$$ x^{k}_{it}\ \overset{\boldsymbol{D}}{\Longrightarrow}\ \Delta x^{k}_{it} \ =\ x^{k}_{i,t+1} - x^{k}_{it}, \qquad \forall i, k, t = 1, 2, ..., T-1 $$</p>
<p>Logo,


\begin{align} \boldsymbol{DX} &= \left[ \begin{array}{c|cccc}
    0 \cdots 0 & x^{*1}_{12} - x^{*1}_{11} & x^{*2}_{12} - x^{*2}_{11} & \cdots & x^{*L}_{12} - x^{*L}_{11} \\
    0 \cdots 0 & x^{*1}_{13} - x^{*1}_{12} & x^{*2}_{13} - x^{*2}_{12} & \cdots & x^{*2}_{13} - x^{*L}_{12} \\
    \vdots \ddots \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 \cdots 0 & x^{*1}_{1T} - x^{*1}_{1,T-1} & x^{*2}_{1T} - x^{*2}_{1,T-1} & \cdots & x^{*L}_{1T} - x^{*L}_{1,T-1} \\\hline
    0 \cdots 0 & x^{*1}_{22} - x^{*1}_{21} & x^{*2}_{22} - x^{*2}_{21} & \cdots & x^{*L}_{22} - x^{*L}_{21} \\
    0 \cdots 0 & x^{*1}_{23} - x^{*1}_{2} & x^{*2}_{22} - x^{*2}_{2} & \cdots & x^{*2}_{23} - x^{*L}_{22} \\
    \vdots \ddots \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 \cdots 0 & x^{*1}_{2T} - x^{*1}_{2,T-1} & x^{*2}_{2T} - x^{*2}_{2,T-1} & \cdots & x^{*L}_{2T} - x^{*L}_{2,T-1} \\\hline
    \vdots \ddots \vdots & \vdots & \vdots & \ddots & \vdots \\\hline
    0 \cdots 0 & x^{*1}_{N2} - x^{*1}_{N1} & x^{*2}_{N2} - x^{*2}_{N1} & \cdots & x^{*L}_{N2} - x^{*L}_{N1} \\
    0 \cdots 0 & x^{*1}_{N3} - x^{*1}_{N2} & x^{*2}_{N3} - x^{*2}_{N2} & \cdots & x^{*2}_{N3} - x^{*L}_{N2} \\
    \vdots \ddots \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 \cdots 0 & x^{*1}_{NT} - x^{*1}_{N,T-1} & x^{*2}_{NT} - x^{*2}_{N,T-1} & \cdots & x^{*L}_{NT} - x^{*L}_{N,T-1} 
\end{array} \right]  \\
&= \underset{N(T-1) \times L}{\boldsymbol{DX}^*} \end{align}</p>
</br>
<p>Por exemplo, para 

$N = 2$ e 

$T = 3$, segue que:</p>


$$ \boldsymbol{D}_i = \begin{bmatrix} 
-1 &  1 &  0 \\
 0 & -1 &  1 \end{bmatrix}_{2 \times 3},\quad i=1,2 $$
<p>Logo, temos que</p>


\begin{align} \boldsymbol{DX} &=  
\left[ \begin{array}{rrr|rrr} 
         -1 &  1 &  0 &  0 &  0 &  0 \\
          0 & -1 &  1 &  0 &  0 &  0 \\\hline
          0 &  0 &  0 & -1 &  1 &  0 \\
          0 &  0 &  0 &  0 & -1 &  1 
    \end{array} \right]  
    \left[ \begin{array}{cc|ccc}
1 & 3 & 1 & 3 & 6 \\
1 & 3 & 9 & 5 & 4 \\
1 & 3 & 8 & 7 & 2 \\ \hline
1 & 7 & 6 & 6 & 8 \\
1 & 7 & 8 & 6 & 1 \\
1 & 7 & 1 & 9 & 9
\end{array} \right] \\
&= \left[ \begin{array}{cc|ccc}
0 & 0 &  8 & 2 & -2 \\
0 & 0 & -1 & 2 & -2 \\\hline
0 & 0 &  2 & 0 & -7 \\
0 & 0 & -7 & 3 &  8
\end{array} \right]_{4 \times 5} = \boldsymbol{DX}^* \end{align}
<p>Note que perdemos toda variabilidade das duas primeiras colunas que eram invariantes no tempo 

$(\boldsymbol{X}_0)$. Além disso, perdemos um período para cada indivíduo 

$i$.</p>
<p>Para construir 

$\boldsymbol{D}_i$ no R, vamos:</p>
<p>a) criar uma matriz identidade de tamanho 

$T$ e multiplicar por 

$-1$


$$ -\boldsymbol{I}_T = \begin{bmatrix}
-1 &  0 &  0 \\
 0 & -1 &  0 \\
 0 &  0 & -1
\end{bmatrix} $$.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Di</span> <span class="o">=</span> <span class="o">-</span><span class="nf">diag</span><span class="p">(</span><span class="bp">T</span><span class="p">)</span> <span class="c1"># diagonal -1</span>
</span></span><span class="line"><span class="cl"><span class="n">Di</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3]
</span></span><span class="line"><span class="cl">## [1,]   -1    0    0
</span></span><span class="line"><span class="cl">## [2,]    0   -1    0
</span></span><span class="line"><span class="cl">## [3,]    0    0   -1
</span></span></code></pre></div><p>b) alterar o valor da superdiagonal (é a diagonal da matriz identidade de tamanho 

$T-1$ (submatriz que exclui a primeira coluna e última linha da matriz de tamanho 

$T$)


$$ \left[ \begin{array}{c|cc}
-1 &  0 &  0 \\
 0 & -1 &  0 \\\hline
 0 &  0 & -1
\end{array} \right] \Longrightarrow \left[ \begin{array}{ccc}
-1 &  1 &  0 \\
 0 & -1 &  1 \\
 0 &  0 & -1
\end{array} \right] $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">diag</span><span class="p">(</span><span class="n">Di[</span><span class="o">-</span><span class="nf">nrow</span><span class="p">(</span><span class="n">Di</span><span class="p">),</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span> <span class="o">=</span> <span class="m">1</span> <span class="c1"># supradiagonal</span>
</span></span><span class="line"><span class="cl"><span class="n">Di</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3]
</span></span><span class="line"><span class="cl">## [1,]   -1    1    0
</span></span><span class="line"><span class="cl">## [2,]    0   -1    1
</span></span><span class="line"><span class="cl">## [3,]    0    0   -1
</span></span></code></pre></div><p>c) excluir a última linha, tornando a matriz de dimensão 

$(T-1)\times T$


$$ \Longrightarrow \boldsymbol{D}_i = \left[ \begin{array}{ccc}
-1 &  1 &  0 \\
 0 & -1 &  1 
\end{array} \right]_{2 \times 3} $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Di</span> <span class="o">=</span> <span class="n">Di[</span><span class="o">-</span><span class="nf">nrow</span><span class="p">(</span><span class="n">Di</span><span class="p">),</span><span class="n">]</span> <span class="c1"># retira última linha</span>
</span></span><span class="line"><span class="cl"><span class="n">Di</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3]
</span></span><span class="line"><span class="cl">## [1,]   -1    1    0
</span></span><span class="line"><span class="cl">## [2,]    0   -1    1
</span></span></code></pre></div><p>Depois, basta fazer o produto de Kronecker, 

$\otimes$, entre a matriz identidade de tamanho 

$N$, 

$\boldsymbol{I}_N$,e a matriz 

$\boldsymbol{D}_i$:</p>


\begin{align}\boldsymbol{D} &= \boldsymbol{I}_N \otimes \boldsymbol{D}_i \\
&= \begin{bmatrix}
1 & 0 \\
0 & 1 
\end{bmatrix}_{2 \times 2} \otimes \begin{pmatrix}
1 & -1 & 0 \\
0 & 1 & -1 
\end{pmatrix}_{2 \times 3} \\
&= \begin{bmatrix}
1\begin{pmatrix}
1 & -1 & 0 \\
0 & 1 & -1 
\end{pmatrix} & 0\begin{pmatrix}
1 & -1 & 0 \\
0 & 1 & -1 
\end{pmatrix} \\
0\begin{pmatrix}
1 & -1 & 0 \\
0 & 1 & -1 
\end{pmatrix} & 1\begin{pmatrix}
1 & -1 & 0 \\
0 & 1 & -1 
\end{pmatrix} 
\end{bmatrix} \\
&= \left[\begin{array}{ccc|ccc}
1 & -1 &  0 & 0 &  0 &  0 \\
0 &  1 & -1 & 0 &  0 &  0 \\\hline
0 &  0 &  0 & 1 & -1 &  0 \\
0 &  0 &  0 & 0 &  1 & -1 \\
\end{array}\right]_{4 \times 6} \end{align}
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho N</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="n">Di</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span> <span class="c1"># matriz de primeiras-diferenças</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5] [,6]
</span></span><span class="line"><span class="cl">## [1,]   -1    1    0    0    0    0
</span></span><span class="line"><span class="cl">## [2,]    0   -1    1    0    0    0
</span></span><span class="line"><span class="cl">## [3,]    0    0    0   -1    1    0
</span></span><span class="line"><span class="cl">## [4,]    0    0    0    0   -1    1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Transformação DX</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span> <span class="o">%*%</span> <span class="n">X</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1] [,2] [,3] [,4] [,5]
</span></span><span class="line"><span class="cl">## [1,]    0    0    8    2   -2
</span></span><span class="line"><span class="cl">## [2,]    0    0   -1    2   -2
</span></span><span class="line"><span class="cl">## [3,]    0    0    2    0   -7
</span></span><span class="line"><span class="cl">## [4,]    0    0   -7    3    8
</span></span></code></pre></div><p>Observe que:</p>
<ul>
<li>colunas 1 e 2, invariantes no tempo, viraram apenas 0 após a transformação de primeiras-diferenças, fazendo com que as percamos em uma regressão.</li>
<li>também perdemos uma linha por indivíduo para calcular a variação entre os períodos</li>
</ul>
</br>
<h2 id="estimador-_between_">Estimador <em>Between</em></h2>
<p>O modelo a ser estimado é o MQO pré-multiplicado por 

$\boldsymbol{B} = \boldsymbol{I}_N \otimes \boldsymbol{\iota} (\boldsymbol{\iota}' \boldsymbol{\iota})^{-1} \boldsymbol{\iota}'$:


$$ \boldsymbol{By}\ =\ \boldsymbol{BX\beta} + \boldsymbol{B\varepsilon} $$</p>
<ul>
<li>
<p>O estimador <em>between</em> é dado por


$$ \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}}\ =\ (\boldsymbol{X}' \boldsymbol{B} \boldsymbol{X} )^{-1} \boldsymbol{X}' \boldsymbol{B} y $$</p>
</li>
<li>
<p>Defina


$$ \hat{\sigma}^2_l \equiv \hat{\sigma}^2_v + T \hat{\sigma}^2_u  $$</p>
</li>
<li>
<p>A matriz de covariâncias do estimador pode ser obtida usando


\begin{align}
    V(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}}) &= (\boldsymbol{X}'\boldsymbol{BX})^{-1} \boldsymbol{X}' \boldsymbol{B}\boldsymbol{\Sigma} \boldsymbol{B} \boldsymbol{X} (\boldsymbol{X}'\boldsymbol{BX})^{-1} \\
    &\ \ \vdots \\
    &= \hat{\sigma}^2_l (\boldsymbol{X}' \boldsymbol{B} \boldsymbol{X})^{-1},
\end{align}</p>
</li>
<li>
<p>O estimador não-viesado de 

$\sigma^2_l$ é


$$ \hat{\sigma}^2_l = \frac{\hat{\boldsymbol{\varepsilon}_{\scriptscriptstyle{B}}}' \boldsymbol{B} \hat{\boldsymbol{\varepsilon}_{\scriptscriptstyle{B}}}}{N-K-1} $$
em que 

$\boldsymbol{\varepsilon}_{\scriptscriptstyle{B}}$ são os resíduos obtidos a partir da estimação 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}}$.</p>
</li>
<li>
<p>O estimador <em>between</em> também pode ser estimado por MQO, transformando as variáveis por pré-multiplicação da matriz <em>between</em> 

$(\boldsymbol{B})$:


$$ \tilde{\boldsymbol{X}} \equiv \boldsymbol{BX} \qquad \text{ e } \qquad \tilde{\boldsymbol{y}} \equiv \boldsymbol{By} $$</p>
</li>
</ul>
<p>Então


\begin{align} \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}} &= (\boldsymbol{X}' \boldsymbol{B} \boldsymbol{X} )^{-1} \boldsymbol{X}' \boldsymbol{B} y \\
&= (\boldsymbol{X}' \boldsymbol{B} \boldsymbol{B} \boldsymbol{X} )^{-1} \boldsymbol{X}' \boldsymbol{B} \boldsymbol{B} y \\
&= (\boldsymbol{X}' \boldsymbol{B}' \boldsymbol{B} \boldsymbol{X} )^{-1} \boldsymbol{X}' \boldsymbol{B}' \boldsymbol{B} y \\
&= ([\boldsymbol{B} \boldsymbol{X}]' \boldsymbol{B} \boldsymbol{X} )^{-1} [\boldsymbol{B} \boldsymbol{X}]' \boldsymbol{B} y \\
&\equiv ( \tilde{\boldsymbol{X}}' \tilde{\boldsymbol{X}} )^{-1} \tilde{\boldsymbol{X}}' \tilde{\boldsymbol{y}} = \tilde{\hat{\boldsymbol{\beta}}}_{\scriptscriptstyle{MQO}} \end{align}</p>
<p>Note que usamos:


$$ \boldsymbol{B} = \boldsymbol{B}\boldsymbol{B} \qquad \text{e} \qquad \boldsymbol{B}=\boldsymbol{B}' $$</p>
<!-- ```{r} -->
<!-- # Exemplo N = 2 e T = 3 -->
<!-- N = 2 -->
<!-- T = 3 -->
<!-- # Calculando matriz de transformação between -->
<!-- iota_T = matrix(1, nrow=T, ncol=1) # vetor de 1's de dimensão T -->
<!-- I_N = diag(N) # Matriz identidade de dimensão N -->
<!-- B = I_N %x% (iota_T %*% solve(t(iota_T) %*% iota_T) %*% t(iota_T)) -->
<!-- B # matriz between -->
<!-- B %*% B # multiplicação matricial de matrizes between -->
<!-- t(B) # transposta da matriz between -->
<!-- ``` -->
<h3 id="estimação-via-plm-2">Estimação via <code>plm()</code></h3>
<p>Novamente, usaremos a base de dados <code>TobinQ</code> do pacote <code>pder</code> e queremos estimar o seguinte modelo:


$$ \text{ikn} = \beta_0 + \text{qn} \beta_1 + \varepsilon $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Carregando pacote e base de dados necessários</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">plm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Transformando no formato pdata frame, com indentificador de indivíduo e de tempo</span>
</span></span><span class="line"><span class="cl"><span class="n">pTobinQ</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;cusip&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimações</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.between</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;between&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.between</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Oneway (individual) effect Between Model
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Call:
</span></span><span class="line"><span class="cl">## plm(formula = ikn ~ qn, data = pTobinQ, model = &#34;between&#34;)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Balanced Panel: n = 188, T = 35, N = 6580
</span></span><span class="line"><span class="cl">## Observations used in estimation: 188
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Residuals:
</span></span><span class="line"><span class="cl">##      Min.   1st Qu.    Median   3rd Qu.      Max. 
</span></span><span class="line"><span class="cl">## -0.109457 -0.027820 -0.009795  0.024550  0.193177 
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Coefficients:
</span></span><span class="line"><span class="cl">##               Estimate Std. Error t-value  Pr(&gt;|t|)    
</span></span><span class="line"><span class="cl">## (Intercept) 0.15601353 0.00388203 40.1886 &lt; 2.2e-16 ***
</span></span><span class="line"><span class="cl">## qn          0.00518474 0.00074907  6.9216 7.013e-11 ***
</span></span><span class="line"><span class="cl">## ---
</span></span><span class="line"><span class="cl">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Total Sum of Squares:    0.50783
</span></span><span class="line"><span class="cl">## Residual Sum of Squares: 0.40382
</span></span><span class="line"><span class="cl">## R-Squared:      0.20482
</span></span><span class="line"><span class="cl">## Adj. R-Squared: 0.20054
</span></span><span class="line"><span class="cl">## F-statistic: 47.9079 on 1 and 186 DF, p-value: 7.0128e-11
</span></span></code></pre></div><!-- ### Estimação via lm() -->
<!-- Nós podemos construir as variáveis de média diretamente no data frame e fazer a estimação _between_ via `lm()` -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- # Pacote para manipular base de dados -->
<!-- library(dplyr) -->
<!-- # Criando "na mão" as variáveis de médias para cada indivíduo -->
<!-- TobinQ = TobinQ %>% group_by(cusip) %>% # agrupando por cusip (indivíduo) -->
<!--     mutate( -->
<!--         ikn_bar = mean(ikn), # "transformação" between de ikn -->
<!--         qn_bar = mean(qn), # "transformação" between de qn -->
<!--     ) %>% ungroup() -->
<!-- # Estimação between via lm() -->
<!-- Q.between.ols = lm(ikn_bar ~ qn_bar, TobinQ) -->
<!-- # Comparando as estimativas -->
<!-- summary(Q.between.ols)$coef # between via MQO -->
<!-- summary(Q.between)$coef # between ajustando graus de liberdade -->
<!-- ``` -->
<!-- - Note que o erro padrão está subestimado no output gerado por `lm()`. -->
<!-- - A rotina padrão de MQO retorna 

$\hat{\sigma}^2_l = \frac{\hat{\boldsymbol{\varepsilon}}' \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}}{NT-K-1}$ e, portanto, é necessário fazer ajuste dos graus de liberdade multiplicando a Matriz de Variâncias-Covariâncias dos Erros por 

$(NT-K-1) / (N-K-1)$. -->
<!--   - _Between_ perde 

$N(T-1)$ observações pois cada indivíduo fica apenas com 1 observação.  -->
<!-- ```{r} -->
<!-- # Pegando valores de N, T e K -->
<!-- N = 188 -->
<!-- T = 35 -->
<!-- K = 1 -->
<!-- # Ajustando a matriz de variância covariância do estimador -->
<!-- vcov.ols = vcov(Q.between.ols) -->
<!-- vcov.between = vcov.ols * (N*T - K - 1) / (N - K - 1) -->
<!-- se.between = sqrt( diag(vcov.between) ) -->
<!-- se.between -->
<!-- ``` -->
<h3 id="estimação-analítica-2">Estimação Analítica</h3>
<p>a) Criando vetores/matrizes e definindo <em>N</em>, <em>T</em> e <em>K</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando o vetor y</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">TobinQ[</span><span class="p">,</span><span class="s">&#34;ikn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="c1"># transformando coluna de data frame em matriz</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando a matriz de covariadas X com primeira coluna de 1&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span> <span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">TobinQ[</span><span class="p">,</span> <span class="s">&#34;qn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># juntando 1&#39;s com as covariadas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pegando valores N, T e K</span>
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">cusip</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="bp">T</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">year</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span> <span class="o">=</span> <span class="nf">ncol</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span>
</span></span></code></pre></div><p>b) Calculando a matriz <em>between</em></p>


$$ \boldsymbol{B} = \boldsymbol{I}_{N} \otimes \left[ \boldsymbol{\iota}_T \left( \boldsymbol{\iota}'_T \boldsymbol{\iota}_T  \right)^{-1} \boldsymbol{\iota}'_T \right] $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Criando matrizes between</span>
</span></span><span class="line"><span class="cl"><span class="n">iota_T</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="bp">T</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="c1"># vetor coluna de 1&#39;s de tamanho T</span>
</span></span><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho N</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="p">(</span><span class="n">iota_T</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">))</span>
</span></span></code></pre></div><p>c) Estimativas <em>Between</em> 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}}$</p>


$$ \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}} = (\boldsymbol{X}' \boldsymbol{B} \boldsymbol{X})^{-1} \boldsymbol{X}' \boldsymbol{B} \boldsymbol{y} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bhat_B</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">X</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="n">bhat_B</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.156013534
</span></span><span class="line"><span class="cl">## [2,] 0.005184737
</span></span></code></pre></div><p>d) Valores ajustados/preditos <em>Between</em> 

$\hat{\boldsymbol{y}}_{\scriptscriptstyle{B}}$</p>


$$ \hat{\boldsymbol{y}}_{\scriptscriptstyle{B}} = \boldsymbol{X} \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat_B</span> <span class="o">=</span> <span class="n">X</span> <span class="o">%*%</span> <span class="n">bhat_B</span>
</span></span></code></pre></div><p>e) Resíduos <em>Between</em> 

$\hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{B}}$</p>


$$ \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{B}} = \boldsymbol{y} - \hat{\boldsymbol{y}}_{\scriptscriptstyle{B}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ehat_B</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">yhat_B</span>
</span></span></code></pre></div><p>f) Variância do termo de erro</p>


$$ \hat{\sigma}^2_l \equiv  \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{B}} \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{B}}}{N - K - 1} $$
<p>Como 

$\hat{\sigma}^2_l$ é escalar, é conveniente transformar em &ldquo;matriz 1x1&rdquo; em número usando <code>as.numeric()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando variâncias dos termos de erro</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2l</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat_B</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">ehat_B</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">K</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><p><strong>IMPORTANTE</strong>: Ajustar os graus de liberdade do estimador <em>between</em> para 

$N - K - 1$ (ao invés de 

$NT - K - 1$)</p>
<p>g) Matriz de Variâncias-Covariâncias do Estimador <em>Between</em></p>


$$ \widehat{\text{Var}}(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}}) = \hat{\sigma}^2_l (\boldsymbol{X}' B \boldsymbol{X})^{-1} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de variância-covariância dos estimadores</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat_B</span> <span class="o">=</span> <span class="n">sig2l</span> <span class="o">*</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">X</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat_B</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]          [,2]
</span></span><span class="line"><span class="cl">## [1,]  1.507017e-05 -1.405770e-06
</span></span><span class="line"><span class="cl">## [2,] -1.405770e-06  5.611075e-07
</span></span></code></pre></div><p>i) Erros-padrão 

$\text{se}(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{B}})$</p>
<p>É a raiz quadrada da diagonal principal da Matriz de Variâncias-Covariâncias do Estimador</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_bhat_B</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vbhat_B</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">se_bhat_B</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.0038820321 0.0007490711
</span></span></code></pre></div><p>j) Estatística <em>t</em></p>


$$ t_{\hat{\beta}_k} = \frac{\hat{\beta}_k}{\text{se}(\hat{\beta}_k)} \tag{4.6}
$$ 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Cálculo da estatística t</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat_B</span> <span class="o">=</span> <span class="n">bhat_B</span> <span class="o">/</span> <span class="n">se_bhat_B</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat_B</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##           [,1]
</span></span><span class="line"><span class="cl">## [1,] 40.188625
</span></span><span class="line"><span class="cl">## [2,]  6.921555
</span></span></code></pre></div><p>k) P-valor</p>


$$ p_{\hat{\beta}_k} = 2.\Phi_{t_{(N-K-1)}}(-|t_{\hat{\beta}_k}|), \tag{4.7} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># p-valor</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat_B</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_bhat_B</span><span class="p">),</span> <span class="n">N</span><span class="o">-</span><span class="n">K</span><span class="m">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat_B</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## [1,] 1.227764e-93
</span></span><span class="line"><span class="cl">## [2,] 7.012814e-11
</span></span></code></pre></div><p>l) Tabela-resumo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">bhat_B</span><span class="p">,</span> <span class="n">se_bhat_B</span><span class="p">,</span> <span class="n">t_bhat_B</span><span class="p">,</span> <span class="n">p_bhat_B</span><span class="p">)</span> <span class="c1"># resultado Between</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                     se_bhat_B                       
</span></span><span class="line"><span class="cl">## [1,] 0.156013534 0.0038820321 40.188625 1.227764e-93
</span></span><span class="line"><span class="cl">## [2,] 0.005184737 0.0007490711  6.921555 7.012814e-11
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.between</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># resultado Between via plm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                Estimate   Std. Error   t-value     Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## (Intercept) 0.156013534 0.0038820321 40.188625 1.227764e-93
</span></span><span class="line"><span class="cl">## qn          0.005184737 0.0007490711  6.921555 7.012814e-11
</span></span></code></pre></div><h4 id="transformando-e-estimando-por-mqo-1">Transformando e estimando por MQO</h4>
<p>Além da forma mostrada anteriormente, podemos também transformar as variáveis e resolver por MQO, pré-multiplicando 

$\boldsymbol{X}$ e 

$\boldsymbol{y}$ por 

$ \boldsymbol{B}$, e definindo:</p>


$$\tilde{\boldsymbol{X}} \equiv \boldsymbol{B} \boldsymbol{X} \qquad \text{e} \qquad \tilde{\boldsymbol{y}} \equiv \boldsymbol{B} \boldsymbol{y}$$
<p>c&rsquo;) Estimativas <em>between</em> via MQO</p>


$$ \tilde{\hat{\boldsymbol{\beta}}}_{\scriptscriptstyle{MQO}} = (\tilde{\boldsymbol{X}}' \tilde{\boldsymbol{X}})^{-1} \tilde{\boldsymbol{X}}' \tilde{\boldsymbol{y}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Transformando variáveis</span>
</span></span><span class="line"><span class="cl"><span class="n">X_til</span> <span class="o">=</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl"><span class="n">y_til</span> <span class="o">=</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimando</span>
</span></span><span class="line"><span class="cl"><span class="n">bhat_OLS</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X_til</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y_til</span>
</span></span><span class="line"><span class="cl"><span class="n">bhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.156013534
</span></span><span class="line"><span class="cl">## [2,] 0.005184737
</span></span></code></pre></div><p>d&rsquo;) Valores ajustados/preditos <em>OLS</em></p>


$$ \hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}} = \tilde{\boldsymbol{X}} \tilde{\hat{\boldsymbol{\beta}}}_{\scriptscriptstyle{MQO}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat_OLS</span> <span class="o">=</span> <span class="n">X_til</span> <span class="o">%*%</span> <span class="n">bhat_OLS</span>
</span></span></code></pre></div><p>e&rsquo;) Resíduos MQO</p>


$$ \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}} = \boldsymbol{y} - \hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ehat_OLS</span> <span class="o">=</span> <span class="n">y_til</span> <span class="o">-</span> <span class="n">yhat_OLS</span>
</span></span></code></pre></div><p>f&rsquo;) Variância do termo de erro</p>


$$ \hat{\sigma}^2 \equiv  \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{N - K - 1} $$
<p>Como 

$\hat{\sigma}^2$ é escalar, é conveniente transformar em &ldquo;matriz 1x1&rdquo; em número usando <code>as.numeric()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando variâncias dos termos de erro</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2hat</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">K</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><p><strong>IMPORTANTE</strong>: Ajustar os graus de liberdade do estimador <em>between</em> para 

$N - K - 1$ (ao invés de 

$NT - K - 1$)</p>
<p>g) Matriz de Variâncias-Covariâncias do Estimador MQO</p>


$$ \widehat{\text{Var}}(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQO}}) = \hat{\sigma}^2 (\tilde{\boldsymbol{X}}' \tilde{\boldsymbol{X}})^{-1} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de variância-covariância dos estimadores</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat_OLS</span> <span class="o">=</span> <span class="n">sig2hat</span> <span class="o">*</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X_til</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]          [,2]
</span></span><span class="line"><span class="cl">## [1,]  1.507017e-05 -1.405770e-06
</span></span><span class="line"><span class="cl">## [2,] -1.405770e-06  5.611075e-07
</span></span></code></pre></div><p>i) Erros-padrão 

$\text{se}(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{OLS}})$</p>
<p>É a raiz quadrada da diagonal principal da Matriz de Variâncias-Covariâncias do Estimador</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_bhat_OLS</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vbhat_OLS</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">se_bhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.0038820321 0.0007490711
</span></span></code></pre></div><p>j) Estatística <em>t</em></p>


$$ t_{\hat{\beta}_k} = \frac{\hat{\beta}_k}{\text{se}(\hat{\beta}_k)} \tag{4.6}
$$ 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Cálculo da estatística t</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat_OLS</span> <span class="o">=</span> <span class="n">bhat_OLS</span> <span class="o">/</span> <span class="n">se_bhat_OLS</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##           [,1]
</span></span><span class="line"><span class="cl">## [1,] 40.188625
</span></span><span class="line"><span class="cl">## [2,]  6.921555
</span></span></code></pre></div><p>k) P-valor</p>


$$ p_{\hat{\beta}_k} = 2.\Phi_{t_{(N-K-1)}}(-|t_{\hat{\beta}_k}|), \tag{4.7} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># p-valor</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat_OLS</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_bhat_OLS</span><span class="p">),</span> <span class="n">N</span><span class="o">-</span><span class="n">K</span><span class="m">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## [1,] 1.227764e-93
</span></span><span class="line"><span class="cl">## [2,] 7.012814e-11
</span></span></code></pre></div><p>l) Tabela-resumo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">bhat_OLS</span><span class="p">,</span> <span class="n">se_bhat_OLS</span><span class="p">,</span> <span class="n">t_bhat_OLS</span><span class="p">,</span> <span class="n">p_bhat_OLS</span><span class="p">)</span> <span class="c1"># resultado Between via MQO</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                   se_bhat_OLS                       
</span></span><span class="line"><span class="cl">## [1,] 0.156013534 0.0038820321 40.188625 1.227764e-93
</span></span><span class="line"><span class="cl">## [2,] 0.005184737 0.0007490711  6.921555 7.012814e-11
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.between</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># resultado Between via plm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                Estimate   Std. Error   t-value     Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## (Intercept) 0.156013534 0.0038820321 40.188625 1.227764e-93
</span></span><span class="line"><span class="cl">## qn          0.005184737 0.0007490711  6.921555 7.012814e-11
</span></span></code></pre></div></br>
<h2 id="estimador-_within_-efeitos-fixos">Estimador <em>Within</em> (Efeitos Fixos)</h2>
<ul>
<li>Também conhecido como estimador de <strong>Efeitos Fixos</strong></li>
<li><strong>Não assume que 

$E(u | X) = 0$</strong></li>
<li>Ou seja, flexibilizamos o modelo para <strong>

$E(u | X) \neq $ constante</strong></li>
<li>Avalia desvios em relação às médias individuais</li>
</ul>
<p>O modelo a ser estimado é o MQO pré-multiplicado por 

$\boldsymbol{W} = \boldsymbol{I}_{NT} - \boldsymbol{B}$:


$$ \boldsymbol{Wy}\ =\ \boldsymbol{WX\beta} + \boldsymbol{W\varepsilon}\ =\ \boldsymbol{WX}^* \boldsymbol{\beta} + \boldsymbol{Wv}. $$
Note que a transformação <em>within</em> remove as variáveis invariantes no tempo, a coluna de 1&rsquo;s e o termo de erro individual 

$u$ (sobrando apenas 

$\varepsilon = v$).</p>
<ul>
<li>
<p>O estimador <em>within</em> é dado por


$$ \hat{\boldsymbol{\delta}}_{\scriptscriptstyle{W}}\ =\ (\boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{X}^{*} )^{-1} \boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{y} $$</p>
</li>
<li>
<p>A matriz de covariâncias do estimador pode ser obtida usando


\begin{align}
    V(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{W}}) &= (\boldsymbol{X}^{*\prime}\boldsymbol{WX}^*)^{-1} \boldsymbol{X}' \boldsymbol{W}\boldsymbol{\Sigma} \boldsymbol{W} \boldsymbol{X} (\boldsymbol{X}^{*\prime}\boldsymbol{WX}^*)^{-1} \\
    &\ \ \vdots \\
    &= \sigma^2_v (\boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{X}^{*})^{-1}.
\end{align}</p>
</li>
<li>
<p>O estimador não-viesado de 

$\sigma^2_v$ é


$$ \hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}' \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}}{NT-K-N} $$</p>
</li>
<li>
<p>O estimador <em>within</em> também pode ser estimado por MQO, transformando as variáveis por pré-multiplicação da matriz <em>within</em> 

$(\boldsymbol{W})$:


$$ \tilde{\boldsymbol{X}}^* \equiv \boldsymbol{WX}^* \qquad \text{ e } \qquad \tilde{\boldsymbol{y}} \equiv \boldsymbol{Wy} $$</p>
</li>
</ul>
<p>Então</p>


\begin{align} \hat{\boldsymbol{\delta}}_{\scriptscriptstyle{W}} &= (\boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{X}^{*} )^{-1} \boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{y} \\
&= (\boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{W} \boldsymbol{X}^{*} )^{-1} \boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{W} \boldsymbol{y} \\
&= (\boldsymbol{X}^{*\prime} \boldsymbol{W}' \boldsymbol{W} \boldsymbol{X}^{*} )^{-1} \boldsymbol{X}^{*\prime} \boldsymbol{W}' \boldsymbol{W} \boldsymbol{y} \\
&= ([\boldsymbol{W} \boldsymbol{X}^{*}]' \boldsymbol{W} \boldsymbol{X}^{*} )^{-1} [\boldsymbol{W} \boldsymbol{X}^{*}]' \boldsymbol{W} \boldsymbol{y} \\
&\equiv ( \tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{X}^{*}} )^{-1} \tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{y}} = \tilde{\hat{\boldsymbol{\delta}}}_{\scriptscriptstyle{MQO}} \end{align}
<p>Note que usamos:


$$ \boldsymbol{W} = \boldsymbol{W}\boldsymbol{W} \qquad \text{e} \qquad \boldsymbol{W}=\boldsymbol{W}' $$</p>
<!-- ```{r} -->
<!-- # Exemplo N = 2 e T = 3 -->
<!-- N = 2 -->
<!-- T = 3 -->
<!-- I_NT = diag(N*T) # Matriz identidade de dimensão N -->
<!-- W = I_NT - B -->
<!-- W # matriz within -->
<!-- W %*% W # multiplicação matricial de matrizes within -->
<!-- t(W) # transposta da matriz within -->
<!-- ``` -->
<h3 id="estimação-via-plm-3">Estimação via <code>plm()</code></h3>
<p>Novamente, usaremos a base de dados <code>TobinQ</code> do pacote <code>pder</code> e queremos estimar o seguinte modelo:


$$ \text{ikn} = \beta_0 + \text{qn} \beta + \varepsilon $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Carregando pacote e base de dados necessários</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">plm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Transformando no formato pdata frame, com indentificador de indivíduo e de tempo</span>
</span></span><span class="line"><span class="cl"><span class="n">pTobinQ</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;cusip&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Comparando as estimativas</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.within</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;within&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.within</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Oneway (individual) effect Within Model
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Call:
</span></span><span class="line"><span class="cl">## plm(formula = ikn ~ qn, data = pTobinQ, model = &#34;within&#34;)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Balanced Panel: n = 188, T = 35, N = 6580
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Residuals:
</span></span><span class="line"><span class="cl">##       Min.    1st Qu.     Median    3rd Qu.       Max. 
</span></span><span class="line"><span class="cl">## -0.2163093 -0.0452458 -0.0084941  0.0336543  0.6184391 
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Coefficients:
</span></span><span class="line"><span class="cl">##      Estimate Std. Error t-value  Pr(&gt;|t|)    
</span></span><span class="line"><span class="cl">## qn 0.00379195 0.00017264  21.964 &lt; 2.2e-16 ***
</span></span><span class="line"><span class="cl">## ---
</span></span><span class="line"><span class="cl">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Total Sum of Squares:    36.657
</span></span><span class="line"><span class="cl">## Residual Sum of Squares: 34.084
</span></span><span class="line"><span class="cl">## R-Squared:      0.070185
</span></span><span class="line"><span class="cl">## Adj. R-Squared: 0.042833
</span></span><span class="line"><span class="cl">## F-statistic: 482.412 on 1 and 6391 DF, p-value: &lt; 2.22e-16
</span></span></code></pre></div><ul>
<li>Observe que:
<ul>
<li>as variáveis entram na estimação sem nenhuma transformação e</li>
<li>cada método possui diferentes graus de liberdade</li>
</ul>
</li>
</ul>
<!-- ### Estimação via lm() -->
<!-- Nós podemos construir as variáveis de média e de desvios de média diretamente no data frame e fazer a estimação _within_ via `lm()` -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- # Pacote para manipular base de dados -->
<!-- library(dplyr) -->
<!-- # Criando "na mão" as variáveis de desvios da média para cada indivíduo -->
<!-- TobinQ = TobinQ %>% group_by(cusip) %>% # agrupando por cusip (indivíduo) -->
<!--     mutate( -->
<!--         ikn_bar = mean(ikn), # "transformação" between de ikn -->
<!--         qn_bar = mean(qn), # "transformação" between de qn -->
<!--         ikn_desv = ikn - ikn_bar, # "transformação" within de ikn -->
<!--         qn_desv = qn - qn_bar # "transformação" within de qn -->
<!--     ) %>% ungroup() -->
<!-- # Estimação within via lm() -->
<!-- Q.within.ols = lm(ikn_desv ~ 0 + qn_desv, TobinQ) # retira intercepto com 0 -->
<!-- # Comparando as estimativas -->
<!-- summary(Q.within.ols)$coef # within via MQO -->
<!-- summary(Q.within)$coef # within ajustando graus de liberdade -->
<!-- ``` -->
<!-- - Note que o erro padrão está subestimado no output gerado por `lm()`. -->
<!-- - A rotina padrão de MQO retorna 

$\hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}' \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}}{NT-K-1}$ e, portanto, é necessário fazer ajuste dos graus de liberdade multiplicando a Matriz de Variâncias-Covariâncias dos Erros por 

$(NT-K-1) / (NT-K-N)$. -->
<!--   - _Within_ estima mais 

$N$ parâmetros (efeitos fixos dos indivíduos) e deixa de estimar o intercepto.  -->
<!-- ```{r} -->
<!-- # Pegando valores de N, T e K -->
<!-- N = 188 -->
<!-- T = 35 -->
<!-- K = 1 -->
<!-- # Ajustando a matriz de variância covariância do estimador -->
<!-- vcov.ols = vcov(Q.within.ols) -->
<!-- vcov.within = vcov.ols * (N*T - K - 1) / (N*(T-1) - K) -->
<!-- se.within = sqrt( diag(vcov.within) ) -->
<!-- se.within -->
<!-- ``` -->
<h3 id="estimação-analítica-3">Estimação Analítica</h3>
<p>a) Criando vetores/matrizes e definindo <em>N</em>, <em>T</em> e <em>K</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando o vetor y</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">TobinQ[</span><span class="p">,</span><span class="s">&#34;ikn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="c1"># transformando coluna de data frame em matriz</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando a matriz/vetor de covariadas variantes no tempo Xt</span>
</span></span><span class="line"><span class="cl"><span class="n">Xt</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span> <span class="n">TobinQ[</span><span class="p">,</span> <span class="s">&#34;qn&#34;</span><span class="n">]</span> <span class="p">)</span> <span class="c1"># não junta com coluna de 1&#39;s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pegando valores N, T e K</span>
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">cusip</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="bp">T</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">year</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span> <span class="o">=</span> <span class="nf">ncol</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="c1"># não subtrai 1</span>
</span></span></code></pre></div><p>b) Calculando as matrizes <em>between</em> e <em>within</em></p>


$$ \boldsymbol{B} = \boldsymbol{I}_{N} \otimes \left[ \boldsymbol{\iota}_T \left( \boldsymbol{\iota}'_T \boldsymbol{\iota}_T  \right)^{-1} \boldsymbol{\iota}'_T \right] \qquad \text{e} \qquad \boldsymbol{W} = \boldsymbol{I}_{NT} - \boldsymbol{B} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Criando matrizes between</span>
</span></span><span class="line"><span class="cl"><span class="n">iota_T</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="bp">T</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="c1"># vetor coluna de 1&#39;s de tamanho T</span>
</span></span><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho N</span>
</span></span><span class="line"><span class="cl"><span class="n">I_NT</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho NT</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="p">(</span><span class="n">iota_T</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">W</span> <span class="o">=</span> <span class="n">I_NT</span> <span class="o">-</span> <span class="n">B</span>
</span></span></code></pre></div><p>c) Estimativas <em>Within</em> 

$\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{W}}$</p>


$$ \hat{\boldsymbol{\delta}}_{\scriptscriptstyle{W}} = (\boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{X}^{*})^{-1} \boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{y} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dhat_W</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">Xt</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="n">dhat_W</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.003791948
</span></span></code></pre></div><p>d) Valores ajustados/preditos <em>Within</em> 

$\hat{\boldsymbol{y}}_{\scriptscriptstyle{W}}$</p>


$$ \hat{\boldsymbol{y}}_{\scriptscriptstyle{W}} = \boldsymbol{X}^{*} \hat{\boldsymbol{\delta}}_{\scriptscriptstyle{W}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat_W</span> <span class="o">=</span> <span class="n">Xt</span> <span class="o">%*%</span> <span class="n">dhat_W</span>
</span></span></code></pre></div><p>e) Resíduos <em>Within</em> 

$\hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{W}}$</p>


$$ \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{W}} = \boldsymbol{y} - \hat{\boldsymbol{y}}_{\scriptscriptstyle{W}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ehat_W</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">yhat_W</span>
</span></span></code></pre></div><p>f) Variância do termo de erro</p>


$$ \hat{\sigma}^2_v =  \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{W}} \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{W}}}{NT - K - N} $$
<p>Como 

$\hat{\sigma}^2_v$ é escalar, é conveniente transformar em &ldquo;matriz 1x1&rdquo; em número usando <code>as.numeric()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando variâncias dos termos de erro</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2v</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat_W</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">ehat_W</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span> <span class="o">-</span> <span class="n">K</span> <span class="o">-</span> <span class="n">N</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><p><strong>IMPORTANTE</strong>: Ajustar os graus de liberdade do estimador <em>within</em> para 

$NT - K - N$ (ao invés de 

$NT - K - 1$)</p>
<p>g) Matriz de Variâncias-Covariâncias do Estimador <em>Within</em></p>


$$ \widehat{\text{Var}}(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{W}}) = \hat{\sigma}^2_v (\boldsymbol{X}^{*\prime} \boldsymbol{W} \boldsymbol{X}^{*})^{-1} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de variância-covariância dos estimadores</span>
</span></span><span class="line"><span class="cl"><span class="n">Vdhat_W</span> <span class="o">=</span> <span class="n">sig2v</span> <span class="o">*</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">Xt</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vdhat_W</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 2.98062e-08
</span></span></code></pre></div><p>i) Erros-padrão 

$\text{se}(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{W}})$</p>
<p>É a raiz quadrada da diagonal principal da Matriz de Variâncias-Covariâncias do Estimador</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_dhat_W</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vdhat_W</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">se_dhat_W</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.0001726447
</span></span></code></pre></div><p>j) Estatística <em>t</em></p>


$$ t_{\hat{\delta}_k} = \frac{\hat{\delta}_k}{\text{se}(\hat{\delta}_k)} \tag{4.6}
$$ 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Cálculo da estatística t</span>
</span></span><span class="line"><span class="cl"><span class="n">t_dhat_W</span> <span class="o">=</span> <span class="n">dhat_W</span> <span class="o">/</span> <span class="n">se_dhat_W</span>
</span></span><span class="line"><span class="cl"><span class="n">t_dhat_W</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##          [,1]
</span></span><span class="line"><span class="cl">## [1,] 21.96388
</span></span></code></pre></div><p>k) P-valor</p>


$$ p_{\hat{\delta}_k} = 2.\Phi_{t_{(NT-K-N)}}(-|t_{\hat{\delta}_k}|), \tag{4.7} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># p-valor</span>
</span></span><span class="line"><span class="cl"><span class="n">p_dhat_W</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_dhat_W</span><span class="p">),</span> <span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="o">-</span><span class="n">K</span><span class="o">-</span><span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_dhat_W</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]
</span></span><span class="line"><span class="cl">## [1,] 3.854128e-103
</span></span></code></pre></div><p>l) Tabela-resumo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">dhat_W</span><span class="p">,</span> <span class="n">se_dhat_W</span><span class="p">,</span> <span class="n">t_dhat_W</span><span class="p">,</span> <span class="n">p_dhat_W</span><span class="p">)</span> <span class="c1"># resultado Within</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                     se_dhat_W                       
</span></span><span class="line"><span class="cl">## [1,] 0.003791948 0.0001726447 21.96388 3.854128e-103
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.within</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># resultado Within via plm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##       Estimate   Std. Error  t-value      Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## qn 0.003791948 0.0001726447 21.96388 3.854128e-103
</span></span></code></pre></div><h4 id="transformando-e-estimando-por-mqo-2">Transformando e estimando por MQO</h4>
<p>Além da forma mostrada anteriormente, podemos também transformar as variáveis e resolver por MQO, pré-multiplicando 

$\boldsymbol{X}^{*}$ e 

$\boldsymbol{y}$ por 

$ \boldsymbol{W}$, e definindo:</p>


$$\tilde{\boldsymbol{X}^{*}} \equiv \boldsymbol{W} \boldsymbol{X}^{*} \qquad \text{e} \qquad \tilde{\boldsymbol{y}} \equiv \boldsymbol{W} \boldsymbol{y}$$
<p>c&rsquo;) Estimativas <em>within</em> via MQO</p>


$$ \tilde{\hat{\boldsymbol{\delta}}}_{\scriptscriptstyle{MQO}} = (\tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{X}^{*}})^{-1} \tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{y}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Transformando variáveis</span>
</span></span><span class="line"><span class="cl"><span class="n">Xt_til</span> <span class="o">=</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">Xt</span>
</span></span><span class="line"><span class="cl"><span class="n">y_til</span> <span class="o">=</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimando</span>
</span></span><span class="line"><span class="cl"><span class="n">dhat_OLS</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">Xt_til</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y_til</span>
</span></span><span class="line"><span class="cl"><span class="n">dhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.003791948
</span></span></code></pre></div><p>d&rsquo;) Valores ajustados/preditos <em>OLS</em></p>


$$ \hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}} = \tilde{\boldsymbol{X}^{*}} \tilde{\hat{\boldsymbol{\delta}}}_{\scriptscriptstyle{MQO}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat_OLS</span> <span class="o">=</span> <span class="n">Xt_til</span> <span class="o">%*%</span> <span class="n">dhat_OLS</span>
</span></span></code></pre></div><p>e&rsquo;) Resíduos MQO</p>


$$ \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}} = \boldsymbol{y} - \hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ehat_OLS</span> <span class="o">=</span> <span class="n">y_til</span> <span class="o">-</span> <span class="n">yhat_OLS</span>
</span></span></code></pre></div><p>f&rsquo;) Variância do termo de erro</p>


$$ \hat{\sigma}^2 \equiv  \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{NT - K - N} $$
<p>Como 

$\hat{\sigma}^2$ é escalar, é conveniente transformar em &ldquo;matriz 1x1&rdquo; em número usando <code>as.numeric()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando variâncias dos termos de erro</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2hat</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span> <span class="o">-</span> <span class="n">K</span> <span class="o">-</span> <span class="n">N</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><p><strong>IMPORTANTE</strong>: Ajustar os graus de liberdade do estimador <em>within</em> para 

$NT - K - N$ (ao invés de 

$NT - K - 1$)</p>
<p>g&rsquo;) Matriz de Variâncias-Covariâncias do Estimador MQO</p>


$$ \widehat{\text{Var}}(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{MQO}}) = \hat{\sigma}^2 (\tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{X}^{*}})^{-1} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de variância-covariância dos estimadores</span>
</span></span><span class="line"><span class="cl"><span class="n">Vdhat_OLS</span> <span class="o">=</span> <span class="n">sig2hat</span> <span class="o">*</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">Xt_til</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vdhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 2.98062e-08
</span></span></code></pre></div><p>h&rsquo;) Erros-padrão 

$\text{se}(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{OLS}})$</p>
<p>É a raiz quadrada da diagonal principal da Matriz de Variâncias-Covariâncias do Estimador</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_dhat_OLS</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vdhat_OLS</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">se_dhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.0001726447
</span></span></code></pre></div><p>i&rsquo;) Estatística <em>t</em></p>


$$ t_{\hat{\delta}_k} = \frac{\hat{\delta}_k}{\text{se}(\hat{\delta}_k)} \tag{4.6}
$$ 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Cálculo da estatística t</span>
</span></span><span class="line"><span class="cl"><span class="n">t_dhat_OLS</span> <span class="o">=</span> <span class="n">dhat_OLS</span> <span class="o">/</span> <span class="n">se_dhat_OLS</span>
</span></span><span class="line"><span class="cl"><span class="n">t_dhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##          [,1]
</span></span><span class="line"><span class="cl">## [1,] 21.96388
</span></span></code></pre></div><p>j&rsquo;) P-valor</p>


$$ p_{\hat{\delta}_k} = 2.\Phi_{t_{(NT-K-N)}}(-|t_{\hat{\delta}_k}|), \tag{4.7} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># p-valor</span>
</span></span><span class="line"><span class="cl"><span class="n">p_dhat_OLS</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_dhat_OLS</span><span class="p">),</span> <span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="o">-</span><span class="n">K</span><span class="o">-</span><span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_dhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]
</span></span><span class="line"><span class="cl">## [1,] 3.854128e-103
</span></span></code></pre></div><p>k&rsquo;) Tabela-resumo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">dhat_OLS</span><span class="p">,</span> <span class="n">se_dhat_OLS</span><span class="p">,</span> <span class="n">t_dhat_OLS</span><span class="p">,</span> <span class="n">p_dhat_OLS</span><span class="p">)</span> <span class="c1"># resultado Within via MQO</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                   se_dhat_OLS                       
</span></span><span class="line"><span class="cl">## [1,] 0.003791948 0.0001726447 21.96388 3.854128e-103
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.within</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># resultado Within via plm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##       Estimate   Std. Error  t-value      Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## qn 0.003791948 0.0001726447 21.96388 3.854128e-103
</span></span></code></pre></div><h3 id="efeitos-fixos-do-_within_">Efeitos Fixos do <em>Within</em></h3>
<ul>
<li>Para o estimador <em>within</em>, podemos usar a função <code>fixef()</code> para computar os efeitos individuais. É possível visualizar os efeitos fixos de três formas por meio do argumento <code>type</code>:
<ul>
<li><code>level</code>: valor padrão que retorna os interceptos individuais</li>
<li><code>dfirst</code>: em desvios do 1º indivíduo</li>
<li><code>dmean</code>: em desvios da média de efeitos individuais</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 6 primeiros efeitos individuais de cada tipo</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span> <span class="nf">fixef</span><span class="p">(</span><span class="n">Q.within</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;level&#34;</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># 6 primeiros valores em nível</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      2824      6284      9158     13716     17372     19411 
</span></span><span class="line"><span class="cl">## 0.1452896 0.1280547 0.2580836 0.1100110 0.1267251 0.1694891
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span> <span class="nf">fixef</span><span class="p">(</span><span class="n">Q.within</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;dfirst&#34;</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># 6 primeiros valores em relação ao 1º indiv.</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##        6284        9158       13716       17372       19411       19519 
</span></span><span class="line"><span class="cl">## -0.01723488  0.11279400 -0.03527859 -0.01856442  0.02419952 -0.01038237
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span> <span class="nf">fixef</span><span class="p">(</span><span class="n">Q.within</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;dmean&#34;</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># 6 primeiros valores em desvios da média</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##         2824         6284         9158        13716        17372        19411 
</span></span><span class="line"><span class="cl">## -0.014213401 -0.031448285  0.098580596 -0.049491991 -0.032777823  0.009986116
</span></span></code></pre></div><ul>
<li>Note que, como o <code>dfirst</code> retorna valores em relação ao 1º indivíduo e, portanto, este não aparece no output do <code>fixef()</code>.</li>
<li>No caso linear, o estimador <em>within</em> é equivalente à estimação por MQO com inclusão de dummies para cada indivíduo (efeitos fixos dos indivíduos):</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Estimando MQO com dummies individuais - factor() tranforma cusip em var. categ.</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.dummies1</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="m">0</span> <span class="o">+</span> <span class="n">qn</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">cusip</span><span class="p">),</span> <span class="n">TobinQ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Comparando as estimativas de qn e efeitos individuais</span>
</span></span><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">Q.dummies1</span><span class="o">$</span><span class="n">coef[1</span><span class="o">:</span><span class="m">7</span><span class="n">]</span><span class="p">,</span> <span class="c1"># coef MQO incluindo dummies</span>
</span></span><span class="line"><span class="cl">  <span class="nf">c</span><span class="p">(</span><span class="n">Q.within</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span> <span class="nf">fixef</span><span class="p">(</span><span class="n">Q.within</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;level&#34;</span><span class="p">)</span><span class="n">[1</span><span class="o">:</span><span class="m">6</span><span class="n">]</span><span class="p">)</span> <span class="c1"># coef within + 6 efeitos fixos</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                           [,1]        [,2]
</span></span><span class="line"><span class="cl">## qn                 0.003791948 0.003791948
</span></span><span class="line"><span class="cl">## factor(cusip)2824  0.145289553 0.145289553
</span></span><span class="line"><span class="cl">## factor(cusip)6284  0.128054670 0.128054670
</span></span><span class="line"><span class="cl">## factor(cusip)9158  0.258083550 0.258083550
</span></span><span class="line"><span class="cl">## factor(cusip)13716 0.110010964 0.110010964
</span></span><span class="line"><span class="cl">## factor(cusip)17372 0.126725132 0.126725132
</span></span><span class="line"><span class="cl">## factor(cusip)19411 0.169489071 0.169489071
</span></span></code></pre></div><ul>
<li>Se estimássemos o MQO com efeitos fixos usando um intercepto, o intercepto seria o valor do efeito fixo do 1º indivíduo e os valores dos efeitos fixos dos demais indivíduos seriam em relação a este.
<ul>
<li>A dummy do 1º indivíduo seria retirado para não haver multicolinearidade perfeita</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Estimando MQO com dummies individuais - factor() tranforma cusip em var. categ.</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.dummies2</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">cusip</span><span class="p">),</span> <span class="n">TobinQ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Comparando as estimativas de qn e efeitos individuais</span>
</span></span><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">Q.dummies2</span><span class="o">$</span><span class="n">coef[1</span><span class="o">:</span><span class="m">7</span><span class="n">]</span><span class="p">,</span> <span class="c1"># coef MQO incluindo dummies</span>
</span></span><span class="line"><span class="cl">  <span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span> <span class="n">Q.within</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span> <span class="nf">fixef</span><span class="p">(</span><span class="n">Q.within</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;dfirst&#34;</span><span class="p">)</span><span class="n">[1</span><span class="o">:</span><span class="m">5</span><span class="n">]</span><span class="p">)</span> <span class="c1"># coef within + 6 efeitos fixos</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                            [,1]         [,2]
</span></span><span class="line"><span class="cl">## (Intercept)         0.145289553           NA
</span></span><span class="line"><span class="cl">## qn                  0.003791948  0.003791948
</span></span><span class="line"><span class="cl">## factor(cusip)6284  -0.017234884 -0.017234884
</span></span><span class="line"><span class="cl">## factor(cusip)9158   0.112793997  0.112793997
</span></span><span class="line"><span class="cl">## factor(cusip)13716 -0.035278589 -0.035278589
</span></span><span class="line"><span class="cl">## factor(cusip)17372 -0.018564422 -0.018564422
</span></span><span class="line"><span class="cl">## factor(cusip)19411  0.024199517  0.024199517
</span></span></code></pre></div></br>
<h2 id="estimador-de-primeiras-diferenças">Estimador de Primeiras-Diferenças</h2>
<ul>
<li><strong>Não assume que 

$E(u | X) = 0$</strong></li>
<li>Ou seja, flexibilizamos o modelo para <strong>

$E(u | X) \neq $ constante</strong></li>
<li>Avalia as variações de uma observação em relação à observação do período imediatamente seguinte</li>
</ul>
<p>O modelo a ser estimado é o MQO pré-multiplicado por 

$\boldsymbol{D}$:


$$ \boldsymbol{Dy}\ =\ \boldsymbol{DX\beta} + \boldsymbol{D\varepsilon}\ =\ \boldsymbol{DX}^* \boldsymbol{\delta} + \boldsymbol{Dv}. $$
Note que a transformação de primeiras-diferenças remove as variáveis invariantes no tempo, a coluna de 1&rsquo;s e o termo de erro individual 

$\boldsymbol{u}$ (sobrando apenas 

$\boldsymbol{\varepsilon} = \boldsymbol{v}$).</p>
<ul>
<li>
<p>O estimador de primeiras-diferenças é dado por


$$ \hat{\boldsymbol{\delta}}_{\scriptscriptstyle{FD}}\ =\ (\boldsymbol{X}^{*\prime} \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X}^{*} )^{-1} \boldsymbol{X}^{*\prime} \boldsymbol{D}' \boldsymbol{D} \boldsymbol{y} $$</p>
</li>
<li>
<p>O estimador não-viesado de 

$\sigma^2_v$ é


$$ \hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}' \boldsymbol{D}' \boldsymbol{D} \hat{\boldsymbol{\varepsilon}}}{NT-K-N} $$</p>
</li>
<li>
<p>A matriz de covariâncias do estimador pode ser obtida usando


$$`
    V(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{FD}}) = \sigma^2_v \Big[  (\boldsymbol{X}^{*\prime}  \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X}^*)^{-1} \boldsymbol{X}' \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X} (\boldsymbol{X}^{*\prime} \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X}^*)^{-1} \Big]
`$$</p>
</li>
<li>
<p>O estimador de primeiras-diferenças também pode ser estimado por MQO, transformando as variáveis por pré-multiplicação da matriz primeiras-diferenças 

$(\boldsymbol{D})$:


$$ \tilde{\boldsymbol{X}}^* \equiv \boldsymbol{DX}^* \qquad \text{ e } \qquad \tilde{\boldsymbol{y}} \equiv \boldsymbol{Dy} $$</p>
</li>
</ul>
<p>Então</p>


\begin{align} \hat{\boldsymbol{\delta}}_{\scriptscriptstyle{FD}} &= (\boldsymbol{X}^{*\prime} \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X}^{*} )^{-1} \boldsymbol{X}^{*\prime} \boldsymbol{D}' \boldsymbol{D} \boldsymbol{y} \\
&= ([\boldsymbol{D} \boldsymbol{X}^{*}]' \boldsymbol{D} \boldsymbol{X}^{*} )^{-1} [\boldsymbol{D} \boldsymbol{X}^{*}]' \boldsymbol{D} \boldsymbol{y} \\
&\equiv ( \tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{X}^{*}} )^{-1} \tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{y}} = \tilde{\hat{\boldsymbol{\delta}}}_{\scriptscriptstyle{MQO}} \end{align}
<p>Note que 

$\boldsymbol{D}$ não é uma matriz quadrada como as demais matrizes de transformação e, portanto:


$$ \boldsymbol{D} \neq \boldsymbol{D}\boldsymbol{D} \qquad \text{e} \qquad \boldsymbol{D} \neq \boldsymbol{D}' $$</p>
<h3 id="estimação-via-plm-4">Estimação via <code>plm()</code></h3>
<p>Novamente, usaremos a base de dados <code>TobinQ</code> do pacote <code>pder</code> e queremos estimar o seguinte modelo:


$$ \text{ikn} = \beta_0 + \text{qn} \beta + \varepsilon $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Carregando pacote e base de dados necessários</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">plm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Transformando no formato pdata frame, com indentificador de indivíduo e de tempo</span>
</span></span><span class="line"><span class="cl"><span class="n">pTobinQ</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;cusip&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimações</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.fd</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="m">0</span> <span class="o">+</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;fd&#34;</span><span class="p">)</span> <span class="c1"># estimação primeiras-diferenças</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.within</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;within&#34;</span><span class="p">)</span> <span class="c1"># estimação within</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Comparando as estimativas</span>
</span></span><span class="line"><span class="cl"><span class="n">stargazer</span><span class="o">::</span><span class="nf">stargazer</span><span class="p">(</span><span class="n">Q.fd</span><span class="p">,</span> <span class="n">Q.within</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## =======================================================
</span></span><span class="line"><span class="cl">##                                Dependent variable:     
</span></span><span class="line"><span class="cl">##                            ----------------------------
</span></span><span class="line"><span class="cl">##                                        ikn             
</span></span><span class="line"><span class="cl">##                                 (1)            (2)     
</span></span><span class="line"><span class="cl">## -------------------------------------------------------
</span></span><span class="line"><span class="cl">## qn                            0.004***      0.004***   
</span></span><span class="line"><span class="cl">##                               (0.0003)      (0.0002)   
</span></span><span class="line"><span class="cl">##                                                        
</span></span><span class="line"><span class="cl">## -------------------------------------------------------
</span></span><span class="line"><span class="cl">## Observations                   6,392          6,580    
</span></span><span class="line"><span class="cl">## R2                             0.026          0.070    
</span></span><span class="line"><span class="cl">## Adjusted R2                    0.026          0.043    
</span></span><span class="line"><span class="cl">## F Statistic (df = 1; 6391)   171.014***    482.412***  
</span></span><span class="line"><span class="cl">## =======================================================
</span></span><span class="line"><span class="cl">## Note:                       *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
</span></span></code></pre></div><ul>
<li>Observe que:
<ul>
<li>as variáveis entram na estimação sem nenhuma transformação e</li>
<li>ambos métodos possuem mesmos graus de liberdade</li>
</ul>
</li>
</ul>
<!-- ### Estimação via lm() -->
<!-- Nós podemos construir as variáveis de média e de desvios de média diretamente no data frame e fazer a estimação _within_ via `lm()` -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- # Pacote para manipular base de dados -->
<!-- library(dplyr) -->
<!-- # Criando "na mão" as variáveis de desvios da média para cada indivíduo -->
<!-- TobinQ = TobinQ %>% group_by(cusip) %>% # agrupando por cusip (indivíduo) -->
<!--     mutate( -->
<!--         ikn_bar = mean(ikn), # "transformação" between de ikn -->
<!--         qn_bar = mean(qn), # "transformação" between de qn -->
<!--         ikn_desv = ikn - ikn_bar, # "transformação" within de ikn -->
<!--         qn_desv = qn - qn_bar # "transformação" within de qn -->
<!--     ) %>% ungroup() -->
<!-- # Estimação within via lm() -->
<!-- Q.within.ols = lm(ikn_desv ~ 0 + qn_desv, TobinQ) # retira intercepto com 0 -->
<!-- # Comparando as estimativas -->
<!-- summary(Q.within.ols)$coef # within via MQO -->
<!-- summary(Q.within)$coef # within ajustando graus de liberdade -->
<!-- ``` -->
<!-- - Note que o erro padrão está subestimado no output gerado por `lm()`. -->
<!-- - A rotina padrão de MQO retorna 

$\hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}' \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}}{NT-K-1}$ e, portanto, é necessário fazer ajuste dos graus de liberdade multiplicando a Matriz de Variâncias-Covariâncias dos Erros por 

$(NT-K-1) / (NT-K-N)$. -->
<!--   - _Within_ estima mais 

$N$ parâmetros (efeitos fixos dos indivíduos) e deixa de estimar o intercepto.  -->
<!-- ```{r} -->
<!-- # Pegando valores de N, T e K -->
<!-- N = 188 -->
<!-- T = 35 -->
<!-- K = 1 -->
<!-- # Ajustando a matriz de variância covariância do estimador -->
<!-- vcov.ols = vcov(Q.within.ols) -->
<!-- vcov.within = vcov.ols * (N*T - K - 1) / (N*(T-1) - K) -->
<!-- se.within = sqrt( diag(vcov.within) ) -->
<!-- se.within -->
<!-- ``` -->
<h3 id="estimação-analítica-4">Estimação Analítica</h3>
<p>a) Criando vetores/matrizes e definindo <em>N</em>, <em>T</em> e <em>K</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando o vetor y</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">TobinQ[</span><span class="p">,</span><span class="s">&#34;ikn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="c1"># transformando coluna de data frame em matriz</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando a matriz/vetor de covariadas variantes no tempo Xt</span>
</span></span><span class="line"><span class="cl"><span class="n">Xt</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span> <span class="n">TobinQ[</span><span class="p">,</span> <span class="s">&#34;qn&#34;</span><span class="n">]</span> <span class="p">)</span> <span class="c1"># não junta com coluna de 1&#39;s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pegando valores N, T e K</span>
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">cusip</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="bp">T</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">year</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span> <span class="o">=</span> <span class="nf">ncol</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="c1"># não subtrai 1</span>
</span></span></code></pre></div><p>b) Calculando a matrizes de primeiras diferenças</p>
<p>

$$\boldsymbol{D} = \boldsymbol{I}_N \otimes \boldsymbol{D}_i $$
em que


$$\boldsymbol{D}_i = \begin{bmatrix}
-1 & 1 & 0 & \cdots & 0 & 0 \\
0 & -1 & 1 & \cdots & 0 & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\
0 & 0 & 0 & \cdots & -1 & 1
\end{bmatrix}_{(T-1)\times T}$$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Di</span> <span class="o">=</span> <span class="o">-</span><span class="nf">diag</span><span class="p">(</span><span class="bp">T</span><span class="p">)</span> <span class="c1"># diagonal -1</span>
</span></span><span class="line"><span class="cl"><span class="nf">diag</span><span class="p">(</span><span class="n">Di[</span><span class="o">-</span><span class="nf">nrow</span><span class="p">(</span><span class="n">Di</span><span class="p">),</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span> <span class="o">=</span> <span class="m">1</span> <span class="c1"># supradiagonal</span>
</span></span><span class="line"><span class="cl"><span class="n">Di</span> <span class="o">=</span> <span class="n">Di[</span><span class="o">-</span><span class="nf">nrow</span><span class="p">(</span><span class="n">Di</span><span class="p">),</span><span class="n">]</span> <span class="c1"># retira última linha</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># matriz identidade de tamanho N</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="n">Di</span>
</span></span></code></pre></div><p>c) Estimativas  de Primeiras-Diferenças 

$\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{FD}}$</p>


$$ \hat{\boldsymbol{\delta}}_{\scriptscriptstyle{FD}} = (\boldsymbol{X}^{*\prime} \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X}^{*})^{-1} \boldsymbol{X}^{*\prime} \boldsymbol{D}' \boldsymbol{D} \boldsymbol{y} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dhat_FD</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">D</span> <span class="o">%*%</span> <span class="n">Xt</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">D</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="n">dhat_FD</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.004012382
</span></span></code></pre></div><p>d) Valores ajustados/preditos de Primeiras-Diferenças 

$\hat{\boldsymbol{y}}_{\scriptscriptstyle{FD}}$</p>


$$ \hat{\boldsymbol{y}}_{\scriptscriptstyle{FD}} = \boldsymbol{X}^{*} \hat{\boldsymbol{\delta}}_{\scriptscriptstyle{FD}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat_FD</span> <span class="o">=</span> <span class="n">Xt</span> <span class="o">%*%</span> <span class="n">dhat_FD</span>
</span></span></code></pre></div><p>e) Resíduos de Primeiras-Diferenças 

$\hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{FD}}$</p>


$$ \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{FD}} = \boldsymbol{y} - \hat{\boldsymbol{y}}_{\scriptscriptstyle{FD}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ehat_FD</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">yhat_FD</span>
</span></span></code></pre></div><p>f) Variância do termo de erro</p>


$$ \hat{\sigma}^2_v = \frac{\hat{\boldsymbol{\varepsilon}}' \boldsymbol{D}' \boldsymbol{D} \hat{\boldsymbol{\varepsilon}}}{NT-K-N} $$
<p>Como 

$\hat{\sigma}^2_v$ é escalar, é conveniente transformar em &ldquo;matriz 1x1&rdquo; em número usando <code>as.numeric()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando variâncias dos termos de erro</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2v</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat_FD</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">D</span> <span class="o">%*%</span> <span class="n">ehat_FD</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span> <span class="o">-</span> <span class="n">K</span> <span class="o">-</span> <span class="n">N</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2v</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.006167647
</span></span></code></pre></div><p><strong>IMPORTANTE</strong>: Ajustar os graus de liberdade do estimador <em>within</em> para 

$NT - K - N$ (ao invés de 

$NT - K - 1$)</p>
<p>g) Matriz de Variâncias-Covariâncias do Estimador <em>Within</em></p>


$$`
    V(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{FD}}) = \sigma^2_v \Big[  (\boldsymbol{X}^{*\prime}  \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X}^*)^{-1} \boldsymbol{X}' \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X} (\boldsymbol{X}^{*\prime} \boldsymbol{D}' \boldsymbol{D} \boldsymbol{X}^*)^{-1} \Big]
`$$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de variância-covariância dos estimadores</span>
</span></span><span class="line"><span class="cl"><span class="n">bread</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">D</span> <span class="o">%*%</span> <span class="n">Xt</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">meat</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">D</span> <span class="o">%*%</span> <span class="n">Xt</span>
</span></span><span class="line"><span class="cl"><span class="n">Vdhat_FD</span> <span class="o">=</span> <span class="n">sig2v</span> <span class="o">*</span> <span class="p">(</span><span class="n">bread</span> <span class="o">%*%</span> <span class="n">meat</span> <span class="o">%*%</span> <span class="n">bread</span><span class="p">)</span> <span class="c1"># sandwich</span>
</span></span><span class="line"><span class="cl"><span class="n">Vdhat_FD</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## [1,] 9.413949e-08
</span></span></code></pre></div><p>i) Erros-padrão 

$\text{se}(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{FD}})$</p>
<p>É a raiz quadrada da diagonal principal da Matriz de Variâncias-Covariâncias do Estimador</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_dhat_FD</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vdhat_FD</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">se_dhat_FD</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.0003068216
</span></span></code></pre></div><p>j) Estatística <em>t</em></p>


$$ t_{\hat{\delta}_k} = \frac{\hat{\delta}_k}{\text{se}(\hat{\delta}_k)} \tag{4.6}
$$ 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Cálculo da estatística t</span>
</span></span><span class="line"><span class="cl"><span class="n">t_dhat_FD</span> <span class="o">=</span> <span class="n">dhat_FD</span> <span class="o">/</span> <span class="n">se_dhat_FD</span>
</span></span><span class="line"><span class="cl"><span class="n">t_dhat_FD</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##          [,1]
</span></span><span class="line"><span class="cl">## [1,] 13.07725
</span></span></code></pre></div><p>k) P-valor</p>


$$ p_{\hat{\delta}_k} = 2.\Phi_{t_{(NT-K-N)}}(-|t_{\hat{\delta}_k}|), \tag{4.7} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># p-valor</span>
</span></span><span class="line"><span class="cl"><span class="n">p_dhat_FD</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_dhat_FD</span><span class="p">),</span> <span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="o">-</span><span class="n">K</span><span class="o">-</span><span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_dhat_FD</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## [1,] 1.385139e-38
</span></span></code></pre></div><p>l) Tabela-resumo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">dhat_FD</span><span class="p">,</span> <span class="n">se_dhat_FD</span><span class="p">,</span> <span class="n">t_dhat_FD</span><span class="p">,</span> <span class="n">p_dhat_FD</span><span class="p">)</span> <span class="c1"># resultado Within</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                    se_dhat_FD                      
</span></span><span class="line"><span class="cl">## [1,] 0.004012382 0.0003068216 13.07725 1.385139e-38
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.fd</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># resultado Within via plm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##       Estimate   Std. Error  t-value     Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## qn 0.004012382 0.0003068216 13.07725 1.385139e-38
</span></span></code></pre></div><h4 id="transformando-e-estimando-por-mqo-3">Transformando e estimando por MQO</h4>
<p>Além da forma mostrada anteriormente, podemos também transformar as variáveis e resolver por MQO, pré-multiplicando 

$\boldsymbol{X}^{*}$ e 

$\boldsymbol{y}$ por 

$ \boldsymbol{D}$, e definindo:</p>


$$\tilde{\boldsymbol{X}^{*}} \equiv \boldsymbol{D} \boldsymbol{X}^{*} \qquad \text{e} \qquad \tilde{\boldsymbol{y}} \equiv \boldsymbol{D} \boldsymbol{y}$$
<p>c&rsquo;) Estimativas <em>within</em> via MQO</p>


$$ \tilde{\hat{\boldsymbol{\delta}}}_{\scriptscriptstyle{MQO}} = (\tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{X}^{*}})^{-1} \tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{y}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Transformando variáveis</span>
</span></span><span class="line"><span class="cl"><span class="n">Xt_til</span> <span class="o">=</span> <span class="n">D</span> <span class="o">%*%</span> <span class="n">Xt</span>
</span></span><span class="line"><span class="cl"><span class="n">y_til</span> <span class="o">=</span> <span class="n">D</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimando</span>
</span></span><span class="line"><span class="cl"><span class="n">dhat_OLS</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">Xt_til</span> <span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y_til</span>
</span></span><span class="line"><span class="cl"><span class="n">dhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##             [,1]
</span></span><span class="line"><span class="cl">## [1,] 0.004012382
</span></span></code></pre></div><p>d&rsquo;) Valores ajustados/preditos <em>OLS</em></p>


$$ \hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}} = \tilde{\boldsymbol{X}^{*}} \tilde{\hat{\boldsymbol{\delta}}}_{\scriptscriptstyle{MQO}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">yhat_OLS</span> <span class="o">=</span> <span class="n">Xt_til</span> <span class="o">%*%</span> <span class="n">dhat_OLS</span>
</span></span></code></pre></div><p>e&rsquo;) Resíduos MQO</p>


$$ \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}} = \boldsymbol{y} - \hat{\boldsymbol{y}}_{\scriptscriptstyle{MQO}} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ehat_OLS</span> <span class="o">=</span> <span class="n">y_til</span> <span class="o">-</span> <span class="n">yhat_OLS</span>
</span></span></code></pre></div><p>f&rsquo;) Variância do termo de erro</p>


$$ \hat{\sigma}^2 \equiv  \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}}{NT - K - N} $$
<p>Como 

$\hat{\sigma}^2$ é escalar, é conveniente transformar em &ldquo;matriz 1x1&rdquo; em número usando <code>as.numeric()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando variâncias dos termos de erro</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2hat</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">ehat_OLS</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span> <span class="o">-</span> <span class="n">K</span> <span class="o">-</span> <span class="n">N</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><p><strong>IMPORTANTE</strong>: Ajustar os graus de liberdade do estimador <em>within</em> para 

$NT - K - 1$ (ao invés de 

$NT - K - 1$)</p>
<p>g&rsquo;) Matriz de Variâncias-Covariâncias do Estimador MQO</p>


$$ \widehat{\text{Var}}(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{MQO}}) = \hat{\sigma}^2 (\tilde{\boldsymbol{X}^{*\prime}} \tilde{\boldsymbol{X}^{*}})^{-1} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Calculando a Matriz de variância-covariância dos estimadores</span>
</span></span><span class="line"><span class="cl"><span class="n">Vdhat_OLS</span> <span class="o">=</span> <span class="n">sig2hat</span> <span class="o">*</span> <span class="nf">solve</span><span class="p">(</span> <span class="nf">t</span><span class="p">(</span><span class="n">Xt_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">Xt_til</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vdhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## [1,] 9.413949e-08
</span></span></code></pre></div><p>h&rsquo;) Erros-padrão 

$\text{se}(\hat{\boldsymbol{\delta}}_{\scriptscriptstyle{OLS}})$</p>
<p>É a raiz quadrada da diagonal principal da Matriz de Variâncias-Covariâncias do Estimador</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">se_dhat_OLS</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span> <span class="nf">diag</span><span class="p">(</span><span class="n">Vdhat_OLS</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">se_dhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 0.0003068216
</span></span></code></pre></div><p>i&rsquo;) Estatística <em>t</em></p>


$$ t_{\hat{\delta}_k} = \frac{\hat{\delta}_k}{\text{se}(\hat{\delta}_k)} \tag{4.6}
$$ 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Cálculo da estatística t</span>
</span></span><span class="line"><span class="cl"><span class="n">t_dhat_OLS</span> <span class="o">=</span> <span class="n">dhat_OLS</span> <span class="o">/</span> <span class="n">se_dhat_OLS</span>
</span></span><span class="line"><span class="cl"><span class="n">t_dhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##          [,1]
</span></span><span class="line"><span class="cl">## [1,] 13.07725
</span></span></code></pre></div><p>j&rsquo;) P-valor</p>


$$ p_{\hat{\delta}_k} = 2.\Phi_{t_{(NT-K-N)}}(-|t_{\hat{\delta}_k}|), \tag{4.7} $$
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># p-valor</span>
</span></span><span class="line"><span class="cl"><span class="n">p_dhat_OLS</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_dhat_OLS</span><span class="p">),</span> <span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="o">-</span><span class="n">K</span><span class="o">-</span><span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_dhat_OLS</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## [1,] 1.385139e-38
</span></span></code></pre></div><p>k&rsquo;) Tabela-resumo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">dhat_OLS</span><span class="p">,</span> <span class="n">se_dhat_OLS</span><span class="p">,</span> <span class="n">t_dhat_OLS</span><span class="p">,</span> <span class="n">p_dhat_OLS</span><span class="p">)</span> <span class="c1"># resultado FD via MQO</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                   se_dhat_OLS                      
</span></span><span class="line"><span class="cl">## [1,] 0.004012382 0.0003068216 13.07725 1.385139e-38
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.fd</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># resultado FD via plm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##       Estimate   Std. Error  t-value     Pr(&gt;|t|)
</span></span><span class="line"><span class="cl">## qn 0.004012382 0.0003068216 13.07725 1.385139e-38
</span></span></code></pre></div></br>
<h2 id="comparativo-dos-estimadores">Comparativo dos Estimadores</h2>
<h3 id="mqgf-junção-mqe-e-_within_">MQGF: junção MQE e <em>Within</em></h3>
<ul>
<li>
<p>Combinação de MQE (Efeitos Aleatórios) e de <em>Within</em> (Efeitos Fixos)</p>
</li>
<li>
<p>Lembre-se que a Matriz de Variâncias-Covariâncias dos Erros é dada por


$$ \hat{\boldsymbol{\Sigma}}^p = (\hat{\sigma}^2_v)^p \boldsymbol{W} + (\hat{\sigma}^2_v + T \hat{\sigma}^2_u)^p \boldsymbol{B}, \tag{2.29} $$
em que 

$p$ é um escalar.</p>
</li>
<li>
<p>Usando 

$p=-0.5$ em (2.29), tem-se


$$ \boldsymbol{\Sigma}^{-0.5} = \frac{1}{\sigma_v + T \sigma_u} \boldsymbol{B} + \frac{1}{\sigma_v} \boldsymbol{W} $$</p>
</li>
<li>
<p>Anteriormente, transformamos MQGF usando 

$\tilde{\boldsymbol{y}} \equiv \boldsymbol{\Sigma}^{-0.5}y$ e 

$\tilde{\boldsymbol{X}} \equiv \boldsymbol{\Sigma}^{-0.5}Z$:</p>
</li>
</ul>


\begin{align}
    \hat{\boldsymbol{\beta}} &= (\boldsymbol{X}' \boldsymbol{\Sigma}^{-1} \boldsymbol{X})^{-1} (\boldsymbol{X}' \boldsymbol{\Sigma}^{-1} \boldsymbol{y}) \tag{2.27} \\
    &= (\boldsymbol{X}' \boldsymbol{\Sigma}^{-0.5\prime} \boldsymbol{\Sigma}^{-0.5} \boldsymbol{X})^{-1} (\boldsymbol{X}' \boldsymbol{\Sigma}^{-0.5}\boldsymbol{\Sigma}^{-0.5\prime} \boldsymbol{y}) \\
    &= (\tilde{\boldsymbol{X}}'\tilde{\boldsymbol{X}})^{-1} \tilde{\boldsymbol{X}} \tilde{\boldsymbol{y}}
\end{align}
<p>Sem perda de generalidade, podemos pré-multiplicar o modelo por 

$\sigma_v \boldsymbol{\Sigma}^{-0.5}$ (ao invés de 

$\boldsymbol{\Sigma}^{-0.5})$, logo:</p>


\begin{align} \boldsymbol{\Sigma}^{-0.5} &= \sqrt{\frac{1}{\sigma^2_v + T \sigma^2_u}} \boldsymbol{B} + \frac{1}{\sigma_v} \boldsymbol{W} \\
&= \frac{1}{\sigma_v} \left[ \sigma_v \sqrt{\frac{1}{\sigma^2_v + T \sigma^2_u}} \boldsymbol{B} + \boldsymbol{W} \right] \\
&= \frac{1}{\sigma_v} \left[ \sqrt{\frac{\sigma^2_v}{\sigma^2_v + T \sigma^2_u}} \boldsymbol{B} + \boldsymbol{W} \right] \\
&= \frac{1}{\sigma_v} \left[ \sqrt{\frac{\sigma^2_v}{\sigma^2_v + T \sigma^2_u}} \boldsymbol{B} + (\boldsymbol{I} - \boldsymbol{B}) \right] \\
&= \frac{1}{\sigma_v} \left[ \boldsymbol{I} + \sqrt{\frac{\sigma^2_v}{\sigma^2_v + T \sigma^2_u}} \boldsymbol{B} - \boldsymbol{B} \right] \\
&=\frac{1}{\sigma_v} \left[ \boldsymbol{I} - \left( 1 - \sqrt{\frac{\sigma^2_v}{\sigma^2_v + T \sigma^2_u}} \right) \boldsymbol{B} \right] \\
\end{align}
<p>Logo, quando pré-multiplicamos as variáveis por 

$\boldsymbol{\Sigma}^{-0.5}$, para uma variável explicativa 

$k$ do indivíduo 

$i$ no tempo 

$t$, segue que:


$$ \tilde{x}^k_{it}\ =\ \frac{1}{\sigma_v} \left[ x^k_{it} + \left(1 - \sqrt{\frac{\sigma^2_v}{\sigma^2_v + T \sigma^2_u}} \right) \bar{x}^k_{i}\right]\ \equiv\ \frac{1}{\sigma_v} \left[ x_{it} - \theta \bar{x}^k_{i}\right], $$
em que 

$$\theta \equiv \left( 1 - \sqrt{\frac{\sigma^2_v}{\sigma^2_v + T \sigma^2_u}} \right)$$</p>
<p>Note que, quando:</p>
<ul>
<li>

$\theta \rightarrow 1$
<ul>
<li>os efeitos individuais dominam 

$\sigma_u \rightarrow \infty$</li>
<li>variável transformada se aproxima da em desvios: 

$x^k_{it} - \bar{x}^k_{i}$</li>
<li>MQGF se aproxima do estimador <em>within</em></li>
</ul>
</li>
<li>

$\theta \rightarrow 0$
<ul>
<li>os efeitos individuais somem: 

$\sigma_u \rightarrow 0$</li>
<li>variável transformada se aproxima da não transformada: 

$x^k_{it}$</li>
<li>MQGF se aproxima do MQE</li>
</ul>
</li>
</ul>
<h3 id="exemplo-1-1">Exemplo 1</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">plm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span> <span class="o">=</span> <span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pTobinQ</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;cusip&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimações MQGF</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.walhus</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;random&#34;</span><span class="p">,</span> <span class="n">random.method</span> <span class="o">=</span> <span class="s">&#34;walhus&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.walhus</span><span class="p">)</span> <span class="c1"># output da estimação MQGF por Wallace e Hussain (1969)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Oneway (individual) effect Random Effect Model 
</span></span><span class="line"><span class="cl">##    (Wallace-Hussain&#39;s transformation)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Call:
</span></span><span class="line"><span class="cl">## plm(formula = ikn ~ qn, data = pTobinQ, model = &#34;random&#34;, random.method = &#34;walhus&#34;)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Balanced Panel: n = 188, T = 35, N = 6580
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Effects:
</span></span><span class="line"><span class="cl">##                    var  std.dev share
</span></span><span class="line"><span class="cl">## idiosyncratic 0.005342 0.073091 0.727
</span></span><span class="line"><span class="cl">## individual    0.002008 0.044814 0.273
</span></span><span class="line"><span class="cl">## theta: 0.7342
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Residuals:
</span></span><span class="line"><span class="cl">##      Min.   1st Qu.    Median   3rd Qu.      Max. 
</span></span><span class="line"><span class="cl">## -0.233092 -0.047491 -0.010282  0.033577  0.621136 
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Coefficients:
</span></span><span class="line"><span class="cl">##               Estimate Std. Error z-value  Pr(&gt;|z|)    
</span></span><span class="line"><span class="cl">## (Intercept) 0.15932587 0.00341439  46.663 &lt; 2.2e-16 ***
</span></span><span class="line"><span class="cl">## qn          0.00386263 0.00016825  22.957 &lt; 2.2e-16 ***
</span></span><span class="line"><span class="cl">## ---
</span></span><span class="line"><span class="cl">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Total Sum of Squares:    37.912
</span></span><span class="line"><span class="cl">## Residual Sum of Squares: 35.1
</span></span><span class="line"><span class="cl">## R-Squared:      0.074179
</span></span><span class="line"><span class="cl">## Adj. R-Squared: 0.074038
</span></span><span class="line"><span class="cl">## Chisq: 527.045 on 1 DF, p-value: &lt; 2.22e-16
</span></span></code></pre></div><p>Note que 

$\theta = 73\%$, o que indica que, neste caso, o estimativa MQGF é mais próxima de <em>within</em> (

$\theta=1$) do que de <em>between</em> (

$\theta=0$). A grande quantidade de períodos (

$T = 35$) provavelmente influencia este alto valor.</p>
<h3 id="exemplo-2-1">Exemplo 2</h3>
<ul>
<li>Seção 2.4.4 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</li>
<li>Usado por Kinal e Lahiri (1993)</li>
<li>Queremos estabelecer relação entre importações (<em>imports</em>) e produto nacional (<em>gnp</em>)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;ForeignTrade&#34;</span><span class="p">,</span> <span class="n">package</span> <span class="o">=</span> <span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">FT</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">ForeignTrade</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;country&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimações MQGF</span>
</span></span><span class="line"><span class="cl"><span class="n">FT.between</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">imports</span> <span class="o">~</span> <span class="n">gnp</span><span class="p">,</span> <span class="n">FT</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;between&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">FT.pooled</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">imports</span> <span class="o">~</span> <span class="n">gnp</span><span class="p">,</span> <span class="n">FT</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;pooling&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">FT.fgls</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">imports</span> <span class="o">~</span> <span class="n">gnp</span><span class="p">,</span> <span class="n">FT</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;random&#34;</span><span class="p">,</span> <span class="n">random.method</span> <span class="o">=</span> <span class="s">&#34;walhus&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">FT.within</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">imports</span> <span class="o">~</span> <span class="n">gnp</span><span class="p">,</span> <span class="n">FT</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;within&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Resumindo 4 estimações em única tabela</span>
</span></span><span class="line"><span class="cl"><span class="n">stargazer</span><span class="o">::</span><span class="nf">stargazer</span><span class="p">(</span><span class="n">FT.between</span><span class="p">,</span> <span class="n">FT.pooled</span><span class="p">,</span> <span class="n">FT.fgls</span><span class="p">,</span> <span class="n">FT.within</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">digits</span><span class="o">=</span><span class="m">3</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">,</span> <span class="n">omit.stat</span><span class="o">=</span><span class="s">&#34;f&#34;</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## ===================================================
</span></span><span class="line"><span class="cl">##                       Dependent variable:          
</span></span><span class="line"><span class="cl">##              --------------------------------------
</span></span><span class="line"><span class="cl">##                             imports                
</span></span><span class="line"><span class="cl">##                 (1)       (2)       (3)      (4)   
</span></span><span class="line"><span class="cl">## ---------------------------------------------------
</span></span><span class="line"><span class="cl">## gnp            0.049   0.064***  0.675***  0.902***
</span></span><span class="line"><span class="cl">##               (0.080)   (0.017)   (0.033)  (0.035) 
</span></span><span class="line"><span class="cl">##                                                    
</span></span><span class="line"><span class="cl">## Constant     -6.368*** -6.321*** -4.403***         
</span></span><span class="line"><span class="cl">##               (0.313)   (0.066)   (0.183)          
</span></span><span class="line"><span class="cl">##                                                    
</span></span><span class="line"><span class="cl">## ---------------------------------------------------
</span></span><span class="line"><span class="cl">## Observations    31        744       744      744   
</span></span><span class="line"><span class="cl">## R2             0.013     0.019     0.358    0.488  
</span></span><span class="line"><span class="cl">## Adjusted R2   -0.021     0.018     0.357    0.466  
</span></span><span class="line"><span class="cl">## ===================================================
</span></span><span class="line"><span class="cl">## Note:                   *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Resumo do MQGF</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">FT.fgls</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Oneway (individual) effect Random Effect Model 
</span></span><span class="line"><span class="cl">##    (Wallace-Hussain&#39;s transformation)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Call:
</span></span><span class="line"><span class="cl">## plm(formula = imports ~ gnp, data = FT, model = &#34;random&#34;, random.method = &#34;walhus&#34;)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Balanced Panel: n = 31, T = 24, N = 744
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Effects:
</span></span><span class="line"><span class="cl">##                  var std.dev share
</span></span><span class="line"><span class="cl">## idiosyncratic 0.1573  0.3966 0.135
</span></span><span class="line"><span class="cl">## individual    1.0063  1.0032 0.865
</span></span><span class="line"><span class="cl">## theta: 0.9196
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Residuals:
</span></span><span class="line"><span class="cl">##       Min.    1st Qu.     Median    3rd Qu.       Max. 
</span></span><span class="line"><span class="cl">## -1.4043348 -0.1920097 -0.0017737  0.2230540  0.9444870 
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Coefficients:
</span></span><span class="line"><span class="cl">##              Estimate Std. Error z-value  Pr(&gt;|z|)    
</span></span><span class="line"><span class="cl">## (Intercept) -4.403331   0.182589 -24.116 &lt; 2.2e-16 ***
</span></span><span class="line"><span class="cl">## gnp          0.675111   0.033209  20.329 &lt; 2.2e-16 ***
</span></span><span class="line"><span class="cl">## ---
</span></span><span class="line"><span class="cl">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Total Sum of Squares:    125.04
</span></span><span class="line"><span class="cl">## Residual Sum of Squares: 80.312
</span></span><span class="line"><span class="cl">## R-Squared:      0.35773
</span></span><span class="line"><span class="cl">## Adj. R-Squared: 0.35686
</span></span><span class="line"><span class="cl">## Chisq: 413.271 on 1 DF, p-value: &lt; 2.22e-16
</span></span></code></pre></div><ul>
<li>O estimador MQGF remove grande parte da variação inter-indivíduos, pois subtrai, da covariada, 94% da média individual:


$$ \tilde{x}_{it}\ =\ x_{it} - \theta \bar{x}_{i}\ =\ x_{it} - 0,94 \bar{x}_{i} $$</li>
</ul>
<center><img src="../example_panel-1.png"></center>
<ul>
<li>MQGF e <em>within</em> são bastante parecidos</li>
<li>MQE é parecido com <em>between</em>, pois maior peso fica na variabilidade entre indivíduos</li>
</ul>
</br>
<h2 id="estimador-mv">Estimador MV</h2>
<ul>
<li>
<p>Seção 3.3 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</p>
</li>
<li>
<p>Uma alternativa aos estimadores de MQGF é o de máxima verossimilhança (MV).</p>
</li>
<li>
<p>Assume-se que a distribuição dos dois componentes de erro são normais:


$$ u | X \sim N(0, \sigma^2_u) \quad \text{ e } \quad v | u, X \sim N(0, \sigma^2_v) $$</p>
</li>
<li>
<p>Ao invés de estimar 

$\sigma^2_u$ e 

$\sigma^2_v$ para depois calcular 

$\boldsymbol{\beta}$, ambos são estimados simultaneamente.</p>
</li>
<li>
<p>Denote


$\phi \equiv \sqrt{\frac{\sigma^2_v}{\sigma^2_v + T\sigma^2_u}},$
a função de log-verossimilhança para um painel balanceado é:</p>
</li>
</ul>
<!-- 

$$ \ln{L} = -\frac{NT}{2} \ln{2\pi} - \frac{NT}{2}\ln{\sigma^2_v} + \frac{N}{2} \ln{\phi^2} - \frac{1}{2\sigma^2_v} \left( \varepsilon' \boldsymbol{W} \varepsilon + \phi^2 \varepsilon' \boldsymbol{B} \varepsilon \right) $$ -->
<p>e considere a transformação de variável pela pré-multiplicação por 

$(\boldsymbol{I} - \phi \boldsymbol{B})$:</p>


$$\tilde{\boldsymbol{X}}\ \equiv\ (\boldsymbol{I} - \phi \boldsymbol{B}) \boldsymbol{X}\ =\ \boldsymbol{X} - \phi \boldsymbol{B} \boldsymbol{X}$$
<p>Logo,</p>


\begin{align}
    \hat{\boldsymbol{\beta}} &= (\tilde{\boldsymbol{X}}'\tilde{\boldsymbol{X}})^{-1} \tilde{\boldsymbol{X}}'\tilde{\boldsymbol{y}} \tag{3.12} \\
    \hat{\sigma}^2_v &= \frac{\hat{\boldsymbol{\varepsilon}}' \boldsymbol{W} \hat{\boldsymbol{\varepsilon}} + \hat{\phi}^2 \hat{\boldsymbol{\varepsilon}}' \boldsymbol{B} \hat{\boldsymbol{\varepsilon}}}{NT} \tag{3.13} \\
    \hat{\phi}^2 &=\frac{\hat{\boldsymbol{\varepsilon}}' \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}}{(T-1) \hat{\boldsymbol{\varepsilon}}'\boldsymbol{B}\hat{\boldsymbol{\varepsilon}}} \tag{3.14}
\end{align}
<p>A estimação pode ser feita iterativamente por FIML (Full Information Maximum Likelihood):</p>
<ol>
<li>Chute inicial de 

$\hat{\boldsymbol{\beta}}$</li>
<li>Calcular 

$\hat{\phi}^2$ usando (3.14)</li>
<li>Calcular 

$\hat{\boldsymbol{\beta}}$ usando (3.12)</li>
<li>Verificar convergência: se não convergiu, volta para o passo 2, usando o 

$\hat{\boldsymbol{\beta}}$ calculado no passo 3.</li>
<li>Calcular 

$\sigma^2_v$ usando (3.13)</li>
</ol>
<h3 id="estimação-via-pglm">Estimação via <code>pglm()</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">pglm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span> <span class="o">=</span> <span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Transformando no formato pdata frame, com indentificador de indivíduo e de tempo</span>
</span></span><span class="line"><span class="cl"><span class="n">pTobinQ</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;cusip&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimação MV</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.ml</span> <span class="o">=</span> <span class="nf">pglm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;gaussian&#34;</span><span class="p">)</span> <span class="c1"># Estimação MV</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.fgls</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">&#34;random&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">random.method</span><span class="o">=</span><span class="s">&#34;walhus&#34;</span><span class="p">)</span> <span class="c1"># Estimação FGLS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.ml</span><span class="p">)</span><span class="o">$</span><span class="n">estimate</span> <span class="c1"># Coef. MV</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                Estimate   Std. error   t value       Pr(&gt; t)
</span></span><span class="line"><span class="cl">## (Intercept) 0.159327956 0.0034343786  46.39208  0.000000e+00
</span></span><span class="line"><span class="cl">## qn          0.003861798 0.0001683923  22.93334 2.160874e-116
</span></span><span class="line"><span class="cl">## sd.id       0.045073677 0.0025010701  18.02176  1.315002e-72
</span></span><span class="line"><span class="cl">## sd.idios    0.073023338 0.0006452452 113.17145  0.000000e+00
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.fgls</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span> <span class="c1"># Coef. MQGF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                Estimate   Std. Error  z-value      Pr(&gt;|z|)
</span></span><span class="line"><span class="cl">## (Intercept) 0.159325869 0.0034143937 46.66300  0.000000e+00
</span></span><span class="line"><span class="cl">## qn          0.003862631 0.0001682516 22.95747 1.240977e-116
</span></span></code></pre></div><ul>
<li>Note que o resultado por ML foi bem próximo ao do obtido por MQGF</li>
</ul>
<h3 id="estimação-analítica-5">Estimação Analítica</h3>
<p>a) Chutar valores iniciais para as estimativas 

$\hat{\beta}_{\scriptscriptstyle{ini}}$ (pode usar tudo 0)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando o vetor y</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">TobinQ[</span><span class="p">,</span><span class="s">&#34;ikn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="c1"># transformando coluna de data frame em matriz</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando a matriz de covariadas X com primeira coluna de 1&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span> <span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">TobinQ[</span><span class="p">,</span> <span class="s">&#34;qn&#34;</span><span class="n">]</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># juntando 1&#39;s com as covariadas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pegando valores N, T e K</span>
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">cusip</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="bp">T</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span> <span class="nf">unique</span><span class="p">(</span><span class="n">TobinQ</span><span class="o">$</span><span class="n">year</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span> <span class="o">=</span> <span class="nf">ncol</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Matrizes Between e Within</span>
</span></span><span class="line"><span class="cl"><span class="n">iota_T</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">I_N</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">I_NT</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="n">I_N</span> <span class="o">%x%</span> <span class="p">(</span><span class="n">iota_T</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">iota_T</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">iota_T</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">W</span> <span class="o">=</span> <span class="n">I_NT</span> <span class="o">-</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Iremos realizar iterações até a convergência das estimativas</span>
</span></span><span class="line"><span class="cl"><span class="n">tol</span> <span class="o">=</span> <span class="m">1e-10</span> <span class="c1"># tolerância para convergência</span>
</span></span><span class="line"><span class="cl"><span class="n">dist</span> <span class="o">=</span> <span class="m">1</span> <span class="c1"># distância inicial, apenas para entrar no loop/while</span>
</span></span><span class="line"><span class="cl"><span class="n">it</span> <span class="o">=</span> <span class="m">0</span> <span class="c1"># número de iterações</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># (a) Chutar valores iniciais para as estimativas</span>
</span></span><span class="line"><span class="cl"><span class="n">bhat_ini</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="c1"># chute inicial de 0&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="n">bhat_ini</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##      [,1]
</span></span><span class="line"><span class="cl">## [1,]    0
</span></span><span class="line"><span class="cl">## [2,]    0
</span></span></code></pre></div><p>b) Obter 

$\hat{\boldsymbol{\varepsilon}} = \boldsymbol{y} - \hat{\boldsymbol{y}}$ e calcular


$$ \hat{\phi}^2 = \frac{\hat{\varepsilon}' \boldsymbol{W} \hat{\varepsilon}}{(T-1)\hat{\varepsilon}' \boldsymbol{B} \hat{\varepsilon}} \tag{3.14} $$</p>
<p>c) Calcular as novas estimativas 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{fim}}$ novo usando


$$ \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{fim}} = (\tilde{\boldsymbol{X}}'\tilde{\boldsymbol{X}})^{-1} \tilde{X}'\tilde{y}, \tag{3.12} $$
em que 

$\tilde{\boldsymbol{X}} = (\boldsymbol{I} - \phi \boldsymbol{B}) \boldsymbol{X}$, e 

$\tilde{\boldsymbol{y}} = (\boldsymbol{I} - \phi \boldsymbol{B}) \boldsymbol{y}$</p>
<p>d) Verificar convergência das estimativas de acordo com:


$$ \text{distância}\ =\ \max\{\text{abs}(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{fim}} - \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{ini}})\}\}\ <\ 1 \times 10^{-10}\ =\ \text{tolerância}$$
Se não convergiu (i.e., expressão acima não foi satisfeita), volte ao passo (b), definindo 

$\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{ini}} \equiv \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{fim}}$ e iniciando uma nova iteração</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">while </span><span class="p">(</span><span class="n">dist</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># Mostrar a iteração atual e as estimativas atuais beta</span>
</span></span><span class="line"><span class="cl">	<span class="nf">print</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;iteração &#34;</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	      <span class="s">&#34;: b0 = &#34;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="n">bhat_ini[1]</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34; | b1 = &#34;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="n">bhat_ini[2]</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">))</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># (b)  Obter valores ajustados, resíduos e estimar phi</span>
</span></span><span class="line"><span class="cl">	<span class="n">y_hat</span> <span class="o">=</span> <span class="n">X</span> <span class="o">%*%</span> <span class="n">bhat_ini</span>
</span></span><span class="line"><span class="cl">	<span class="n">e</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span>
</span></span><span class="line"><span class="cl">	<span class="n">phi2_hat</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">((</span><span class="nf">t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="bp">T</span><span class="m">-1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">e</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	<span class="n">phi_hat</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">phi2_hat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># (c) Calcular o novas estimativas</span>
</span></span><span class="line"><span class="cl">	<span class="n">X_til</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_NT</span> <span class="o">-</span> <span class="n">phi_hat</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">	<span class="n">y_til</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_NT</span> <span class="o">-</span> <span class="n">phi_hat</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">	<span class="n">bhat_fim</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">X_til</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y_til</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># (d) Verificar convergência das estimativas</span>
</span></span><span class="line"><span class="cl">	<span class="n">dist</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">bhat_fim</span> <span class="o">-</span> <span class="n">bhat_ini</span><span class="p">))</span> <span class="c1"># calculando distância</span>
</span></span><span class="line"><span class="cl">	<span class="n">bhat_ini</span> <span class="o">=</span> <span class="n">bhat_fim</span>
</span></span><span class="line"><span class="cl">	<span class="n">it</span> <span class="o">=</span> <span class="n">it</span> <span class="o">+</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] &#34;iteração 0: b0 = 0 | b1 = 0&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;iteração 1: b0 = 0.158127 | b1 = 0.004341&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;iteração 2: b0 = 0.158491 | b1 = 0.004196&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;iteração 3: b0 = 0.158491 | b1 = 0.004196&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;iteração 4: b0 = 0.158491 | b1 = 0.004196&#34;
</span></span></code></pre></div><p>e) Obter 

$\hat{\boldsymbol{\varepsilon}} = \boldsymbol{y} - \hat{\boldsymbol{y}}$ e 

$ \hat{\phi}^2 $ para calcular


$$\hat{\sigma}^2_v = \frac{\hat{\varepsilon}' \boldsymbol{W} \hat{\varepsilon} + \hat{\phi}^2 \hat{\varepsilon}' \boldsymbol{B} \hat{\varepsilon}}{NT} \tag{3.13} \qquad \text{e} \qquad \sigma^2_l = \frac{\sigma^2_v}{\hat{\phi}^2}  $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># (e) Calcular phi, sigma^2_v, e sigma^2_l</span>
</span></span><span class="line"><span class="cl"><span class="n">y_hat</span> <span class="o">=</span> <span class="n">X</span> <span class="o">%*%</span> <span class="n">bhat_fim</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span>
</span></span><span class="line"><span class="cl"><span class="n">phi2_hat</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">((</span><span class="nf">t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="bp">T</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">e</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">phi_hat</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">phi2_hat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sig2v</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">((</span><span class="nf">t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">e</span> <span class="o">+</span> <span class="n">phi2_hat</span> <span class="o">*</span> <span class="nf">t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">sig2l</span> <span class="o">=</span> <span class="n">sig2v</span> <span class="o">/</span> <span class="n">phi2_hat</span>
</span></span></code></pre></div><p>g) Calcular 

$V(\hat{\beta})$ usando:


$$ V(\hat{\beta}) = \left( \frac{1}{\hat{\sigma}^2_v} \boldsymbol{X}' \boldsymbol{W X} + \frac{1}{\hat{\sigma}^2_l} \boldsymbol{X}' \boldsymbol{B X}\right)^{-1} $$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># (g) Calcular V(bhat)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat</span> <span class="o">=</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">sig2v</span><span class="p">)</span> <span class="o">*</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">W</span> <span class="o">%*%</span> <span class="n">X</span> <span class="o">+</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">sig2l</span><span class="p">)</span> <span class="o">*</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">B</span> <span class="o">%*%</span> <span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Vbhat</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##               [,1]          [,2]
</span></span><span class="line"><span class="cl">## [1,]  1.171015e-05 -7.095051e-08
</span></span><span class="line"><span class="cl">## [2,] -7.095051e-08  2.831961e-08
</span></span></code></pre></div><p>h) Obter erros padrão das estimativas, estatísticas t e p-valores</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># (h) Erros padrão, estatistica t e p-valores</span>
</span></span><span class="line"><span class="cl"><span class="n">se_bhat</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="n">Vbhat</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">t_bhat</span> <span class="o">=</span> <span class="n">bhat_fim</span> <span class="o">/</span> <span class="n">se_bhat</span>
</span></span><span class="line"><span class="cl"><span class="n">p_bhat</span> <span class="o">=</span> <span class="nf">pt</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">t_bhat</span><span class="p">),</span> <span class="n">df</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="bp">T</span><span class="o">-</span><span class="n">K</span><span class="m">-1</span><span class="p">)</span> <span class="c1"># NT - K - 1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">cbind</span><span class="p">(</span><span class="n">bhat_fim</span><span class="p">,</span> <span class="n">se_bhat</span><span class="p">,</span> <span class="n">t_bhat</span><span class="p">,</span> <span class="n">p_bhat</span><span class="p">)</span> <span class="c1"># Resultados</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                       se_bhat                      
</span></span><span class="line"><span class="cl">## [1,] 0.158490653 0.0034220099 46.31508  0.00000e+00
</span></span><span class="line"><span class="cl">## [2,] 0.004196004 0.0001682843 24.93402 1.68128e-131
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">Q.ml</span><span class="p">)</span><span class="o">$</span><span class="n">estimate</span> <span class="c1"># Estimação MV via pglm()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##                Estimate   Std. error   t value       Pr(&gt; t)
</span></span><span class="line"><span class="cl">## (Intercept) 0.159327956 0.0034343786  46.39208  0.000000e+00
</span></span><span class="line"><span class="cl">## qn          0.003861798 0.0001683923  22.93334 2.160874e-116
</span></span><span class="line"><span class="cl">## sd.id       0.045073677 0.0025010701  18.02176  1.315002e-72
</span></span><span class="line"><span class="cl">## sd.idios    0.073023338 0.0006452452 113.17145  0.000000e+00
</span></span></code></pre></div></br>
<h2 id="testes-de-presença-de-efeitos-individuais">Testes de Presença de Efeitos Individuais</h2>
<h3 id="breusch-pagan">Breusch-Pagan</h3>
<ul>
<li>Seção 4.1 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</li>
<li>É um teste baseado em multiplicadores de Lagrange (LM) nos resíduos de MQO, em que 

$H_0: \sigma^2_u = 0$ (ausência de efeitos individuais)</li>
<li>A estatística teste é dada por


$$ LM_u = \frac{NT}{2(T-1)} \left( T \frac{\hat{\boldsymbol{\varepsilon}}' B_u \hat{\boldsymbol{\varepsilon}}}{\hat{\boldsymbol{\varepsilon}}' \hat{\boldsymbol{\varepsilon}}} - 1 \right)^2  $$
que é assintoticamente distribuída como ua <code>\(\chi^2\)</code> com 1 grau de liberdade.</li>
<li>Há algumas variações deste teste:
<ul>
<li>Breusch and Pagan (1980),</li>
<li>Gourieroux et al. (1982),</li>
<li>Honda (1985), e</li>
<li>King and Wu (1997).</li>
</ul>
</li>
</ul>
<h3 id="testes-f">Testes F</h3>
<ul>
<li>Seção 4.1 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</li>
<li>Sejam a soma dos resíduos ao quadrado e os graus de liberdade do modelo <em>within</em> 

$\hat{\boldsymbol{\varepsilon}}'_W\hat{\boldsymbol{\varepsilon}}_W$ e 

$N(T-1) - K$, respectivamente.</li>
<li>Sejam a soma dos resíduos ao quadrado e os graus de liberdade do modelo pooled MQO 

$\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}}\hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}}$ e 

$NT - K - 1$, respectivamente.</li>
<li>Sob hipótese nula de que não há efeitos individuais, a estatística teste é dada por


$$ \frac{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{MQO}} \boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_{\scriptscriptstyle{MQO}} - \hat{\boldsymbol{\varepsilon}}'_W\hat{\boldsymbol{\varepsilon}}_W}{\hat{\boldsymbol{\varepsilon}}'_{\scriptscriptstyle{W}}\boldsymbol{W} \hat{\boldsymbol{\varepsilon}}_W} \frac{NT - K - N + 1}{N-1} $$
que segue uma distribuição F de Fisher-Snedecor com 

$N-1$ e 

$NT - K - N + 1$ graus de liberdade.</li>
</ul>
<h3 id="aplicando-no-r">Aplicando no R</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="s">&#34;TobinQ&#34;</span><span class="p">,</span> <span class="n">package</span> <span class="o">=</span> <span class="s">&#34;pder&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pTobinQ</span> <span class="o">=</span> <span class="nf">pdata.frame</span><span class="p">(</span><span class="n">TobinQ</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;cusip&#34;</span><span class="p">,</span> <span class="s">&#34;year&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Q.within</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;within&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.gls</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;random&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Q.pooling</span> <span class="o">=</span> <span class="nf">plm</span><span class="p">(</span><span class="n">ikn</span> <span class="o">~</span> <span class="n">qn</span><span class="p">,</span> <span class="n">pTobinQ</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;pooling&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Teste de Breusch-Pagan/LM</span>
</span></span><span class="line"><span class="cl"><span class="nf">plmtest</span><span class="p">(</span><span class="n">Q.pooling</span><span class="p">,</span> <span class="n">effect</span><span class="o">=</span><span class="s">&#34;individual&#34;</span><span class="p">)</span> <span class="c1"># Honda (1985)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## 	Lagrange Multiplier Test - (Honda)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## data:  ikn ~ qn
</span></span><span class="line"><span class="cl">## normal = 91.377, p-value &lt; 2.2e-16
</span></span><span class="line"><span class="cl">## alternative hypothesis: significant effects
</span></span></code></pre></div><p>O teste LM (Breusch-Pagan) acusou efeitos individuais significativos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Teste F</span>
</span></span><span class="line"><span class="cl"><span class="nf">pFtest</span><span class="p">(</span><span class="n">Q.within</span><span class="p">,</span> <span class="n">Q.pooling</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## 	F test for individual effects
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## data:  ikn ~ qn
</span></span><span class="line"><span class="cl">## F = 14.322, df1 = 187, df2 = 6391, p-value &lt; 2.2e-16
</span></span><span class="line"><span class="cl">## alternative hypothesis: significant effects
</span></span></code></pre></div><p>Assim como o teste LM, Pelo teste F, observam-se efeitos individuais significativos.</p>
</br>
<h2 id="testes-de-efeitos-correlacionados">Testes de Efeitos Correlacionados</h2>
<ul>
<li>Seção 4.2 de &ldquo;Panel Data Econometrics with R&rdquo; (Croissant &amp; Millo, 2018)</li>
<li>Continuamos assumindo que 

$E(v|X) = 0$, em que 

$v$ é o termo de erro idiossincrático.</li>
<li>Nestes testes, verificamos se 

$E(u|X) = 0$, ou seja, se os efeitos individuais são ou não são correlacionados com as covariadas.</li>
</ul>
<h3 id="teste-de-hausman">Teste de Hausman</h3>
<ul>
<li>
<p>O princípio geral do teste de Hausman consiste em comparar dois modelos 

$A$e 

$B$ tal que</p>
<ul>
<li>sob 

$H_0$: 

$A$ e 

$B$ são ambos consistentes, mas 

$B$ é mais eficiente que 

$A$</li>
<li>sob 

$H_1$: apenas 

$A$ é consistente</li>
</ul>
</li>
<li>
<p>Se 

$H_0$ é verdadeiro, então os coeficientes dos dois modelos não devem divergir.</p>
</li>
<li>
<p>O teste é baseado em 

$\hat{\boldsymbol{\beta}}_A - \hat{\boldsymbol{\beta}}_B$ e Hausman mostrou que, sob 

$H_0$, temos 

$cov(\hat{\boldsymbol{\beta}}_A, \hat{\boldsymbol{\beta}}_B) = 0$ e, logo, a variância dessa diferença é simplesmente 

$V(\hat{\boldsymbol{\beta}}_A - \hat{\boldsymbol{\beta}}_B) = V(\hat{\boldsymbol{\beta}}_A) - V(\hat{\boldsymbol{\beta}}_B)$</p>
</li>
<li>
<p>No contexto de dados em painéis, compara-se o estimador <em>within</em> (efeitos fixos) e o de MQGF (efeitos aleatórios)</p>
</li>
<li>
<p>Quando 

$E(u|X) = 0$ ambos estimadores são consistentes, ou seja,


$$ \hat{q} \equiv \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}} - \hat{\boldsymbol{\beta}}_W\ \overset{p}{\rightarrow}\ 0 $$
então é preferível usar o mais eficiente (MQGF, pois usa ambas variações inter e intra-indivíduos).</p>
</li>
<li>
<p>Se 

$E(u|X) \neq 0$, então 

$\hat{q} \equiv \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}} - \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{W}}\neq 0$ e apenas o modelo robusto a 

$E(u|X) \neq 0$ (<em>within</em>) é consistente.</p>
</li>
<li>
<p>A variância é dada por


\begin{align}
    V(\hat{q}) &= V(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}} - \hat{\boldsymbol{\beta}}_W) = V(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}}) + V(\hat{\boldsymbol{\beta}}_W) - 2 cov(\hat{\boldsymbol{\beta}}_{\scriptscriptstyle{W}}, \hat{\boldsymbol{\beta}}_{\scriptscriptstyle{MQGF}}) \\
    &= \sigma^2_v (\boldsymbol{X}' \boldsymbol{W X})^{-1} - (\boldsymbol{X}'\boldsymbol{\Sigma}^{-1} \boldsymbol{X})^{-1}
\end{align}</p>
</li>
<li>
<p>Logo, a estatística teste se torna


$$ \hat{q}'\ V(\hat{q})^{-1}\ \hat{q} $$
que, sob 

$H_0$, é distribuida como 

$\chi^2$ com 

$K$ graus de liberdade.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Teste de Hausman</span>
</span></span><span class="line"><span class="cl"><span class="nf">phtest</span><span class="p">(</span><span class="n">Q.within</span><span class="p">,</span> <span class="n">Q.gls</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## 	Hausman Test
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## data:  ikn ~ qn
</span></span><span class="line"><span class="cl">## chisq = 3.3044, df = 1, p-value = 0.06909
</span></span><span class="line"><span class="cl">## alternative hypothesis: one model is inconsistent
</span></span></code></pre></div><p>Não se rejeita a hipótese nula de que ambos modelos são consistentes a 5%.</p>
<!-- </br> -->
<!-- 

<ul class="cta-group">
  
  <li>
    <a href="../sec11"  class="btn btn-primary px-3 py-3">👉 Proceed to Instrumental Variable</a>
  </li>
  
  
</ul>
 -->


        </article>

        





        



        
        
        <div class="article-widget">
          
<div class="post-nav">
  
  
</div>

        </div>
        
      </div>

      <div class="body-footer">
        <p>Last updated on Sep 9, 2018</p>

        




        




        


      </div>

      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2023 Me. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js"></script>




  

  
  

  









<script src="https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>





  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>












  
  


<script src="/en/js/wowchemy.min.e8ee06ba8371980ffde659871dd593b0.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>


















</body>
</html>
